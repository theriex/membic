define("amd/layout",[],function(){var h=["sloganPadded.png","promo_balloons2.png","promo_list.png","promo_cycle.png"],n=-1,d=-1,t=320,m=null,p=function(){mor.out("dlgdiv","");mor.byId("dlgdiv").style.visibility="hidden";mor.layout.adjust();mor.onescapefunc=null},q=function(d,l){var e;if(!l||!l.trim())l=d+" contains no text";e=l.indexOf("<body>");0<e&&(l=l.slice(e+6,l.indexOf("</body")));mor.out("dlgdiv",'<div id="closeline"><a id="closedlg" href="#close" onclick="mor.layout.closeDialog();return false">&lt;close&nbsp;&nbsp;X&gt;</a></div>'+
l);mor.onescapefunc=p},r=function(d){var l=window.location.href,l=l.slice(0,l.lastIndexOf("/")+1);return l+d},u=function(d){var l="Fetching "+d+" ...";window.scrollTo(0,0);mor.out("dlgdiv",l);mor.byId("dlgdiv").style.visibility="visible";0>d.indexOf(":")&&(d=r(d));mor.call(d,"GET",null,function(l){q(d,l)},function(l,c){q(d,c)},"")},A=function(d,l){mor.onxnode("click",d,function(d){d.preventDefault();d.stopPropagation();u(l)})},y=function(v){var l;if(mor.byId("slidesdiv")){if(mor.isLowFuncBrowser())mor.log("slideshow isLowFuncBrowser so no fades"),
v&&(n=0),v='<img src="img/slides/'+h[n]+'" class="slideimg"/>',mor.out("slidesdiv",v),n=(n+1)%h.length;else{if(!v){mor.log("    fading introslide"+d+": img/slides/"+h[n]);l=mor.byId("introslide"+d);if(!l)return;setTimeout(function(){l.src="img/slides/blank.png"},1200);l.style.opacity=0}d=(d+1)%2;n=(n+1)%h.length;mor.log("displaying introslide"+d+": img/slides/"+h[n]);v=mor.byId("introslide"+d);if(!v)return;v.src="img/slides/"+h[n];v.style.opacity=1}!h[n]||"blank.png"===h[n]?setTimeout(y,2200):setTimeout(y,
6400)}},x=function(){mor.out("contentdiv",'<div id="chead"> </div><div id="cmain"> </div>')},w=function(){var d,l,e;window.innerWidth&&window.innerHeight?(mor.winw=window.innerWidth,mor.winh=window.innerHeight):"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth?(mor.winw=document.documentElement.offsetWidth,mor.winh=document.documentElement.offsetHeight):document.body&&document.body.offsetWidth?(mor.winw=document.body.offsetWidth,mor.winh=document.body.offsetHeight):
(mor.winw=600,mor.winh=800);if(768>=window.innerWidth||768>=window.screen.width)mor.winw=768;l=mor.byId("contentfill");d=mor.byId("contentdiv").offsetHeight;e=mor.winh-t;l.style.height=d<e?e-d+"px":"16px";e=mor.winw-120;if(d=mor.byId("topdiv"))d.style.width=e+"px";if(d=mor.byId("contentdiv"))d.style.width=e+"px";mor.review.getCurrentReview()&&(e="lihr"+mor.instId(mor.review.getCurrentReview()),(e=mor.byId(e))&&e.focus())};return{init:function(){mor.dojo.on(window,"resize",w);var d;d=document.documentElement.clientWidth;
1037<d?(mor.out("logodiv",'<img src="img/slides/logoMOR.png" id="logoimg" border="0"/>'),d=515+Math.round((d-1037)/2),mor.byId("introslide0").style.left=String(d)+"px",mor.byId("introslide1").style.left=String(d)+"px"):522<=d&&(d=Math.round((d-522)/2),mor.byId("introslide0").style.left=String(d)+"px",mor.byId("introslide1").style.left=String(d)+"px");mor.isLowFuncBrowser()||(mor.byId("introslide0").style.opacity=0,mor.byId("introslide1").style.opacity=0);y(!0);var l=mor.dojo.query("a"),e,c;for(d=
0;l&&d<l.length;d+=1)e=l[d],(c=e.href)&&0<=c.indexOf("docs/")&&A(e,c);w();document.styleSheets[0].cssRules||(mor.byId("bodyid").style.backgroundImage="url('../img/blank.png')",mor.byId("dlgdiv").style.backgroundColor="#CCCCCC")},haveContentDivAreas:function(){return mor.byId("chead")&&mor.byId("cmain")},initContentDivAreas:function(){x()},initContent:function(){if(!mor.byId("chead")||!mor.byId("cmain"))x(),mor.profile.updateHeading(),mor.activity.updateHeading(),mor.review.updateHeading()},adjust:function(){w()},
displayDoc:function(d){u(d)},closeDialog:function(){p()},setTopPaddingAndScroll:function(d){t=d},dragstart:function(d){d&&(m={domobj:d.target,screenX:d.screenX,screenY:d.screenY},mor.log("dndStart "+m.domobj+" "+m.screenX+","+m.screenY),d.dataTransfer&&d.dataTransfer.setData&&d.dataTransfer.setData("text/plain","general drag"))},dragend:function(d){d&&m&&(mor.log("dndEnd called"),m.ended=!0)},bodydragover:function(d){d&&(m&&(!m.ended||m.dropped))&&d.preventDefault()},bodydrop:function(d){var l,e,
c,g,b;mor.log("dndDrop called");d&&m&&(m.dropped=!0,l=d.screenX-m.screenX,e=d.screenY-m.screenY,c=m.domobj,mor.log("dropping "+c+" moved "+l+","+e),g=c.offsetLeft,b=c.offsetTop,c.style.left=String(g+l)+"px",c.style.top=String(b+e)+"px",d.preventDefault(),d.stopPropagation())}}});
define("amd/login",[],function(){var h="",n="",d="",t="",m=[],p="",q=["daily","weekly","fortnightly","never"],r=["Daily","Weekly","Fortnightly","Never"],u=function(a){var b=window.location.href;return b=0<b.indexOf(":8080")||0===b.indexOf("https://")?a:"https://myopenreviews.appspot.com/"+a},A=function(){var a,b;a="am="+h+"&at="+n+"&an="+mor.enc(d);(b=mor.dojo.cookie(n))&&(a+="&as="+mor.enc(b));return a},y=function(){mor.dojo.cookie(mor.authcookname,"",{expires:-1});d=n=h="";mor.review.resetStateVars();
mor.profile.resetStateVars();mor.pen.resetStateVars();mor.rel.resetStateVars("logout")},x=function(){var a=window.location.pathname;history&&(history.pushState&&"function"===typeof history.pushState)&&history.pushState("",document.title,a)},w=function(a){var b;a||(a=mor.parseParams());if(a.returnto){b=decodeURIComponent(a.returnto)+"#";var c="authmethod="+h+"&authtoken="+n+"&authname="+mor.enc(d);b+=c;a.reqprof&&(b+="&view=profile&profid="+a.reqprof);"chgpwd"===a.command&&(a.command="");(a=mor.objdata(a,
["logout","returnto"]))&&(b+="&"+a);window.location.href=b}else{if("profile"===a.anchor)return x(),mor.profile.display(a.action,a.errmsg);if(b=mor.currState()){if("profile"===b.view)return b.profid?mor.profile.byprofid(b.profid):mor.profile.display();if("activity"===b.view)return mor.activity.displayActive();"review"===b.view&&b.revid&&mor.review.initWithId(b.revid,b.mode,a.action,a.errmsg)}mor.activity.displayActive()}},v=function(a,b,c){mor.dojo.cookie(mor.authcookname,a+"..morauth.."+b+"..morauth.."+
c,{expires:365});h=a;n=b;d=c;mor.login.updateAuthentDisplay()},l=function(){var a;if(a=mor.dojo.cookie(mor.authcookname))a=a.split("..morauth.."),h=a[0],n=a[1],d=a[2];mor.login.updateAuthentDisplay();return n},e=function(){var a="http://www.myopenreviews.com";0===window.location.href.indexOf("http://localhost:8080")&&(a="http://localhost:8080");window.location.href=a},c=function(){var a,b,c,f;f="email="+mor.enc(mor.byId("emailin").value||"");"mid"===h&&(f+="&pass="+mor.enc(mor.byId("npin").value||
""));a=mor.byId("offsumsel");for(b=0;b<q.length;b+=1)if(a.options[b].selected){f+="&sumfreq="+q[b];break}c="";a=document.getElementsByName("summaryflags");for(b=0;b<a.length;b+=1)a[b].checked&&(c&&(c+=","),c+=a[b].value);f+="&sumflags="+mor.enc(c);f+="&"+mor.login.authparams();b=u("chgpwd");mor.call(b,"POST",f,function(a){"mid"===h&&v("mid",a[0].token,d);w()},function(a,b){mor.out("setstatdiv","Account settings update failed: "+b)},"",null,[405,412])},g=function(){mor.call("getacct?"+A(),"GET",null,
function(a){if(0<a.length){a=a[0];var b="",f;f="Account settings for $USERNAME";"chgpwd"!==u("chgpwd")&&(window.location.href=mor.secsvr+"#returnto="+mor.enc(mor.mainsvr)+"&command=chgpwd&"+A());mor.profile.cancelPenNameSettings();mor.login.updateAuthentDisplay("hide");f=f.replace("$USERNAME",d);mor.out("centerhdiv",f);b+='<table id="loginform" class="formstyle"><tr><td colspan="3"><div id="setstatdiv"></div></td></tr>';"mid"===h&&(b+='<tr><td align="right">New Password</td><td align="left"><input type="password" id="npin" size="25"/></td><td align="left"><button type="button" id="chgpwbutton">Change Password</button></tr>');
b+='<tr><td align="right">E-mail</td><td align="left"><input type="text" id="emailin" size="25" value="'+(a.email||"")+'"/></td><td align="left"><button type="button" id="updembutton">Update E-mail</button></tr><tr><td align="right">Offline Summary</td><td align="left"><select id="offsumsel">';for(f=0;f<q.length;f+=1)b+='<option id="'+q[f]+'"',a.summaryfreq||(a.summaryfreq="weekly"),a.summaryfreq===q[f]&&(b+=' selected="selected"'),b+=">"+r[f]+"</option>";b+='</select></td></tr><tr><td></td><td colspan="2">'+
mor.checkrad("checkbox","summaryflags","sumiflogin","Send summary even if site visited",a.summaryflags&&0<=a.summaryflags.indexOf("sumiflogin"))+'</td></tr><tr><td></td><td colspan="2">'+mor.checkrad("checkbox","summaryflags","sumifnoact","Send summary even if no reviews from friends",a.summaryflags&&0<=a.summaryflags.indexOf("sumifnoact"))+'</td></tr><tr><td colspan="2" align="center" class="actbuttons"><button type="button" id="cancelbutton">Cancel</button>&nbsp;<button type="button" id="savebutton">Save</button></td></tr><tr><td colspan="3" align="center"><p>MyOpenReviews will not share your email address. </p><p>MyOpenReviews will respect your inbox. </p></td></tr></table>';
mor.out("contentdiv",b);mor.onclick("chgpwbutton",c);mor.onclick("updembutton",c);mor.onclick("cancelbutton",e);mor.onclick("savebutton",c);mor.layout.adjust();mor.byId("emailin").focus()}else mor.err("No account details available")},function(a,b){mor.err("Account details retrieval failed: "+a+" "+b)},"",null,[400,404])},b=function(){var a=mor.byId("userin").value,b=mor.byId("passin").value,f=mor.byId("emailin").value||"",c="",d,g;!a||!b||!a.trim()||!b.trim()?mor.out("maccstatdiv","Please specify a username and password"):
(d=u("newacct"),g=mor.byId("newaccbuttonstd").innerHTML,mor.out("newaccbuttonstd","Creating new account..."),c=mor.objdata({user:a,pass:b,email:f}),mor.call(d,"POST",c,function(b){mor.out("logindiv","<p>Welcome "+a+"! Your account has been created. </p><p>Signing in...</p>");v("mid",b[0].token,a);setTimeout(w,3E3)},function(a,b){mor.out("maccstatdiv",b);mor.out("newaccbuttonstd",g)},""))},a=function(){var a=mor.byId("userin").value;mor.isProbablyEmail(a)&&(mor.byId("emailin").value=a);mor.byId("passin").focus()},
f=function(){var c,f;c=mor.safestr(mor.safeget("userin","value"));f=mor.safestr(mor.safeget("passin","value"));mor.out("logindiv",'<div id="maccstatdiv">Creating a new account</div><table><tr><td align="right"><label for="userin">username</label></td><td align="left"><input type="text" name="username" id="userin" size="20" value="'+c+'"/></td></tr><tr><td align="right"><label for="passin">password</label></td><td align="left"><input type="password" name="password" id="passin" size="20" value="'+f+
'"/></td></tr><tr><td align="right">email</td><td align="left"><input type="text" id="emailin" size="30"/></td><td align="left">&nbsp;(optional - used if you forget your login)</td></tr><tr><td id="newaccbuttonstd" colspan="2" align="center"><button type="button" id="cancelbutton" onclick="mor.login.init();return false;">Cancel</button>&nbsp;<button type="button" id="createbutton" onclick="mor.login.createAccount();return false;">Create</button></td></tr></table>');mor.onchange("userin",a);mor.onchange("passin",
function(){mor.byId("emailin").focus()});mor.onchange("emailin",b);mor.layout.adjust();mor.byId("userin").focus()},s=function(){var a=mor.byId("emailin").value,b="";!a||!a.trim()||!mor.isProbablyEmail(a)?mor.out("emcrediv","Please enter your email address"):(mor.out("sendbuttons","Sending..."),b="email="+mor.enc(a),mor.call("mailcred","POST",b,function(a){a=""+("<p>Your account information has been emailed to <code>"+mor.byId("emailin").value+'</code> and should arrive in a few minutes.  If it doesn\'t show up, please </p><ol><li>Make sure you have entered your email address correctly<li>Check your spam folder to see if the message was filtered out<li>Verify the email address you entered is the same one you used when you created your account.</ol><p>If you did not specify an email address when you created your account, then your login information cannot be retrieved. </p><p><a id="retlogin" href="return to login">return to login</a></p>');
mor.out("logindiv",a);mor.onclick("retlogin",mor.login.init);mor.layout.adjust()},function(a,b){mor.out("emcrediv",b)},""))},D=function(){mor.out("logindiv",'<div id="emcrediv">If you filled out your email address when you created your account, then your username and password can be mailed to you. </div><table><tr><td align="right">email</td><td align="left"><input type="text" id="emailin" size="30"/></td></tr><tr><td colspan="2" align="center" id="sendbuttons"><button type="button" id="cancelbutton">Cancel</button>&nbsp;<button type="button" id="sendbutton">Send</button></td></tr></table>');
mor.onclick("cancelbutton",mor.login.init);mor.onclick("sendbutton",s);mor.onchange("emailin",s);mor.layout.adjust();mor.byId("emailin").focus()},G=function(){var a=mor.byId("userin").value,b=mor.byId("passin").value,c;!a||!b||!a.trim()||!b.trim()?mor.out("loginstatdiv","Please specify a username and password"):(mor.out("loginbspan","Signing in..."),c=u("login"),b=mor.objdata({user:a,pass:b}),mor.call(c,"POST",b,function(b){v("mid",b[0].token,a);w()},function(a,b){mor.out("loginstatdiv","Login failed: "+
b);mor.out("loginbspan",'<button type="button" id="loginbutton" onclick="mor.login.upwlogin();return false;">Sign in</button>')},"",null,[401]))},H=function(a,b){var c;b||(b=mor.parseParams());0<=window.location.href.indexOf("localhost")?mor.err("Not redirecting to main server off localhost. Confusing."):0!==window.location.href.indexOf(mor.mainsvr)?(c=mor.mainsvr+"#command=AltAuth"+ +a,b.reqprof&&(c+="&view=profile&profid="+b.reqprof),setTimeout(function(){window.location.href=c},20)):m[a].authenticate(b)},
I=function(){var a,b,c=[];for(a=0;a<m.length;a+=1)b=m[a].loginDispName||m[a].name,b='<a href="'+m[a].loginurl+'" title="Sign in via '+b+'" onclick="mor.login.altLogin('+a+');return false;"><img class="loginico" src="'+m[a].iconurl+'" border="0"/> </a>',c.push(b);c.shuffle();b="";for(a=0;a<c.length;a+=1)b+='<span class="altauthspan">'+c[a]+"</span>";return b},J=function(a){var b,c="";mor.out("centerhdiv","");if(!mor.byId("logindiv")||!mor.byId("loginform"))c='<div id="logindiv">'+p+"</div>",mor.out("contentdiv",
c);mor.byId("loginform").style.display="block";c="";for(b in a)a.hasOwnProperty(b)&&(c+='<input type="hidden" name="'+b+'" value="'+a[b]+'"/>');a.returnto||(c+='<input type="hidden" name="returnto" value="'+window.location.protocol+"//"+window.location.host+'"/>');mor.out("loginparaminputs",c);a.loginerr&&mor.out("loginstatdiv",a.loginerr);mor.out("sittd","Sign in directly...");mor.out("osacctd","&nbsp;&nbsp;...or with your social account");mor.out("altauthmethods",I());mor.isLowFuncBrowser()||mor.out("loginbtd",
'<div id="signinbuttondiv" onclick="mor.byId(\'loginform\').submit();"><a title="Sign in via secure server">Sign in</a></div>');mor.out("macctd",'<a id="macc" href="create new account..." title="Set up a new local login">Create a new account</a>');mor.onclick("macc",f);mor.out("forgotpwtd",'<a id="forgotpw" href="forgot credentials..." title="Retrieve your credentials using the email address you set for your account">forgot your password?</a>');mor.onclick("forgotpw",D);mor.onchange("userin",function(){mor.byId("passin").focus()});
mor.layout.adjust();d&&(mor.byId("userin").value=d);mor.byId("userin").focus()},O=function(a){"chgpwd"===a.command?mor.login.displayUpdateAccountForm():"helpful"===a.command||"remember"===a.command||"respond"===a.command||"review"===a.view&&a.revid?mor.lcs.getPenFull(a.penid,function(b){mor.profile.verifyStateVariableValues(b.pen);mor.review.initWithId(a.revid,"read",a.command)}):a.url?mor.review.readURL(mor.dec(a.url),a):"string"===typeof a.mid?mor.profile.addMyOpenReviewsAuthId(a.mid):w(a)};return{init:function(){mor.out("contentfill",
"loading login extensions...");p||(p=mor.byId("logindiv").innerHTML);mor.amdtimer.ext={start:new Date};require(["ext/facebook","ext/twitter","ext/googleplus","ext/github"],function(a,b,c,f){mor.amdtimer.ext.end=new Date;mor.out("contentfill"," &nbsp; ");var d,g=mor.amdtimer;d=g.dojo.end.getTime()-g.dojo.start.getTime();mor.log("load dojo: "+d);d=g.mor.end.getTime()-g.mor.start.getTime();mor.log("load mor: "+d);d=g.ext.end.getTime()-g.ext.start.getTime();mor.log("load ext: "+d);mor.facebook||(mor.facebook=
a);mor.twitter||(mor.twitter=b);mor.googleplus||(mor.googleplus=c);mor.github||(mor.github=f);m=[a,b,c,f];b=mor.parseParams();b.authmethod&&(b.am=b.authmethod);b.authtoken&&(b.at=b.authtoken);b.authname&&(b.an=b.authname);b.am&&(b.at&&b.an)&&(b.at=mor.enc(b.at),v(b.am,b.at,b.an));b.logout&&y();b.returnto||x();b.view&&b.profid?mor.historyCheckpoint({view:b.view,profid:b.profid}):b.revedit&&mor.historyCheckpoint({view:"review",mode:"edit",revid:b.revedit});b.command&&0===b.command.indexOf("AltAuth")?
(a=b.command.slice(7),H(a,b)):b.state&&0===b.state.indexOf("AltAuth")?(a=b.state.slice(7,8),H(a,b)):n||l()?O(b):"login"===u("login")?J(b):mor.redirectToSecureServer(b)})},updateAuthentDisplay:function(a){var b="";t||(t=mor.byId("topworkdiv").innerHTML);n&&"hide"!==a?(b='<div id="topactionsdiv"><div id="settingsbuttondiv"></div><table id="topactionstable" border="0"><tr><td><div id="homepenhdiv"></div></td><td><div id="recentacthdiv">'+mor.activity.activityLinkHTML()+'</div></td></tr><tr><td><div id="writerevhdiv">'+
mor.review.reviewLinkHTML()+'</div></td><td><div id="rememberedhdiv">'+mor.activity.rememberedLinkHTML()+"</div></td></tr></table></div>",mor.out("topworkdiv",b),mor.byId("logoimg")||mor.out("logodiv",'<img src="img/slides/logoMOR.png" id="logoimg" border="0"/>'),mor.byId("logoimg").style.width="260px",mor.byId("logoimg").style.height="120px",mor.byId("logodiv").style.width="260px",mor.byId("topsectiondiv").style.height="120px",mor.byId("topworkdiv").style.marginLeft="280px",mor.byId("mascotdiv").style.top=
"135px",mor.layout.setTopPaddingAndScroll(250)):"hide"===a?mor.out("topworkdiv",""):mor.out("topworkdiv",t)},displayUpdateAccountForm:function(){g()},authparams:function(){return A()},readAuthCookie:function(){return l()},logout:function(){var a;y();mor.profile.cancelPenNameSettings();mor.historyCheckpoint({view:"profile",profid:0});t="&nbsp;";mor.login.updateAuthentDisplay();mor.byId("logindiv")||(a='<div id="logindiv">'+p+"</div>",mor.out("contentdiv",a));mor.login.init()},altLogin:function(a){H(a)},
upwlogin:function(){G()},setAuth:function(a,b,c){v(a,b,c)},authComplete:function(){w()},createAccount:function(){b()},getAuthMethod:function(){return h},loginInfoHTML:function(){var a;switch(h){case "mid":a="img/iconMOR.png";break;case "fbid":a=mor.facebook.iconurl;break;case "twid":a=mor.twitter.iconurl;break;case "gsid":a=mor.googleplus.iconurl;break;case "ghid":a=mor.github.iconurl}return'<img class="loginico" src="'+a+'" /> <em>'+d+'</em> &nbsp; <a href="logout" id="logout" onclick="mor.login.logout();return false;">Sign out</a>&nbsp;|&nbsp;<a href="#AccountSettings" id="accset" onclick="mor.login.displayUpdateAccountForm();return false;">Account settings</a>'}}});
define("amd/review",[],function(){var h="",n="",d={},t=!1,m="",p=null,q=null,r=null,u=[{type:"book",plural:"books",img:"TypeBook50.png",keyprompt:"Title",key:"title",subkey:"author",fields:["publisher","year"],dkwords:"Fluff;Heavy;Kid Ok;Educational;Funny;Suspenseful;Gripping;Emotional;Complex;Historical".split(";")},{type:"movie",plural:"movies",img:"TypeMovie50.png",keyprompt:"Movie name",key:"title",fields:["year","starring"],dkwords:"Fluff;Light;Heavy;Kid Ok;Educational;Cult;Classic;Drama;Escapism;Funny;Suspenseful".split(";")},
{type:"video",plural:"videos",img:"TypeVideo50.png",keyprompt:"Title",key:"title",fields:["artist"],dkwords:"Light;Heavy;Kid Ok;Educational;Funny;Cute;Artistic;Disturbing".split(";")},{type:"music",plural:"music",img:"TypeSong50.png",keyprompt:"Title",key:"title",subkey:"artist",fields:["album","year"],dkwords:"Light Heavy Wakeup Travel Office Workout Dance Social Sex".split(" ")},{type:"food",plural:"food",img:"TypeFood50.png",keyprompt:"Name of restaurant or dish",key:"name",fields:["address"],
dkwords:"Breakfast;Brunch;Lunch;Dinner;Late Night;Snack;Inexpensive;Expensive;Fast;Slow;Outdoor;Quiet;Loud".split(";")},{type:"drink",plural:"drinks",img:"TypeDrink50.png",keyprompt:"Name and where from",key:"name",fields:["address"],dkwords:"Traditional Innovative Inexpensive Expensive Essential Special Quiet Loud Outdoor".split(" ")},{type:"activity",plural:"activities",img:"TypeActivity50.png",keyprompt:"Name of activity, place, or event",key:"name",fields:["address"],dkwords:"Indoor;Outdoor;Educational;Artistic;Kid Ok;Inexpensive;Expensive".split(";")},
{type:"other",plural:"other",img:"TypeOther50.png",keyprompt:"Name or title",key:"name",fields:[],dkwords:"Specialized General Professional Personal Hobby Research".split(" ")}],A=function(a,b){var k={},c,f="No stars;Half a star;One star;One and a half stars;Two stars;Two and a half stars;Three stars;Three and a half stars;Four stars;Four and a half stars;Five stars".split(";");"string"===typeof a&&(a=parseInt(a,10));if(!a||"number"!==typeof a||0>a)a=0;93<a&&(a=100);c=Math.floor(a*(f.length-1)/100);
b&&(c=Math.min(c+1,f.length-1),a=Math.floor(100*(c/(f.length-1))));k.value=a;k.step=c;k.maxstep=f.length-1;k.title=f[c];k.roundnum=[0,0.5,1,1.5,2,2.5,3,3.5,4,4.5,5][c];k.asterisks="0 + * *+ ** **+ *** ***+ **** ****+ *****".split(" ")[c];k.unicode="0 \u00bd \u2605 \u2605\u00bd \u2605\u2605 \u2605\u2605\u00bd \u2605\u2605\u2605 \u2605\u2605\u2605\u00bd \u2605\u2605\u2605\u2605 \u2605\u2605\u2605\u2605\u00bd \u2605\u2605\u2605\u2605\u2605".split(" ")[c];return k},y=function(a,b,k){var c,f,d=k||"starsimg";
c=A(a);a=Math.floor(c.step*(85/c.maxstep));f=""+('<img id="fillstarsimg" class="'+d+'" src="img/blank.png" style="width:'+a+"px;height:15px;background:url('img/stars18ptC.png');\" title=\""+c.title+'" alt="'+c.title+'"/>');b?1===c.step%2?(b=Math.floor(85/c.maxstep),f+='<img id="greystarsimg" class="'+d+'" src="img/blank.png" style="width:'+(85-a)+"px;height:15px;background:url('img/stars18ptCg.png') -"+b+'px 0;" title="'+c.title+'" alt="'+c.title+'"/>'):f+='<img id="greystarsimg" class="'+d+'" src="img/blank.png" style="width:'+
(85-a)+"px;height:15px;background:url('img/stars18ptCg.png');\" title=\""+c.title+'" alt="'+c.title+'"/>':k||(f=f+('<img class="'+d+'" src="img/blank.png" style="width:'+(85-a)+'px;height:15px;"/>')+('<img class="'+d+'" src="img/blank.png" style="width:10px;height:15px;"/>'));return f},x=function(a,b,k){var c=a.plural.capitalize(),f="";a.img&&(f='<img class="reviewbadge" src="img/'+a.img+'" title="'+c+'" alt="'+c+'"/>',b&&(k&&(c='<span style="color:#999999;">'+c+"</span>"),f+=c));return f},w=function(a,
b,k,c,f){var d,g=0,B,l,e,s="<table>";for(d=0;d<u.length;d+=1){l=u[d].type;B=!1;if(f&&(!f[l]||0===f[l].length))B=!0;B=x(u[d],!0,B);e=u[d].plural;l=l===k;0===g&&(s+="<tr>");s+="<td>"+mor.checkrad(a,b,e,B,l,c)+"</td>";g+=1;if(4===g||d===u.length-1)s+="</tr>",g=0}return s+"</table>"},v=function(a){var b;if(!a)return null;a=a.toLowerCase();for(b=0;b<u.length;b+=1)if(u[b].type===a||u[b].plural===a)return u[b];return u[u.length-1]},l=function(a,b){var k;if(!a||!a[b])return"";k=a[b].split(",").length;if(!k)return"";
9<k&&(k="+");return"<span style=\"background:url('img/"+{helpful:"cbbh.png",remembered:"cbbr.png",corresponding:"cbbw.png"}[b]+'\') no-repeat center center; height:15px; width:22px; display:inline-block; text-align:center;" title="'+k+" "+b+'">'+k+"</span>"},e=function(a){a.newrev&&(d.revtype=mor.dec(a.newrev));a.name&&(d.name=mor.dec(a.name));a.title&&(d.title=mor.dec(a.title));a.artist&&(d.artist=mor.dec(a.artist));a.author&&(d.author=mor.dec(a.author));a.publisher&&(d.publisher=mor.dec(a.publisher));
a.album&&(d.album=mor.dec(a.album));a.starring&&(d.starring=mor.dec(a.starring));a.address&&(d.address=mor.dec(a.address));a.year&&(d.year=mor.dec(a.year));a.imguri&&(d.imguri=mor.dec(a.imguri))},c=function(a,b){0<a.indexOf(".amazon.")?require(["ext/amazon"],b):require(["ext/readurl"],b)},g=function(a,b){var k=mor.byId("reviewtext");k&&(d.text=k.value)},b=function(a,b){var k,f=[];b||(b={});if(!a&&(k=mor.byId("urlin")))a=k.value;g(d.revtype,f);if(a&&!(0<f.length)){if(k=mor.byId("readurlbuttoncontainer"))k.innerHTML=
"reading...";a?(d.url=h=a,e(b),c(h,function(k){k.fetchData(d,a,b)})):mor.review.display()}},a=function(){var a,b=0,k,c;c='<div id="revfdiv" class="formstyle" align="center"><div id="formrejustifydiv" class="centertablediv"><ul class="reviewformul"><li><table border="0"><tr><td colspan="4"><div class="bigoverlabel">Choose a review type</div></td></tr>';for(a=0;a<u.length;a+=1)if(0===b&&(c+="<tr>"),k=u[a].type.capitalize(),c+='<td><div class="revtypeselectiondiv">'+mor.imgntxt(u[a].img,k,"mor.review.setType('"+
u[a].type+"')","#"+k,"Create a "+u[a].type+" review")+"</div></td>",b+=1,4===b||a===u.length-1)c+="</tr>",b=0;c+="</table></li>";c=h?c+('<li><a href="'+h+'">'+h+"</a></li>"):c+'<li><table border="0"><tr><td colspan="2"><div class="bigoverlabel">or paste a web address to read information from</div></td></tr><tr><td align="right">URL</td><td align="left"><input type="text" id="urlin" size="40" onchange="mor.review.readURL();return false;"/>&nbsp;<span id="readurlbuttoncontainer"><button type="button" id="readurlbutton" onclick="mor.review.readURL();return false;" title="Read review form fields from pasted URL">Read</button></span></td></tr></table></li>';
c+="</ul></div></div>";mor.byId("cmain")||mor.layout.initContent();mor.out("cmain",c);mor.layout.adjust()},f=function(){var a;a="";var b=mor.instId(d);if(b)a+=mor.paramsToFormInputs(mor.login.authparams()),a=a+('<input type="hidden" name="_id" value="'+b+'"/>')+('<input type="hidden" name="penid" value="'+d.penid+'"/>'),a+='<input type="hidden" name="returnto" value="'+mor.enc(window.location.href+"#revedit="+b)+'"/>',a='<form action="/revpicupload" enctype="multipart/form-data" method="post"><div id="closeline"><a id="closedlg" href="#close" onclick="mor.cancelPicUpload();return false">&lt;close&nbsp;&nbsp;X&gt;</a></div>'+
a+'<table><tr><td>Upload Review Pic</td></tr><tr><td><input type="file" name="picfilein" id="picfilein"/></td></tr><tr><td align="center"><input type="submit" value="Upload"/></td></tr></form>',mor.out("overlaydiv",a),a=mor.byId("overlaydiv"),a.style.top="300px",a.style.visibility="visible",a.style.backgroundColor=mor.skinner.lightbg(),mor.onescapefunc=mor.cancelPicUpload,mor.byId("picfilein").focus();else if(a=mor.byId("revformbuttonstd").innerHTML,0<=a.indexOf("<button"))return mor.review.save(!1,
"uploadpic")},s=function(a){if(a=mor.byId(a))a.style.color="red",0>a.innerHTML.indexOf("*")&&(a.innerHTML+="*")},D=function(a){var b;a||(a="");b=a.capitalize();"url"===a&&(b='<img class="webjump" src="img/gotolink.png"/>URL');return b},G=function(a){return!a?"":'<a href="'+a+'" onclick="window.open(\''+a+'\');return false;" title="'+a+'"><img class="webjump" src="img/gotolink.png"/></a>'},H=function(){var a=mor.byId("urlin");h&&(d.url=h,h="");a&&(d.url=a.value)},I=function(a,b){var k,c=mor.byId("keyin");
!c||!c.value?(s("keyinlabeltd"),b.push("Please specify a value for "+a.key)):(d[a.key]=c.value,k=d[a.key]);a.subkey&&(c=mor.byId("subkeyin"),!c||!c.value?(s("subkeyinlabeltd"),b.push("Please specify a value for "+a.subkey)):(d[a.subkey]=c.value,k+=d[a.subkey]));k&&(d.cankey=mor.canonize(k))},J=function(a,b,k){var c,f;for(f=0;f<a.fields.length;f+=1)if(c=mor.byId("field"+f))d[a.fields[f]]=c.value;d.rating||(a="Please set a star rating","uploadpic"===k&&(a+=" before uploading a picture"),b.push(a))},
O=function(a,b){var k=mor.byId("keywordin");k&&(d.keywords=k.value)},Q=function(a){var b='<div id="socialrevactdiv"><table class="socialrevacttable" border="0"><tr>';a?(b+='<td><div id="helpfulbutton" class="buttondiv">'+mor.imgntxt("helpfulq.png","Helpful","mor.review.helpful()","#helpful","Mark this review as helpful","","helpful")+"</div></td>",b+='<td><div id="memobutton" class="buttondiv">'+mor.imgntxt("rememberq.png","Remember","mor.review.memo()","#memo","Add this to remembered reviews","",
"memo")+"</div></td>",b+='<td><div id="respondbutton" class="buttondiv">'+mor.imgntxt("writereview.png","Your review","mor.review.respond()","#respond","Edit your corresponding review","","respond")+"</div></td>"):b+='<td><img class="shareicodis" src="img/helpful.png" border="0"/></td><td><img class="shareicodis" src="img/remembered.png" border="0"/></td><td><img class="shareicodis" src="img/writereview.png" border="0"/></td>';return b+='</tr><tr><td><div id="hlinksdiv" class="linksdiv"></div></td><td><div id="rlinksdiv" class="linksdiv"></div></td><td><div id="clinksdiv" class="linksdiv"></div></td></tr></table></div>'},
L=function(){var a=Math.max(mor.winw-350,200);return a=Math.min(a,750)},E=function(a,b,k){if(!a||a.pageX)return mor.dojo.domgeo.position(b);k||(k={h:b.offsetHeight,w:b.offsetWidth,x:0,y:0});k.x+=b.offsetLeft;k.y+=b.offsetTop;return b.offsetParent?E(a,b.offsetParent,k):k},F=function(a){var b;if(a.pageX)return{x:a.pageX,y:a.pageY};b={h:-1,w:-1,x:a.offsetX,y:a.offsetY};(b=E(a,a.srcElement,b))||(b={x:a.offsetX,y:a.offsetY});return b},M=function(a,b){var k,c,f;k=mor.byId("stardisp");k=E(a,k);c=F(a).x;
a.changedTouches&&a.changedTouches[0]&&(c=F(a.changedTouches[0]).x);f=Math.max(c-k.x,0);100<f?setTimeout(function(){var a=c,b,k="";t=!1;for(b=0;100>=b;b+=10)k+='<div class="ratingmenudiv" id="starsel'+b+'" onclick="mor.review.ratmenusel('+b+');return false;">'+y(b)+"</div>";mor.out("overlaydiv",k);b=mor.byId("overlaydiv");b.style.top="100px";b.style.left=String(Math.round(a+50))+"px";b.style.visibility="visible";b.style.backgroundColor=mor.skinner.lightbg();mor.onescapefunc=mor.cancelPicUpload},20):
(k=Math.min(Math.round(100*(f/k.w)),100),b&&(k=A(k,!0).value),d.rating=k,k=y(d.rating,!0),mor.out("stardisp",k))},R=function(a){t=!0;M(a,!0)},N=function(a){t=!1},U=function(a){var b,k,c;b=mor.byId("starstd");b=E(a,b);k=F(a);c=k.x;k=k.y;a.changedTouches&&a.changedTouches[0]&&(k=F(a.changedTouches[0]),c=k.x,k=k.y);if(c<b.x||c>b.x+b.w||k<b.y||k>b.y+b.h)t=!1},K=function(a){t&&M(a)},V=function(a){M(a,!0)},k=function(a,b){var k,c,f=null;c="<"+a+">";k=b.indexOf(c);0<=k&&(b=b.slice(k+c.length),c="</"+a+">",
k=b.indexOf(c),0<=k&&(f={content:b.slice(0,k),remainder:b.slice(k+c.length)}));return f},B=function(a,b){var c=k(a,b);c&&(c=c.content.trim());return c?"&nbsp;<i>"+c+"</i>":""},z=function(a){var b;b="amazonsearch?revtype="+d.revtype+"&search="+mor.enc(m);mor.call(b,"GET",null,function(b){var c=mor.dec(b[0].content),f,g,l;b="<ul>";for(c=k("Item",c);c;)f=k("DetailPageURL",c.content),f=f.content||"",g=k("ItemAttributes",c.content),l=k("Title",g.content),(l=l.content||"")&&("book"===d.revtype?l+=B("Author",
g.content):"movie"===d.revtype?l+=B("ProductGroup",g.content):"music"===d.revtype&&(l+=B("Artist",g.content)+" "+B("Manufacturer",g.content)+B("ProductGroup",g.content))),b+='<li><a href="'+f+'" onclick="mor.review.readURL(\''+f+"');return false;\">"+l+"</a></li>",c=k("Item",c.remainder);mor.out("revautodiv",b+"</ul>");setTimeout(a,400);mor.layout.adjust()},function(b,k){mor.out("revautodiv","");mor.log("Amazon info retrieval failed code "+b+": "+k);setTimeout(a,400);mor.layout.adjust()},"")},C=function(a,
k){var c;if(!r&&google&&google.maps&&google.maps.places)try{c=new google.maps.Map(mor.byId("mapdiv"),{mapTypeId:google.maps.MapTypeId.ROADMAP,center:a,zoom:15}),r=new google.maps.places.PlacesService(c)}catch(f){mor.err("selectLocLatLng svc init failed: "+f)}r&&k&&r.getDetails({reference:k},function(a,k){k===google.maps.places.PlacesServiceStatus.OK&&(d.address=a.formatted_address,d.name=a.name||mor.byId("keyin").value,d.url=d.url||a.website||"",b(d.url))})},fa=function(a,b){!q&&(google&&google.maps&&
google.maps.places)&&(q=new google.maps.Geocoder);if(q&&a)try{a=mor.dec(a),mor.out("revautodiv","<p>"+a+'</p><div id="mapdiv"></div>'),q.geocode({address:a},function(a,k){k===google.maps.places.PlacesServiceStatus.OK&&C(a[0].geometry.location,b)})}catch(k){mor.err("selectLocation failed: "+k)}},ga=function(a){!p&&(google&&google.maps&&google.maps.places)&&(p=new google.maps.places.AutocompleteService);p&&m?p.getPlacePredictions({input:m},function(b,k){var c,f,d="<ul>";if(k===google.maps.places.PlacesServiceStatus.OK)for(c=
0;c<b.length;c+=1)f=b[c],d+='<li><a href="#selectloc" onclick="mor.review.selectloc(\''+mor.embenc(f.description)+"','"+f.reference+"');return false;\">"+f.description+"</a></li>";mor.out("revautodiv",d+'</ul><img src="img/poweredbygoogle.png"/>');setTimeout(a,400);mor.layout.adjust()}):setTimeout(a,400)},S=function(a){mor.byId("revautodiv")&&mor.byId("keyin")&&(a=mor.byId("keyin").value,mor.byId("subkeyin")&&(a+=" "+mor.byId("subkeyin").value),a!==m?(m=a,"book"===d.revtype||"movie"===d.revtype?z(S):
("food"===d.revtype||"drink"===d.revtype||"activity"===d.revtype)&&ga(S)):setTimeout(S,750))},ha=function(a,b){var k;k="Your review";b&&(setTimeout(function(){mor.lcs.verifyCorrespondingLinks(b,d)},100),k=y(b.rating,!1,"inlinestarsimg"),k="Your review: "+k);k=mor.imgntxt("writereview.png",k,"mor.review.respond()","#respond","Edit your corresponding review","","respond");mor.out("respondbutton",k)},Y=function(a,b){var k,c;if(a.top20s&&(c=a.top20s[d.revtype])&&c.length)for(k=0;k<c.length;k+=1)if(c[k].cankey===
d.cankey&&c[k].revtype===d.revtype)return b(a,c[k]);k="penid="+mor.instId(a)+"&revtype="+d.revtype+"&cankey="+d.cankey+"&"+mor.login.authparams();mor.call("revbykey?"+k,"GET",null,function(k){var c=null;0<k.length&&(c=k[0]);b(a,c)},function(a,b){mor.err("findCorrespondingReview failed "+a+" "+b)},"")},W=function(a,b){var k,c,f,d;f=mor.instId(b[0]);c=mor.pen.currPenRef();if(c[a]){for(k=0;k<c[a].length;k+=1)mor.instId(c[a][k])===f&&(c[a][k]=b[0],d=!0);d||c[a].unshift(b[0])}else c[a]=b;"remembered"===
a&&W("helpful",b);mor.lcs.getRevRef(b[0].revid).revlink=null},Z=function(a){var b,k;if(b=mor.byId("helpfulimg"))k=mor.byId("helpfultable"),"set"===a?(b.src="img/helpful.png",k.title="Remove mark as helpful"):(b.className="navicodis",a=0<b.src.indexOf("helpful.png")?"no":"yes",a="penid="+mor.instId(mor.pen.currPenRef().pen)+"&revid="+mor.instId(d)+"&helpful="+a,mor.call("notehelpful?"+mor.login.authparams(),"POST",a,function(a){W("helpful",a);a[0]&&a[0].helpful&&!a[0].nothelpful?(b.src="img/helpful.png",
k.title="Remove mark as helpful"):(b.src="img/helpfulq.png",k.title="Mark this review as helpful");b.className="navico"},function(a,b){mor.err("toggleHelpfulButton failed "+a+" "+b)},""))},$=function(a,b){var k;b||(b=mor.pen.currPenRef());for(k=0;b.helpful&&k<b.helpful.length;k+=1)if(b.helpful[k].revid===a&&b.helpful[k]&&b.helpful[k].helpful&&!b.helpful[k].nothelpful)return!0;return!1},aa=function(a,b){var k;b||(b=mor.pen.currPenRef());k="penid="+mor.instId(b.pen)+"&"+mor.login.authparams();mor.call("srchhelpful?"+
k,"GET",null,function(k){b.helpful=k;a()},function(a,b){mor.err("initHelpfulButtonSetting failed "+a+" "+b)},"")},ba=function(a,b){a.helpful?$(mor.instId(b),a)&&Z("set"):aa(function(){ba(a,b)},a)},ca=function(a){var b,k;if(b=mor.byId("memoimg"))k=mor.byId("memotable"),"set"===a?(b.src="img/remembered.png",k.title="Remove from your remembered reviews",mor.out("memotxttd","Remembered")):(b.className="navicodis",a=0<b.src.indexOf("remembered.png")?"no":"yes",a="penid="+mor.instId(mor.pen.currPenRef().pen)+
"&revid="+mor.instId(d)+"&remember="+a,mor.call("noteremem?"+mor.login.authparams(),"POST",a,function(a){W("remembered",a);a[0]&&a[0].remembered&&!a[0].forgotten?(b.src="img/remembered.png",k.title="Remove from your remembered reviews",mor.out("memotxttd","Remembered")):(b.src="img/rememberq.png",k.title="Add to your remembered reviews",mor.out("memotxttd","Remember"));b.className="navico"},function(a,b){mor.err("toggleMemoButton failed "+a+" "+b)},""))},da=function(a,b){var k,c;if(a.remembered){c=
mor.instId(b);for(k=0;k<a.remembered.length;k+=1)if(a.remembered[k].revid===c&&a.remembered[k]&&a.remembered[k].remembered&&!a.remembered[k].forgotten){ca("set");break}}else k="penid="+mor.instId(a.pen)+"&"+mor.login.authparams(),mor.call("srchremem?"+k,"GET",null,function(k){a.remembered=k;da(a,b)},function(a,b){mor.err("initMemoButtonSetting failed "+a+" "+b)},"")},T=function(){var a=["hlinksdiv","rlinksdiv","clinksdiv"],b=["helpful","remembered","corresponding"],k=mor.lcs.getRevRef(d),c,f,g,B,
l,e,s,z;if(!k.revlink)return mor.lcs.verifyReviewLinks(T);c="";for(f=0;f<a.length;f+=1)if(g=k.revlink[b[f]]){g=g.split(",");for(B=0;B<g.length;B+=1){l=0;e=g[B];0<e.indexOf(":")&&(e=e.split(":"),l=e[0],e=e[1]);z=mor.lcs.getPenRef(e);if("not cached"===z.status)return mor.lcs.getPenFull(e,T);if(l&&(s=mor.lcs.getRevRef(l),"not cached"===s.status))return mor.lcs.getRevFull(l,T);if(z.pen&&z.pen!==mor.pen.currPenRef().pen){c&&(c+=", ");l=s;var C=e=e=void 0,h=void 0;e=z.pen;C={helpful:"$Name found this review helpful",
remembered:"$Name remembered this review",corresponding:"$Name also reviewed this"}[b[f]].replace("$Name",mor.ndq(e.name));h="mor.profile.byprofid('"+mor.instId(e)+"')";l&&(h="mor.profile.readReview('"+mor.instId(l.rev)+"')");e='<a href="#'+mor.ndq(e.name)+'" onclick="'+h+';return false;" title="'+C+'">'+e.name+"</a>";c+=e}}mor.out(a[f],c);c=""}},ia=function(a,b){mor.byId("helpfulbutton")&&ba(mor.pen.currPenRef(),b);mor.byId("memobutton")&&da(mor.pen.currPenRef(),b);mor.byId("respondbutton")&&mor.pen.getPen(function(a){Y(a,
ha)});mor.byId("hlinksdiv")&&T();mor.byId("revautodiv")&&(m="",S());mor.byId("sharediv")&&mor.services.displayShare("sharebuttonsdiv","sharemsgdiv",a,b)},X=function(a,b,k,c){var f,g,B,l;g=v(b.revtype);B=b[g.key];f='<div class="formstyle" style="width:'+(L()+100)+'px;"><table class="revdisptable" border="0">';"edit"===k&&n&&(f+='<tr><td colspan="4"><div id="attributiondiv">'+n+"</div></td></tr>");var e="",s,z;"edit"===k&&(e+='<tr><td id="starslabeltd"></td><td id="keyinlabeltd">'+D(g.keyprompt)+"</td><td>"+
D(B?"url":g.subkey)+"</td></tr>");e+='<tr><td id="starstd">';B&&(e+='<span id="stardisp">'+y(b.rating,"edit"===k)+"</span>");e+="&nbsp;"+x(g)+"</td>";"edit"===k?(s="mor.review.validate();return false;",g.subkey&&(s="mor.byId('subkeyin').focus();return false;"),z=b[g.key]||"",e+='<td><input type="text" id="keyin" size="30" onchange="'+s+'" value="'+z+'"></td>',B?(z=b.url||"",e+='<td><input type="text" id="urlin" size="30" value="'+z+'"/></td>'):g.subkey&&(z=b[g.subkey]||"",e+='<td id="subkeyinlabeltd"><input type="text" id="subkeyin" size="30" onchange="mor.review.validate();return false;" value="'+
z+'"/></td>')):(z=b[g.key]||"",e+='<td><span class="revtitle">'+z+"</span></td>",g.subkey&&(z=b[g.subkey]||"",e+='<td><span class="revauthor">'+z+"</span></td>"),"url"!==g.key&&"url"!==g.subkey&&(z=b.url||"",e+="<td>"+G(z)+"</td>"));f+=e+"</tr>";e='<tr><td colspan="4" class="textareatd">';B?(s=b.text||"",l=L(),l="color:"+mor.colors.text+";background-color:"+mor.skinner.lightbg()+";width:"+l+"px;height:100px;padding:2px 5px;","edit"===k?e+='<textarea id="reviewtext" class="shoutout" placeholder=">>What was the most striking thing about this for you?" style="'+
(l+"margin-left:50px;")+'">'+s+"</textarea>":(s=s||"No comment",l+="border:1px solid "+mor.skinner.darkbg()+";overflow:auto;margin:auto",e+='<div id="reviewtext" class="shoutout" style="'+l+'">'+mor.linkify(s)+"</div>")):e+='<div id="revautodiv" class="autocomplete" style="width:'+l+'px;"> </div>';l=f+=e+"</td></tr>";B?(f="",mor.isLowFuncBrowser()&&(f=' style="width:125px;height:auto;"'),b.imguri?(e='<img class="revimg"'+f+' src="'+b.imguri+'"/>',b.url&&(e='<a href="'+b.url+'" onclick="window.open(\''+
b.url+"');return false;\">"+e+"</a>"),"edit"===k&&(e+='<br/><a href="#remove image link" onclick="mor.review.removeImageLink();return false;">remove image</a>')):(e="","edit"===k&&(e="img/emptyprofpic.png"),b.revpic&&(e="revpic?revid="+mor.instId(b)),e='<img class="revimg"'+f+' src="'+e+'"',"edit"===k&&(e+=' title="Click to upload a picture" onclick=mor.review.picUploadForm();return false;'),e+="/>"),f=e):f="";f='<tr><td align="right" rowspan="3" valign="top">'+f+'</td><td colspan="2"><table class="subtable" border="0" width="100%"><tr><td valign="top">';
var e="",C;if(B){e+="<table>";"edit"===k&&g.subkey&&(z=g.subkey,C=b[g.subkey]||"",e+='<tr><td id="subkeyinlabeltd"><span class="secondaryfield">'+z.capitalize()+'</span></td><td align="left"><input type="text" id="subkeyin" size="25" value="'+C+'"/></td></tr>');for(s=0;s<g.fields.length;s+=1)if(z=g.fields[s],C=b[z]||"","url"!==z){if(C||"edit"===k)e+='<tr><td><span class="secondaryfield">'+z.capitalize()+"</span></td>";e="edit"===k?e+('<td align="left"><input type="text" id="field'+s+'" size="25" value="'+
C+'"/></td>'):e+("<td>"+C+"</td>");e+="</tr>"}e+="</table>"}f=f+e+'</td><td valign="top">';e="";if(B)if("edit"===k){z=0;d.keywords||(d.keywords="");C="<table>";for(s=0;s<g.dkwords.length;s+=1)if(0===z&&(C+="<tr>"),C+='<td style="white-space:nowrap;"><input type="checkbox" name="dkw'+s+'" id="dkw'+s+'" value="'+g.dkwords[s]+'" onclick="mor.review.toggleKeyword(\'dkw'+s+"');\"",0<=d.keywords.indexOf(g.dkwords[s])&&(C+=' checked="checked"'),C+='/><label for="dkw'+s+'">'+g.dkwords[s]+"</label></td>",
z+=1,3===z||s===g.dkwords.length-1)C+="</tr>",z=0;e+=C+'</table><span class="secondaryfield">Keywords</span> <input type="text" id="keywordin" size="30" value="'+mor.safestr(b.keywords)+'"/>'}else mor.safestr(b.keywords)&&(e+='<div class="csvstrdiv"><span class="secondaryfield">Keywords</span> '+mor.safestr(b.keywords)+"</div>");f=l+(f+e+"</td></tr></table></td></tr>");l="";B&&"edit"===k&&("video"===b.revtype&&(b.title&&b.artist)&&(l+='<a href="#" title="Swap the artist and title values" onclick="mor.review.swapVidTitleAndArtist();return false;">Swap title and artist</a>&nbsp;&nbsp;&nbsp;'),
"video"===b.revtype&&(l+='<a href="#" title="Review this as music" onclick="mor.review.changeReviewType(\'music\');return false;">Review as music</a>&nbsp;&nbsp;&nbsp;'),"music"===b.revtype&&(l+='<a href="#" title="Review this as video" onclick="mor.review.changeReviewType(\'video\');return false;">Review as video</a>&nbsp;&nbsp;&nbsp;'),b.url&&(l+='<a href="#" title="Read the URL to fill out review fields" onclick="mor.review.readURL(\''+b.url+"');return false;\">Read review details from URL</a>&nbsp;&nbsp;&nbsp;"));
l&&(f+='<tr><td colspan="3" id="transformactionstd">'+l+"</td></tr>");l=f;B?"edit"===k?(mor.onescapefunc=mor.review.reset,f='<div id="revbuttonsdiv"><button type="button" id="cancelbutton" onclick="mor.review.reset('+(mor.instId(b)?"false":"true")+');return false;">Cancel</button>&nbsp;<button type="button" id="savebutton" onclick="mor.review.save(true,\'\');return false;">Save</button>&nbsp;</div>'):b.penid===mor.pen.currPenId()?(mor.onescapefunc=null,f="statrev/"+mor.instId(b),f='<div id="revbuttonsdiv"><button type="button" id="deletebutton" onclick="mor.review.delrev();return false;">Delete</button>&nbsp;<button type="button" id="editbutton" onclick="mor.review.display();return false;">Edit</button>&nbsp;&nbsp;<a href="'+
f+'" class="permalink" onclick="window.open(\''+f+'\');return false;">permalink</a></div><div id="sharediv"><div id="sharebuttonsdiv"></div><div id="sharemsgdiv"></div></div>'+Q(!1)):f=Q(!0):(mor.onescapefunc=mor.review.reset,f='<div id="revbuttonsdiv"><button type="button" id="cancelbutton" onclick="mor.review.reset(true);return false;">Cancel</button>&nbsp;<button type="button" id="savebutton" onclick="mor.review.validate();return false;">Create Review</button></div>');f=l+('<tr><td colspan="3" id="revformbuttonstd">'+
(f+'<br/><div id="revsavemsg"></div>')+"</td></tr></table></div>");mor.byId("cmain")||mor.layout.initContent();mor.out("cmain",f);"edit"===k&&(mor.onx("mousedown","starstd",R),mor.onx("mouseup","starstd",N),mor.onx("mouseout","starstd",U),mor.onx("mousemove","starstd",K),mor.onx("click","starstd",V),mor.onx("touchstart","starstd",R),mor.onx("touchend","starstd",N),mor.onx("touchcancel","starstd",N),mor.onx("touchmove","starstd",K),B?mor.byId("subkeyin")&&!b[g.subkey]?mor.byId("subkeyin").focus():
mor.byId("reviewtext").focus():mor.byId("keyin").focus());mor.layout.adjust();c&&mor.out("revsavemsg",c);ia(a,b)},P=null,ja=function(){P=setTimeout(function(){var a,b="",k=[];P=null;if(a=v(d.revtype))if(I(a,k),0<k.length){for(a=0;a<k.length;a+=1)b+=k[a]+"<br/>";mor.out("revsavemsg",b);return}mor.review.display()},400)},ka=function(a,b){var k=[],c,f="",e;e=mor.byId("revformbuttonstd").innerHTML;mor.out("revformbuttonstd","Verifying...");if(c=v(d.revtype))if(H(),I(c,k),J(c,k,b),O(c,k),g(c,k),0<k.length){mor.out("revformbuttonstd",
e);for(c=0;c<k.length;c+=1)f+=k[c]+"<br/>";mor.out("revsavemsg",f)}else mor.out("revformbuttonstd","Saving..."),mor.onescapefunc=null,k="updrev?",mor.instId(d)||(k="newrev?",d.svcdata=""),f=mor.objdata(d),mor.call(k+mor.login.authparams(),"POST",f,function(k){d=mor.lcs.putRev(k[0]).rev;setTimeout(mor.pen.refreshCurrent,50);setTimeout(function(){mor.lcs.checkAllCorresponding(d)},200);a?(n="",mor.review.displayRead(b)):mor.review.display(b)},function(a,b){mor.log("saveReview failed code: "+a+" "+b);
mor.review.display()},"");else mor.out("revformbuttonstd",e),mor.out("revsavemsg","Unknown review type")},la=function(a,b,k,c){mor.call("revbyid?revid="+a,"GET",null,function(f){0<f.length?(d=f[0],"edit"===b?mor.review.display(k,c):mor.review.displayRead(k)):mor.err("initWithId found no review id "+a)},function(a,b){mor.err("initWithId failed code "+a+": "+b)},"")},ma=function(a,b){b||(b={},b.srcrev=mor.instId(d),b.penid=mor.instId(a),b.revtype=d.revtype,b.rating=d.rating,b.cankey=d.cankey);d.imguri&&
(!b.imguri&&!b.revpic)&&(b.imguri=d.imguri);d.revpic&&(!b.imguri&&!b.revpic)&&(b.imguri="revpic?revid="+mor.instId(d));d.name&&!b.name&&(b.name=d.name);d.title&&!b.title&&(b.title=d.title);d.url&&!b.url&&(b.url=d.url);d.artist&&!b.artist&&(b.artist=d.artist);d.author&&!b.author&&(b.author=d.author);d.publisher&&!b.publisher&&(b.publisher=d.publisher);d.album&&!b.album&&(b.album=d.album);d.starring&&!b.starring&&(b.starring=d.starring);d.address&&!b.address&&(b.address=d.address);d.year&&!b.year&&
(b.year=d.year);d=b;mor.review.display()},na=function(){var a;d&&window.confirm("Are you sure you want to delete this review?")&&(mor.out("cmain","Deleting review..."),a=mor.objdata(d),mor.call("delrev?"+mor.login.authparams(),"POST",a,function(a){mor.out("cmain","<p>Review deleted.  If this review was one of your top 20 best, then you may see an id reference message until the next time you review something.  Recalculating your recent reviews...</p>");setTimeout(function(){mor.profile.resetReviews();
mor.profile.display()},12E3)},function(a,b){mor.err("Delete failed code: "+a+" "+b);mor.profile.display()},""))},ea=function(b,k,c,g){d||(d={});d.penid||(d.penid=mor.pen.currPenId());setTimeout(function(){d.penid!==mor.instId(b)?mor.lcs.getPenFull(d.penid,function(a){mor.profile.writeNavDisplay(b,a.pen,"nosettings")}):mor.profile.writeNavDisplay(b,null,"nosettings")},50);k?(X(b,d),d.penid!==mor.pen.currPenId()&&("helpful"===c?mor.review.helpful("set"):"remember"===c?mor.review.memo():"respond"===
c&&mor.review.respond())):v(d.revtype)?"uploadpic"===c?(X(b,d,"edit"),f()):X(b,d,"edit",g):a()};return{resetStateVars:function(){h="";d={};n=""},display:function(a,b){mor.pen.getPen(function(k){ea(k,!1,a,b)})},displayRead:function(a){mor.pen.getPen(function(b){ea(b,!0,a)})},delrev:function(){na()},reviewLinkHTML:function(){return'<div class="topnavitemdiv">'+mor.imgntxt("writereview.png","Write a Review","mor.review.reset(true)","#Write","Write a review")+"</div>"},updateHeading:function(){},getReviewTypes:function(){return u},
getReviewTypeByValue:function(a){return v(a)},reviewTypeCheckboxesHTML:function(a,b){return w("checkbox",a,"",b)},reviewTypeRadiosHTML:function(a,b,k,c){return w("radio",a,c,b,k)},reviewTypeSelectOptionsHTML:function(a){var b,k,c,f="";for(b=0;b<u.length;b+=1){k=u[b].type;c=!1;if(a&&(!a[k]||0===a[k].length))c=!0;f+='<option value="'+k+'"';c&&(f+=' disabled="disabled"');f+=">"+u[b].plural.capitalize()+"</option>"}return f},badgeImageHTML:function(a){return x(a)},starsImageHTML:function(a,b){return y(a,
b)},linkCountHTML:function(a){a=mor.lcs.getRevRef(a);a.revlink?(a=l(a.revlink,"helpful")+l(a.revlink,"remembered")+l(a.revlink,"corresponding"))&&(a="&nbsp;"+a):a="";return a},readURL:function(a,k){return b(a,k)},setType:function(a){d.revtype=a;mor.review.display()},picUploadForm:function(){f()},toggleKeyword:function(a){var b,k,c,f,g;a=mor.byId(a);b="";k=mor.byId("keywordin");c=k.value.split(",");for(f=0;f<c.length;f+=1)if(g=c[f])g=g.trim(),g===a.value&&(g=""),b&&g&&(b+=", "),b+=g;a.checked&&(b&&
(b+=", "),b+=a.value);k.value=b},reset:function(a){mor.onescapefunc=null;P&&(clearTimeout(P),P=null);a||!d||!mor.instId(d)?(d={},n=h="",t=!1,m="",mor.review.display()):mor.review.displayRead()},validate:function(){ja()},save:function(a,b){ka(a,b)},setCurrentReview:function(a){d=a},getCurrentReview:function(){return d},initWithId:function(a,b,k,c){la(a,b,k,c)},respond:function(){mor.byId("respondtxttd").style.color="#666666";setTimeout(function(){mor.pen.getPen(function(a){Y(a,ma)})},50)},memo:function(a){ca(a)},
helpful:function(a){Z(a)},graphicAbbrevSiteLink:function(a){return G(a)},swapVidTitleAndArtist:function(){var a=mor.byId("keyin"),b=a.value,k=mor.byId("field0");a.value=k.value;k.value=b},changeReviewType:function(a){g(d.revtype,[]);d.revtype=a;mor.review.display()},removeImageLink:function(){d.imguri="";mor.review.display()},setAttribution:function(a){n=a},starRating:function(a,b){return A(a,b)},selectloc:function(a,b){fa(a,b)},loadHelpful:function(a,b){aa(a,b)},foundHelpful:function(a,b){return $(a,
b)},ratmenusel:function(a){mor.cancelPicUpload();d.rating=a;a=y(d.rating,!0);mor.out("stardisp",a)}}});
define("amd/profile",[],function(){var h,n=function(a){a||(a=h);a.pen&&"string"===typeof a.pen.top20s&&(a.pen.top20s=mor.dojo.json.parse(a.pen.top20s));a.profstate||(a.profstate={seltabname:"recent",revtype:""});!a.profstate.revtype&&a.pen.top20s&&(a.profstate.revtype=a.pen.top20s.latestrevtype);a.profstate.revtype||(a.profstate.revtype="book")},d=function(a){h=mor.lcs.getPenRef(a);n(h)},t=function(a,b,c){b||(b=a);var f;mor.byId("homepenhdiv")||mor.login.updateAuthentDisplay();f='<div class="topnavitemdiv">'+
mor.imgntxt("profile.png",a.name,"mor.profile.display()","#view=profile&profid="+mor.instId(a),"Show profile for your current pen name")+"</div>";mor.out("homepenhdiv",f);f=mor.imglink("#Settings","Adjust your application settings","mor.profile.settings()","settings.png","settingsnavico");mor.out("settingsbuttondiv",f);var g,e;e=mor.instId(b);f=b.name;g='<div id="profhdiv"><span id="penhnamespan">'+('<a href="#view=profile&profid='+e+'" title="Show profile for '+f+'" onclick="mor.profile.byprofid(\''+
e+"');return false;\">"+f+"</a>")+'</span><span id="penhbuttonspan"> </span></div>';mor.out("centerhdiv",g);g="";mor.instId(a)!==mor.instId(b)&&"nosettings"!==c&&(mor.rel.relsLoaded()?(a=mor.rel.outbound(e),mor.profile.verifyStateVariableValues(b),g=a?mor.imglink("#Settings","Adjust follow settings for "+f,"mor.profile.relationship()","settings.png"):mor.imglink("#Follow","Follow "+f+" reviews","mor.profile.relationship()","follow.png")):g="...");mor.out("penhbuttonspan",g)},m=function(a){var b=mor.byId("pennamein");
a||(a=h.pen);b&&(a.name=b.value)},p=function(){var a=mor.pen.currPenRef().pen;m(a);mor.skinner.save(a);mor.pen.updatePen(a,function(){mor.layout.closeDialog();mor.profile.display()},function(a,b){mor.out("settingsmsgtd",b)})},q=function(a){mor.skinner.cancel();mor.layout.closeDialog();a&&"string"===typeof a&&(mor.out("centerhdiv",""),mor.out("cmain",a))},r=function(a){switch(a){case "mid":return"MyOpenReviews";case "gsid":return"Google+";case "fbid":return"Facebook";case "twid":return"Twitter";case "ghid":return"GitHub"}},
u=function(a,b){var c,f;f='<div id="accountdiv">'+mor.login.loginInfoHTML()+'</div>Access "'+b.name+'" via: <table>';c=r("mid");f+='<tr><td><input type="checkbox" name="aamid" value="'+c+'" id="aamid" onchange="mor.profile.toggleAuthChange(\'mid\',\''+a+"');return false;\"";mor.isId(b.mid)&&(f+=' checked="checked"');f=f+('/><label for="aamid">'+c+"</label></td></tr>")+"<tr>";c=r("fbid");f+='<td><input type="checkbox" name="aafbid" value="'+c+'" id="aafbid" onchange="mor.profile.toggleAuthChange(\'fbid\',\''+
a+"');return false;\"";mor.isId(b.fbid)&&(f+=' checked="checked"');f+='/><label for="aafbid">'+c+"</label></td>";c=r("twid");f+='<td><input type="checkbox" name="aatwid" value="'+c+'" id="aatwid" onchange="mor.profile.toggleAuthChange(\'twid\',\''+a+"');return false;\"";mor.isId(b.twid)&&(f+=' checked="checked"');f+='/><label for="aatwid">'+c+"</label></td>";f+="</tr><tr>";c=r("gsid");f+='<td><input type="checkbox" name="aagsid" value="'+c+'" id="aagsid" onchange="mor.profile.toggleAuthChange(\'gsid\',\''+
a+"');return false;\"";mor.isId(b.gsid)&&(f+=' checked="checked"');f+='/><label for="aagsid">'+c+"</label></td>";c=r("ghid");f+='<td><input type="checkbox" name="aaghid" value="'+c+'" id="aaghid" onchange="mor.profile.toggleAuthChange(\'ghid\',\''+a+"');return false;\"";mor.isId(b.ghid)&&(f+=' checked="checked"');f+='/><label for="aaghid">'+c+"</label></td>";f+="</tr></table>";mor.out(a,f)},A=function(a,b,c){var f="remove",g;mor.byId("aa"+b).checked&&(f="add");if("remove"===f)f=(a.mid?1:0)+(a.gsid?
1:0)+(a.fbid?1:0)+(a.twid?1:0)+(a.ghid?1:0),2>f?(alert("You must have at least one authentication type."),mor.byId("aa"+b).checked=!0):b===mor.login.getAuthMethod()?(alert("You can't remove the authentication you are currently logged in with."),mor.byId("aa"+b).checked=!0):confirm("Are you sure you want to remove access to this Pen Name from "+r(b)+"?")?(mor.out(c,"Updating..."),g=a[b],a[b]=0,mor.pen.updatePen(a,function(a){u(c,a)},function(f,e){mor.err("handleAuthChangeToggle error "+f+": "+e);a[b]=
g;u(c,a)})):mor.byId("aa"+b).checked=!0;else if("add"===f)switch(b){case "mid":mor.out(c,'<form action="'+mor.secsvr+'/loginid" enctype="multipart/form-data" method="post"><table><tr><td colspan="2">Adding native authorization to '+a.name+':</td></tr><tr><td align="right">username</td><td align="left"><input type="text" id="userin" name="userin" size="20"/></td></tr><tr><td align="right">password</td><td align="left"><input type="password" id="passin" name="passin" size="20"/></td></tr><tr><td colspan="2" align="center" id="settingsbuttons"><input type="submit" value="Log in"></td></tr></table></form>');
break;case "fbid":require(["ext/facebook"],function(b){mor.facebook||(mor.facebook=b);b.addProfileAuth(c,a)});break;case "twid":require(["ext/twitter"],function(b){mor.twitter||(mor.twitter=b);b.addProfileAuth(c,a)});break;case "gsid":require(["ext/googleplus"],function(b){mor.googleplus||(mor.googleplus=b);b.addProfileAuth(c,a)});break;case "ghid":require(["ext/github"],function(b){mor.github||(mor.github=b);b.addProfileAuth(c,a)})}},y=function(a){var b,c=mor.pen.getPenNames(),f;b='<div id="penseldiv"><span class="headingtxt">Writing as </span><select id="penselect" onchange="mor.profile.switchPen();return false;">';
for(f=0;f<c.length;f+=1)b+='<option id="'+mor.instId(c[f])+'"',c[f].name===a.name&&(b+=' selected="selected"'),b+=">"+c[f].name+"</option>";mor.out("dlgdiv",'<div class="dlgclosex"><a id="closedlg" href="#close" onclick="mor.profile.cancelPenNameSettings();return false;">&lt;close&nbsp;&nbsp;X&gt;</a></div><div class="floatclear"></div><table><tr><td colspan="2" align="left" id="pensettitletd">'+(b+'<option id="newpenopt">New Pen Name</option></select>&nbsp;<button type="button" id="penselectok" onclick="mor.profile.switchPen();return false;">go</button></div>')+
'</td></tr><tr><td colspan="2" id="settingsmsgtd"></td></tr><tr><td rowspan="2" align="right" valign="top"><img src="img/penname.png" alt="Pen Name"/></td><td align="left"><input type="text" id="pennamein" size="25" value="'+a.name+'"/></td></tr><tr><td id="settingsauthtd"></td></tr><tr><td colspan="2" id="settingsskintd"></td></tr><tr><td colspan="2" id="consvcstd"></td></tr><tr><td colspan="2" align="center" id="settingsbuttons"><button type="button" id="savebutton">Save</button></td></tr></table>');
mor.onchange("pennamein",mor.profile.setPenNameFromInput);mor.onclick("savebutton",p);u("settingsauthtd",a);mor.services.display("consvcstd",a);mor.skinner.init("settingsskintd",a);mor.byId("dlgdiv").style.visibility="visible";mor.isLowFuncBrowser()&&(mor.byId("dlgdiv").style.backgroundColor="#eeeeee");mor.onescapefunc=q},x=function(a,b){var c;b?(c=a.mid,a.mid=b,mor.pen.updatePen(a,function(a){y(a)},function(b,f){mor.err("addMyOpenReviewsAuthId error "+b+": "+f);a.mid=c;mor.profile.display()})):(mor.err("No account ID received."),
mor.profile.display())},w=function(){var a,b,c,f,g;g=mor.pen.currPenRef().pen;a="Hey,\n\nI'm using MyOpenReviews to review things I experience.\n\nI trust your taste, and would be interested in reading reviews from you";c=document.getElementsByName("invrevcb");b="";for(f=0;f<c.length;f+=1)c[f].checked&&(b&&(b+=","),b+=c[f].value);if(b){c=b.split(",");b="";for(f=0;f<c.length;f+=1)0<f&&(b=f===c.length-1?b+" and ":b+", "),b+=c[f];a+=", especially about "+b+"."}else a+=".";a+="\n\nIf you sign up, then I'll be able to follow what you like and don't like, and you can see what I like and don't like by following me. To follow me, click the 'follow' icon next to '"+
g.name+"' on my profile page. Here's the direct link to my profile:\n\nhttp://www.myopenreviews.com/#view=profile&profid="+mor.instId(g)+"\n\nI'll follow back when I see you in my 'Followers' tab.\n\nLooking forward to hearing about your new finds";b&&(a+=" in "+b);a+="!\n\ncheers,\n"+g.name+"\n\n";a="mailto:?subject="+mor.dquotenc("Sharing experiences through reviews")+"&body="+mor.dquotenc(a);return mor.services.serviceLinkHTML(a,"","shareico","Invite via eMail","img/email.png")},v=function(a,b){mor.lcs.getPenFull(a,
function(a){b(a.pen)})},l=function(a,b){0>b.indexOf(";")&&(b+=";");return'<a href="#'+a+'" title="Click to see '+a+'" onclick="'+b+'return false;">'+a+"</a>"},e=function(a,b){var c,f,g,e;c=mor.instId(a);f=mor.review.getReviewTypeByValue(a.revtype);g="statrev/"+c;e=mor.review.foundHelpful(c)?"rslcbold":"rslc";e="<li>"+mor.review.starsImageHTML(a.rating)+mor.review.badgeImageHTML(f)+'&nbsp;<a id="lihr'+c+'" href="'+g+'" onclick="mor.profile.readReview(\''+c+'\');return false;" class="'+e+'" title="See full review">';
e=f.subkey?e+("<i>"+mor.ellipsis(a[f.key],60)+"</i> "+mor.ellipsis(a[f.subkey],40)):e+mor.ellipsis(a[f.key],60);e+="</a>";a.url&&(e+=" &nbsp;"+mor.review.graphicAbbrevSiteLink(a.url));e+='<div class="revtextsummary">';b&&(g=mor.objdata({view:"profile",profid:a.penid}),e+='review by <a href="#'+g+'" onclick="mor.profile.byprofid(\''+a.penid+'\');return false;" title="Show profile for '+mor.ndq(b)+'">'+b+"</a>");a.keywords&&(b&&(e+=": "),e+=mor.ellipsis(a.keywords,100));e+=mor.review.linkCountHTML(c);
e+="</div>";a.text&&(e+='<div class="revtextsummary">'+mor.ellipsis(a.text,255)+"</div>");return e+"</li>"},c=function(a,b){var c,f,g;f='<ul class="revlist">';a.results||(a.results=[]);for(c=0;c<a.results.length;c+=1)f+=e(a.results[c]);if(b){a.cursor="";for(c=0;c<b.length;c+=1){if(b[c].fetched){g=b[c].fetched;"number"===typeof g&&0<=g&&(a.total+=b[c].fetched,f+='<div class="sumtotal">'+a.total+" reviews searched</div>");b[c].cursor&&(a.cursor=b[c].cursor);break}mor.lcs.putRev(b[c]);a.results.push(b[c]);
f+=e(b[c])}}a.total=Math.max(a.total,a.results.length);0===a.total&&(f+="<li>No recent reviews.",mor.instId(h.pen)===mor.pen.currPenId()&&(f+=" "+mor.review.reviewLinkHTML()),f+="</li>");f+="</ul>";a.cursor&&(0===c&&0===a.results.length?2E3>a.total?setTimeout(mor.profile.revsmore,10):f+="No recent reviews found, only batch updates.":f+='<a href="#continuesearch" onclick="mor.profile.revsmore();return false;" title="More reviews">more reviews...</a>');mor.out("profcontdiv",f);mor.layout.adjust();setTimeout(function(){mor.lcs.verifyReviewLinks(mor.profile.refresh)},
250)},g=function(a){var b;b=mor.objdata(a.params)+"&"+mor.login.authparams();a.cursor&&(b+="&cursor="+mor.enc(a.cursor));mor.call("srchrevs?"+b,"GET",null,function(b){c(a,b)},function(a,b){mor.out("profcontdiv","findRecentReviews failed code "+a+" "+b)},"")},b=function(a){var b,c,f,g,e,d,l;l=h.pen;b="";mor.pen.deserializeFields(l);f=mor.review.getReviewTypes();for(c=0;c<f.length;c+=1)g=f[c].type,d="reviewbadgedis",e="No "+f[c].type.capitalize()+" reviews.",l.top20s[g]&&(20<=l.top20s[g].length?(e=
"Top 20 "+f[c].plural.capitalize(),d="reviewbadge"):1<=l.top20s[g].length&&(e=String(l.top20s[g].length)+" "+f[c].type.capitalize()+" reviews.",d="reviewbadge")),b+='<img class="'+d+'" src="img/'+f[c].img+'" title="'+e+'" alt="'+e+'" onclick="'+a+"('"+g+"');return false;\"/>";return b},a=function(){var c,f,g,d;c=h.profstate;f=b("mor.profile.showTopRated");g=[];h.pen.top20s&&(g=h.pen.top20s[c.revtype]||[]);f+='<ul class="revlist">';0===g.length&&(f+="<li>No top rated "+c.revtype+" reviews.",mor.instId(h.pen)===
mor.pen.currPenId()&&(f+=" "+mor.review.reviewLinkHTML()),f+="</li>");for(c=0;c<g.length;c+=1)if(d=mor.lcs.getRevRef(g[c]),d.rev)f+=e(d.rev);else if("not cached"===d.status){f+="<li>Fetching review "+g[c]+"...</li>";break}mor.out("profcontdiv",f+"</ul>");mor.layout.adjust();c<g.length?mor.lcs.getRevFull(g[c],a):setTimeout(function(){mor.lcs.verifyReviewLinks(mor.profile.refresh)},250)},f=function(){var a=h.profstate.allRevsState;a&&a.autopage&&(window.clearTimeout(a.autopage),a.autopage=null);a&&
a.querymon&&(window.clearTimeout(a.querymon),a.querymon=null);a.cursor="";a.total=0;a.reqs=1;a.revs=[]},s=function(a){var b,c,f=h.profstate.allRevsState;b='<ul class="revlist">';for(c=0;c<f.revs.length;c+=1)b+=e(f.revs[c]);if(!a||0===a.length)a=[{fetched:0,cursor:""}];f.cursor="";for(c=0;c<a.length;c+=1){if("number"===typeof a[c].fetched){f.total+=a[c].fetched;b+='<div class="sumtotal">'+f.total+" reviews searched</div>";a[c].cursor&&(f.cursor=a[c].cursor);break}f.revs.push(a[c]);b+=e(a[c])}b+="</ul>";
f.cursor&&(0===c&&!(h.profstate.allRevsState.total>=1E3*h.profstate.allRevsState.reqs)?f.autopage=window.setTimeout(mor.profile.searchAllRevs,10):(h.profstate.allRevsState.total>=1E3*h.profstate.allRevsState.reqs&&(f.reqs+=1),b+='<a href="#continuesearch" onclick="mor.profile.searchAllRevs();return false;" title="Continue searching for more matching reviews">continue search...</a>'));mor.out("allrevdispdiv",b);setTimeout(function(){mor.lcs.verifyReviewLinks(mor.profile.refresh)},250)},D=function(){var a,
b;b="";a=h.profstate;if(b=mor.byId("allrevsrchin"))b=b.value,b!==a.allRevsState.srchval?(a.allRevsState.querymon&&(window.clearTimeout(a.allRevsState.querymon),a.allRevsState.querymon=null),mor.profile.searchAllRevs()):a.allRevsState.querymon=setTimeout(D,400)},G=function(a){var b,c,g,e;b=h.profstate;a?b.revtype!==a&&(b.revtype=a,f()):a=b.revtype;c=mor.byId("allrevsrchin").value;c!==b.allRevsState.srchval&&(b.allRevsState.srchval=c,f());g=(new Date).toISOString();e=(new Date(0)).toISOString();a=mor.login.authparams()+
"&qstr="+mor.enc(mor.canonize(c))+"&revtype="+a+"&penid="+mor.instId(h.pen)+"&maxdate="+g+"&mindate="+e+"&cursor="+mor.enc(b.allRevsState.cursor);mor.call("srchrevs?"+a,"GET",null,function(a){s(a);D()},function(a,b){mor.err("searchAllRevs call died code: "+a+" "+b)},"")},H=function(a){var b;n(h);b=h.profstate;switch(a){case "recent":b.seltabname="recent";break;case "best":b.seltabname="best";break;case "allrevs":b.seltabname="allrevs";break;case "following":b.seltabname="following";break;case "followers":b.seltabname=
"followers"}},I=function(k){var e,d,l;n(h);k?h.profstate.seltabname=k:k=h.profstate.seltabname;d=mor.byId("proftabsul");for(e=0;e<d.childNodes.length;e+=1)l=d.childNodes[e],l.className="unselectedTab",l.style.backgroundColor=mor.skinner.darkbg();l=mor.byId(k+"li");l.className="selectedTab";l.style.backgroundColor="transparent";mor.historyCheckpoint({view:"profile",profid:mor.instId(h.pen),tab:k});switch(h.profstate.seltabname){case "recent":h.profstate.recentRevState?c(h.profstate.recentRevState):
(mor.out("profcontdiv","Retrieving recent activity for "+h.pen.name+"..."),mor.layout.adjust(),h.profstate.recentRevState=k={params:{},cursor:"",results:[],total:0},e=new Date,d=new Date(e.getTime()-2592E6),k.params.maxdate=e.toISOString(),k.params.mindate=d.toISOString(),k.params.penid=mor.instId(h.pen),g(k));break;case "best":a();break;case "allrevs":e=h.profstate.allRevsState;e||(e=h.profstate.allRevsState={srchval:"",revs:[],cursor:"",total:0,reqs:1});k=b("mor.profile.searchRevsIfTypeChange");
k+='<div id="allrevsrchdiv"><input type="text" id="allrevsrchin" size="40" placeholder="Review title or name" value="'+e.srchval+'" onchange="mor.profile.allrevs();return false;"/></div><div id="allrevdispdiv"></div>';mor.out("profcontdiv",k);mor.byId("allrevsrchin").focus();0<e.revs.length?(s([]),D()):(f(),mor.profile.searchAllRevs());break;case "following":mor.rel.displayRelations(h.pen,"outbound","profcontdiv");mor.layout.adjust();break;case "followers":mor.rel.displayRelations(h.pen,"inbound",
"profcontdiv"),mor.layout.adjust()}},J=function(a){return mor.isId(a.mid)||mor.isId(a.gsid)||mor.isId(a.fbid)||mor.isId(a.twid)||mor.isId(a.ghid)?!0:!1},O=function(){mor.profile.updateHeading();mor.profile.display()},Q=function(a,b){mor.out("sysnotice",b)},L=function(a){var b;if(b=mor.byId("profcityin"))a.city=b.value;if(b=mor.byId("shouttxt"))a.shoutout=b.value;mor.pen.updatePen(a,mor.profile.display,Q)},E=function(){mor.byId("profcancelb")||(mor.out("profeditbspan",'&nbsp;<button type="button" id="profcancelb">Cancel</button>&nbsp;<button type="button" id="profsaveb">Save</button>'),
mor.onclick("profcancelb",O),mor.onclick("profsaveb",mor.profile.save))},F=function(a){var b;a.style.color=mor.colors.text;a.style.backgroundColor=mor.skinner.lightbg();b=Math.max(mor.winw-350,200);b=Math.min(b,600);a.style.width=b+"px";b+=mor.byId("profpictd").offsetWidth;b+=50;mor.byId("profcontdiv").style.width=String(b)+"px"},M=function(a){var b,c;c="No additional information about "+a.name;mor.instId(h.pen)===mor.pen.currPenId()&&(c="About me (anything you would like to say to everyone). Link to your twitter handle, blog or site if you want.");
c='<span style="color:#999999;">'+c+"</span>";mor.out("profshouttd",'<div id="shoutdiv" class="shoutout"></div>');b=mor.byId("shoutdiv");F(b);b.style.overflow="auto";b.style.border="1px solid "+mor.colors.bodybg;c=mor.linkify(a.shoutout)||c;mor.out("shoutdiv",c);if(J(a))mor.onclick("shoutdiv",function(){var b;mor.out("profshouttd",'<textarea id="shouttxt" class="shoutout"></textarea>');b=mor.byId("shouttxt");F(b);b.readOnly=!1;b.value=a.shoutout;b.focus();E()})},R=function(){mor.byId("shoutdiv")&&
mor.profile.save()},N=function(a){var b="img/emptyprofpic.png";a.profpic&&(b="profpic?profileid="+mor.instId(a));mor.out("profpictd",'<img class="profpic" src="'+b+'"/>');if(J(a))mor.onclick("profpictd",function(){mor.byId("profcancelb")&&L(a);var b;b=""+mor.paramsToFormInputs(mor.login.authparams());b+='<input type="hidden" name="_id" value="'+mor.instId(a)+'"/>';b+='<input type="hidden" name="returnto" value="'+mor.enc(window.location.href+"#profile")+'"/>';mor.out("overlaydiv",'<form action="/profpicupload" enctype="multipart/form-data" method="post"><div id="closeline"><a id="closedlg" href="#close" onclick="mor.cancelPicUpload();return false">&lt;close&nbsp;&nbsp;X&gt;</a></div>'+
b+'<table><tr><td>Upload New Profile Pic</td></tr><tr><td><input type="file" name="picfilein" id="picfilein"/></td></tr><tr><td align="center"><input type="submit" value="Upload"/></td></tr></form>');b=mor.byId("overlaydiv");b.style.top="80px";b.style.visibility="visible";b.style.backgroundColor=mor.skinner.lightbg();mor.onescapefunc=mor.cancelPicUpload;mor.byId("picfilein").focus()})},U=function(a){var b,c,f,g,e,d;b="";mor.pen.deserializeFields(a);f=mor.review.getReviewTypes();for(c=0;a.top20s&&
c<f.length;c+=1)g=f[c].type,a.top20s[g]&&1<=a.top20s[g].length&&(e="top 20 "+f[c].plural.capitalize(),d="reviewbadge",20>a.top20s[g].length&&(e=String(a.top20s[g].length)+" "+f[c].plural.capitalize(),d="reviewbadgedis"),b+='<img class="'+d+'" src="img/'+f[c].img+'" title="'+e+'" alt="'+e+'" onclick="mor.profile.showTopRated(\''+g+"');return false;\"/>");return b},K=function(a,b,c,f){b||(b=a);d(b);mor.historyCheckpoint({view:"profile",profid:mor.instId(h.pen),tab:h.profstate.seltabname});t(a,b);mor.skinner.setColorsFromPen(a);
a='<div id="proftopdiv"><table id="profdisptable" border="0"><tr><td id="sysnotice" colspan="3"></tr><tr><td id="profpictd" rowspan="3"><img class="profpic" src="img/emptyprofpic.png"/></td><td id="profcitytd"><span id="profcityspan"> </span><span id="profeditbspan"> </span></td></tr><tr><td id="profshouttd" colspan="2" valign="top"><div id="shoutdiv" class="shoutout"></div></td></tr><tr><td id="profbadgestd"></td><td id="profcommbuildtd"></td></tr><tr><td colspan="3"><div id="proftabsdiv"> </div></td></tr><tr><td colspan="3"><div id="profcontdiv"> </div></td></tr></table></div>';
mor.layout.haveContentDivAreas()||mor.layout.initContentDivAreas();mor.out("cmain",a);mor.out("profbadgestd",U(b));mor.instId(h.pen)===mor.pen.currPenId()&&mor.out("profcommbuildtd",'<a id="commbuild" href="#invite" onclick="mor.profile.invite();return false"><img class="reviewbadge" src="img/follow.png">Build your community</a>');M(b);a=b;var g="";a.city||(mor.byId("profcityspan").style.color="#999999");c=a.city||"City not specified";a.city||(g=' style="color:#999999;"');J(a)&&(c='<a href="#edit city" title="Edit city" id="profcitya" onclick="mor.profile.editCity();return false;"'+
g+">"+c+"</a>");mor.out("profcityspan",c);N(b);b=h;n(b);b='<ul id="proftabsul"><li id="recentli" class="selectedTab">'+l("Recent Reviews","mor.profile.tabselect('recent')")+'</li><li id="bestli" class="unselectedTab">'+l("Top Rated","mor.profile.tabselect('best')")+'</li><li id="allrevsli" class="unselectedTab">'+l("All Reviews","mor.profile.tabselect('allrevs')")+'</li><li id="followingli" class="unselectedTab">'+l("Following ("+b.pen.following+")","mor.profile.tabselect('following')")+'</li><li id="followersli" class="unselectedTab">'+
l("Followers ("+b.pen.followers+")","mor.profile.tabselect('followers')")+"</li>";mor.out("proftabsdiv",b+"</ul>");I();mor.layout.adjust();f&&mor.err("Previous processing failed: "+f)},V=function(a,b){mor.layout.closeDialog();h=null;v(a,function(a){b&&(d(a),H(b));mor.pen.getPen(function(b){K(b,a)})})};return{resetStateVars:function(){h=null},display:function(a,b){mor.pen.getPen(function(c){K(c,null,a,b)})},updateHeading:function(){mor.pen.getPen(function(a){t(a,h&&h.pen)})},refresh:function(){mor.pen.getPen(function(a){K(a,
h.pen)})},settings:function(){mor.pen.getPen(y)},tabselect:function(a){I(a)},resetReviews:function(){var a=mor.pen.currPenRef();a.profstate=null;n(a)},save:function(){mor.pen.getPen(L)},byprofid:function(a,b){V(a,b)},relationship:function(){mor.rel.reledit(mor.pen.currPenRef().pen,h.pen)},switchPen:function(){var a,b=mor.byId("penselect");a="";for(a=0;a<b.options.length;a+=1)if(b.options[a].selected){"newpenopt"===b.options[a].id?(q("Creating new pen name..."),mor.pen.newPenName(mor.profile.display)):
(a=b.options[a].value,q("Switching pen names..."),mor.pen.selectPenByName(a));break}},penListItemHTML:function(a){var b=mor.instId(a),c,f,g;f=mor.objdata({view:"profile",profid:b});(g=mor.ellipsis(a.shoutout,75))||(g="View profile for "+a.name);c="img/blank.png";a.profpic&&(c="profpic?profileid="+b);b='<li><a href="#'+f+'" onclick="mor.profile.byprofid(\''+b+'\');return false;" title="'+g+'">'+('<img class="srchpic" src="'+c+'"/>&nbsp;<span class="penfont">'+a.name+"</span></a>");a.city&&(b+=' <span class="smalltext">('+
a.city+")</span>");var e;c="";mor.pen.deserializeFields(a);g=mor.review.getReviewTypes();for(f=0;a.top20s&&f<g.length;f+=1)e=g[f].type,a.top20s[e]&&20<=a.top20s[e].length&&(c+=mor.review.badgeImageHTML(g[f]));return b=b+c+"</li>"},revsmore:function(){g(h.profstate.recentRevState)},readReview:function(a){var b;(b=mor.lcs.getRevRef(a).rev)?(mor.historyCheckpoint({view:"review",mode:"display",revid:a}),mor.review.setCurrentReview(b),mor.review.displayRead()):mor.err("readReview "+a+" not found")},reviewItemHTML:function(a,
b){return e(a,b)},toggleAuthChange:function(a,b){mor.pen.getPen(function(c){A(c,a,b)})},displayAuthSettings:function(a,b){u(a,b)},addMyOpenReviewsAuthId:function(a){mor.pen.getPen(function(b){x(b,a)})},writeNavDisplay:function(a,b,c){t(a,b,c)},verifyStateVariableValues:function(a){d(a)},cancelPenNameSettings:function(){q()},editCity:function(){var a;if(!mor.byId("profcityin")){a=mor.byId("profcityspan").innerHTML;if(0===a.indexOf("<a")||0===a.indexOf("<A"))a=mor.byId("profcitya").innerHTML;"City not specified"===
a&&(a="");mor.out("profcityspan",'<input type="text" id="profcityin" size="25" placeholder="City or Region" value="'+a+'"/>');E();mor.onchange("profcityin",R);mor.byId("profcityin").focus()}},invite:function(){var a;a='<div class="dlgclosex"><a id="closedlg" href="#close" onclick="mor.layout.closeDialog();return false;">&lt;close&nbsp;&nbsp;X&gt;</a></div><div class="floatclear"></div><div class="headingtxt">Build your community... Invite a friend</div><table class="formstyle"><tr><td id="invintrotd" style="width:400px;"><p>Know someone whose taste you trust?<br/>Want to share your reviews?</p><p>What types of reviews would you be most interested in seeing from them?</p></td></tr><tr><td id="invtypestd">'+
mor.review.reviewTypeCheckboxesHTML("invrevcb","mor.profile.chginvite")+'</td></tr><tr><td>Invite your friend to join:</td></tr><tr><td align="center"><span id="mailbspan"></span></td></tr></table>';mor.out("dlgdiv",a);mor.byId("dlgdiv").style.visibility="visible";mor.isLowFuncBrowser()&&(mor.byId("dlgdiv").style.backgroundColor="#eeeeee");mor.onescapefunc=mor.layout.closeDialog;mor.out("mailbspan",w())},chginvite:function(){mor.out("mailbspan",w())},showTopRated:function(b){n(h);h.profstate.revtype=
b;a()},searchAllRevs:function(a){G(a)},searchRevsIfTypeChange:function(a){h.profstate.revtype!==a&&G(a)}}});
define("amd/activity",[],function(){var h="amnew",n="",d=function(d){var e;if("activity"===d)if("amnew"===h)d="rssact?pen="+mor.pen.currPenId(),e="New reviews from friends "+mor.imglink(d,"RSS feed for recent friend reviews","window.open('"+d+"')","rssicon.png","rssico")+'<button type="button" id="switchmodebutton" onclick="mor.activity.switchmode(\'amtop\');return false;" title="Show top rated reviews from friends">Show Top</button>';else{if("amtop"===h){var c,g,b;b='<div id="toptypeseldiv">';d=
mor.review.getReviewTypes();for(e=0;e<d.length;e+=1)c=d[e].type,g=c.capitalize()+" reviews",b+='<img class="reviewbadge" src="img/'+d[e].img+'" title="'+g+'" alt="'+g+'" onclick="mor.activity.toptype(\''+c+"');return false;\"/>";e='Top reviews from friends <button type="button" id="switchmodebutton" onclick="mor.activity.switchmode(\'amnew\');return false;" title="Show recent reviews from friends">Show Recent</button>'+(b+"</div>")}}else"memo"===d&&(e="Remembered reviews");mor.out("centerhdiv",e)},
t=function(){var d,e,c,g,b;d=mor.pen.currPenRef().pensearch;d.params.reqmin=[];e=document.getElementsByName("reqmin");for(c=0;c<e.length;c+=1)e[c].checked&&(g=mor.review.getReviewTypeByValue(e[c].value),d.params.reqmin.push(g.type));e=mor.byId("srchactivesel").options;for(c=0;c<e.length;c+=1)if(e[c].selected){switch(e[c].id){case "pastweek":b=7;break;case "pastmonth":b=30;break;case "pastyear":b=365;break;case "whenever":b=-1}break}d.params.activeDaysAgo=b;d.params.includeFollowing=!1;d.params.includeBlocked=
!1;d.params.includeLurkers=!1;e=document.getElementsByName("srchinc");for(c=0;c<e.length;c+=1)e[c].checked&&("following"===e[c].value&&(d.params.includeFollowing=!0),"blocked"===e[c].value&&(d.params.includeBlocked=!0),"lurkers"===e[c].value&&(d.params.includeLurkers=!0))},m=function(){var d,e,c,g;d=mor.pen.currPenRef().pensearch;t();mor.out("srchoptstogglehref","show advanced search options");mor.byId("searchoptionsdiv").style.display="none";mor.byId("searchbutton").disabled=!0;e=mor.byId("searchtxt").value;
e=mor.login.authparams()+"&qstr="+mor.enc(e)+"&cursor="+mor.enc(d.cursor);0<d.params.activeDaysAgo&&(c=(new Date).getTime(),c-=864E5*d.params.activeDaysAgo,c=new Date(c),c=c.toISOString(),e+="&time="+mor.enc(c));if(0<d.params.reqmin.length){c="";for(g=0;g<d.params.reqmin.length;g+=1)0<g&&(c+=","),c+=d.params.reqmin[g];e+="&t20="+mor.enc(c)}d.params.includeLurkers&&(e+="&lurkers=include");mor.call("srchpens?"+e,"GET",null,function(b){var a,c,g;a=mor.pen.currPenRef().pensearch;g='<ul class="penlist">';
for(c=0;c<a.pens.length;c+=1)g+=mor.profile.penListItemHTML(a.pens[c]);if(!b||0===b.length)b=[{fetched:0,cursor:""}];a.cursor="";for(c=0;c<b.length;c+=1){if("number"===typeof b[c].fetched){a.total+=b[c].fetched;g+='<div class="sumtotal">'+a.total+" pen names searched, "+(a.total-a.pens.length)+" filtered.</div>";b[c].cursor&&(a.cursor=b[c].cursor);break}var e=b[c],d=void 0,l=void 0,d=mor.pen.currPenRef().pensearch.params,l=mor.rel.outbound(mor.instId(e));if(!l||d.includeFollowing&&"following"===l.status||
d.includeBlocked&&"blocked"===l.status)mor.lcs.putPen(b[c]),a.pens.push(b[c]),g+=mor.profile.penListItemHTML(b[c])}0===a.pens.length&&(g+='<div class="sumtotal">No pen names found</div>');g+="</ul>";a.cursor&&(0===c&&a.total<1E3*a.reqs?setTimeout(mor.activity.searchPens,10):(a.total>=1E3*a.reqs&&(a.reqs+=1),g+='<a href="#continuesearch" onclick="mor.activity.searchPens();return false;" title="Continue searching for more pen names">continue search...</a>'));mor.out("searchresults",g);mor.byId("searchbutton").disabled=
!1},function(b,a){mor.out("searchresults","error code: "+b+" "+a)},"")},p=function(){var d,e,c,g,b,a,f;d=mor.pen.currPenRef();if(d.remembered){e='<ul class="revlist">';if(d.remembered.length)for(c=0;c<d.remembered.length&&50>c;c+=1){g=mor.lcs.getRevRef(d.remembered[c].revid);if("not cached"===g.status){b=d.remembered[c].revid;e+="<li>Fetching Review "+b+"...</li>";break}if(!g.rev.penNameStr&&(a=mor.lcs.getPenRef(g.rev.penid).pen))g.rev.penNameStr=a.name;if(!g.rev.penNameStr){f=g.rev.penid;e+="<li>Fetching Pen Name "+
f+"...</li>";break}e+=mor.profile.reviewItemHTML(g.rev,g.rev.penNameStr)}else e+='<li>You have not remembered any reviews. If you see a review worth remembering, click its "Remember" button to keep a reference to it here.</li>';3>c&&(e+='<li></li><li><span class="hintText">If you see a review worth remembering, click its "Remember" button to keep a reference to it here.</span></li>');mor.out("revactdiv",e+"</ul>");mor.layout.adjust();b&&mor.lcs.getRevFull(b,p);f&&mor.lcs.getPenFull(f,p)}else mor.out("revactdiv",
"Fetching remembered reviews..."),mor.layout.adjust(),e="penid="+mor.instId(d.pen)+"&"+mor.login.authparams(),mor.call("srchremem?"+e,"GET",null,function(a){d.remembered=a;p()},function(a,b){mor.err("displayRemembered failed "+a+" "+b)},"")},q=function(d,e){var c,g,b=0,a;if(0<d.length){g=d[d.length-1];for(c=0;c<e.length&&g.rev.penid!==mor.instId(e[c].pen);c+=1);b=c+1}g=null;for(c=0;c<e.length;c+=1)if(a=(c+b)%e.length,a=e[a].pen,a.top20s&&a.top20s[n]){g=d;a=a.top20s[n];for(var f=void 0,s=void 0,h=
void 0,s=0;!f&&s<a.length;s+=1)if(f=mor.lcs.getRevRef(a[s]),"ok"!==f.status&&"not cached"!==f.status)f=null;else if(f.rev)for(h=0;h<g.length;h+=1)if(f.rev.cankey===g[h].rev.cankey){f=null;break}if(g=f)break}return g},r=function(){var d,e,c,g;d=mor.rel.outboundids();for(e=0;e<d.length;e+=1)if(c=d[e],d[e]=mor.lcs.getPenRef(c),"not cached"===d[e].status)return mor.out("revactdiv","Loading friends..."+(e+1)),mor.lcs.getPenFull(c,r);d.sort(function(b,a){return b.pen&&a.pen&&b.pen.modified<a.pen.modified?
1:b.pen&&a.pen&&b.pen.modified>a.pen.modified?-1:0});for(e=0;!n&&e<d.length;e+=1)d[e].pen&&(d[e].pen.top20s&&d[e].pen.top20s.latestrevtype)&&(n=d[e].pen.top20s.latestrevtype);n||(n="book");g='<ul class="revlist">';for(e=[];20>e.length;){c=q(e,d);if(!c)break;if("not cached"===c.status)return g+="<li>Fetching review "+c.revid+"</li></ul>",mor.out("revactdiv",g),mor.lcs.getRevFull(c.revid,r);c.rev&&(e.push(c),g+=mor.profile.reviewItemHTML(c.rev,c.penNameStr))}0===e.length&&(g+="<li>No "+n+" reviews found</li>");
mor.out("revactdiv",g+"</ul>")},u=function(){var d,e,c,g,b,a,f,s={};mor.byId("switchmodebutton").disabled=!1;a='<ul class="revlist">';d=mor.pen.currPenRef().actdisp;e=d.revrefs;0===e.length&&(a+="<li>None of the people you are following have posted any reviews recently.</li>");for(g=0;g<e.length;g+=1)if(c=e[g].rev,f=c.modified.slice(0,10)+c.penid,!s[f]||2>s[f]?(s[f]=(s[f]||0)+1,a+=mor.profile.reviewItemHTML(c,c.penNameStr)):(s[f]+=1,3===s[f]&&(a+='<li><div class="morerevs"><a href="#'+mor.objdata({view:"profile",
profid:c.penid})+'" onclick="mor.profile.byprofid(\''+c.penid+"', 'recent');return false;\" title=\"Show recent reviews from "+mor.ndq(c.penNameStr)+'">more reviews from '+mor.ndq(c.penNameStr)+" on "+mor.colloquialDate(mor.ISOString2Day(c.modified))+"</a></div></li>")),!c.penNameStr){b=c.penid;break}b?setTimeout(function(){mor.lcs.getPenFull(b,function(a){mor.activity.notePenNameStr(a.pen)})},50):setTimeout(function(){mor.lcs.verifyReviewLinks(u)},250);a+="</ul>";d.cursor&&(a+='<a href="#moreact" onclick="mor.activity.moreact();return false;" title="More activity">more activity...</a>');
mor.out("revactdiv",a);mor.layout.adjust()},A=function(d){var e=mor.rel.outbound(d.penid);return d.rating<e.cutoff||e.mute&&0<=e.mute.indexOf(d.revtype)?!0:!1},y=function(d){var e,c,g;e=mor.pen.currPenRef().actdisp;g="penids="+mor.rel.outboundids().join(",");!d&&e.lastChecked?g+="&since="+e.lastChecked.toISOString():d&&(g+="&cursor="+e.cursor);c=(new Date).getTime();mor.call("revact?"+g,"GET",null,function(b){c=(new Date).getTime()-c;mor.log("revact returned in "+c/1E3+" seconds.");e.lastChecked=
new Date;var a,f,g;f=mor.pen.currPenRef().actdisp;if(d){f.cursor="";for(a=0;a<b.length;a+=1)b[a].fetched?b[a].cursor&&(f.cursor=b[a].cursor):A(b[a])||(g=mor.lcs.putRev(b[a]),f.revrefs.push(g))}else for(a=b.length-1;0<=a;a-=1)b[a].fetched?b[a].cursor&&(f.cursor=b[a].cursor):A(b[a])||(g=mor.lcs.putRev(b[a]),f.revrefs.unshift(g));f.cursor&&0===f.revrefs.length&&setTimeout(mor.activity.moreact,10);u()},function(b,a){mor.out("revactdiv","error code: "+b+" "+a)},"")},x=function(){return mor.imgntxt("follow.png",
"Find Pen Names","mor.activity.pensearchdialog()","#findpens","Find pen names to follow")},w=function(){var l,e,c=!1;d("activity");mor.byId("switchmodebutton").disabled=!0;l=mor.rel.outboundids();0===l.length?e="<p>You are not following anyone.</p><p>To follow someone, click the follow icon next to their profile name.</p>"+x():"waiting"===l[l.length-1]||"loading"===l[l.length-1]?(c=!0,e="Loading relationships..."):mor.pen.currPenRef().helpful?(mor.pen.currPenRef().actdisp={revrefs:[],cursor:""},e=
"Loading activity..."):e="Loading helpful...";mor.out("revactdiv",e);mor.layout.adjust();mor.pen.currPenRef().actdisp?y():mor.pen.currPenRef().helpful?c&&(mor.log("bootActivityDisplay retry: "+l[l.length-1]),setTimeout(w,100)):mor.review.loadHelpful(w)},v=function(l){var e=mor.pen.currPenRef();e?(mor.historyCheckpoint({view:l}),d(l),mor.byId("revactdiv")||(mor.byId("cmain")||mor.layout.initContent(),mor.out("cmain",'<div id="revactdiv"></div>')),"memo"===l?p():"amtop"===h?r():e.actdisp?(u(),y()):
w()):setTimeout(function(){mor.pen.getPen(function(c){v(l)})},100)};return{updateHeading:function(l){d(l||"activity")},pensearchdialog:function(){var d;d='<div class="dlgclosex"><a id="closedlg" href="#close" onclick="mor.layout.closeDialog();return false;">&lt;close&nbsp;&nbsp;X&gt;</a></div><div class="floatclear"></div><div class="headingtxt">Find pen names to follow</div><table class="searchtable"><tr><td class="formstyle"><input type="text" id="searchtxt" size="40" placeholder="Pen name, city, or profile comment..." onchange="mor.activity.startPenSearch();return false;" value=""/></td><td class="formstyle"><span id="srchbuttonspan"><button type="button" id="searchbutton" onclick="mor.activity.startPenSearch();return false;">Search</button></span></td></tr><tr><td class="formstyle" colspan="2"><span id="srchoptstoggle" class="formstyle"><a href="#searchoptions" id="srchoptstogglehref" title="search options" onclick="mor.activity.togglesrchopts();return false;">show advanced search options</a></span></td></tr></table>'+
('<div id="searchoptionsdiv" class="formstyle"><i>Must have reviewed their top 20</i>'+mor.review.reviewTypeCheckboxesHTML("reqmin")+'<i>Must have been active within the past</i>&nbsp;<select id="srchactivesel"><option id="whenever">Whenever</option><option id="pastyear" selected="selected">Year</option><option id="pastmonth">Month</option><option id="pastweek">Week</option></select><br/><i>Include</i>&nbsp;'+mor.checkbox("srchinc","following")+mor.checkbox("srchinc","blocked")+mor.checkbox("srchinc",
"lurkers")+" <i> in the search results</i><br/>&nbsp;<br/></div>")+'<div id="searchresults"></div>';mor.out("dlgdiv",d);mor.byId("dlgdiv").style.visibility="visible";mor.isLowFuncBrowser()&&(mor.byId("dlgdiv").style.backgroundColor="#eeeeee");mor.onescapefunc=mor.layout.closeDialog;mor.byId("searchoptionsdiv").style.display="none";mor.byId("searchtxt").focus();setTimeout(mor.activity.startPenSearch,50)},moreact:function(){y(!0)},notePenNameStr:function(d){var e,c,g;g=mor.pen.currPenRef().actdisp.revrefs;
c=mor.instId(d);for(e=0;e<g.length;e+=1)g[e].rev.penid===c&&(g[e].rev.penNameStr=d.name);u()},searchPensLinkHTML:function(){return x()},togglesrchopts:function(){var d=mor.byId("searchoptionsdiv");d&&("none"===d.style.display?(mor.out("srchoptstogglehref","hide advanced search options"),d.style.display="block"):(mor.out("srchoptstogglehref","show advanced search options"),d.style.display="none"));mor.layout.adjust()},activityLinkHTML:function(){return'<div class="topnavitemdiv">'+mor.imgntxt("friendact.png",
"Friend Reviews","mor.activity.displayActive()","#Activity","See what's been posted recently")+"</div>"},rememberedLinkHTML:function(){return'<div class="topnavitemdiv">'+mor.imgntxt("remembered.png","Remembered Reviews","mor.activity.displayRemembered()","#Remembered","Show remembered reviews")+"</div>"},displayActive:function(){v("activity")},displayRemembered:function(){v("memo")},switchmode:function(d){h=d;v("activity")},toptype:function(d){n=d;v("activity")},startPenSearch:function(){mor.pen.currPenRef().pensearch=
{params:{},pens:[],cursor:"",total:0,requests:1};m()},searchPens:function(){m()},reset:function(){mor.pen.currPenRef().actdisp=null}}});
define("amd/pen",[],function(){var h,n,d,t=function(d){"object"===typeof d.revmem&&(d.revmem=mor.dojo.json.stringify(d.revmem));"object"===typeof d.settings&&(d.settings=mor.dojo.json.stringify(d.settings))},m=function(d){var h,l;if(d.revmem){if("object"!==typeof d.revmem)try{h=d.revmem,l=mor.dojo.json.parse(h),d.revmem=l}catch(e){mor.log("pen.deserializeFields "+d.name+": "+e),d.revmem={}}}else d.revmem={};"object"!==typeof d.revmem&&(mor.log("Re-initializing penName revmem.  Deserialized value was not an object: "+
d.revmem),d.revmem={});if(d.settings){if("object"!==typeof d.settings)try{h=d.settings,l=mor.dojo.json.parse(h),d.settings=l}catch(c){mor.log("pen.deserializeFields "+d.name+": "+c),d.settings={}}}else d.settings={};"object"!==typeof d.settings&&(mor.log("Re-initializing penName settings.  Deserialized value was not an object: "+d.settings),d.settings={});d.top20s?"string"===typeof d.top20s&&(d.top20s=mor.dojo.json.parse(d.top20s)):d.top20s={}},p=function(){var d;if(d=n&&n.pen)d="penid="+mor.instId(d),
mor.call("penbyid?"+d,"GET",null,function(d){0<d.length&&(n.pen.name=d[0].name,n.pen.shoutout=d[0].shoutout,n.pen.city=d[0].city,n.pen.accessed=d[0].accessed,n.pen.modified=d[0].modified,n.pen.top20s=d[0].top20s,n.pen.following=d[0].following,n.pen.followers=d[0].followers,mor.profile.resetReviews())},function(d,l){mor.log("refreshCurrentPenFields "+d+" "+l)},"")},q=function(h){h||(h=d);mor.layout.initContent();mor.rel.loadoutbound();h(n.pen)},r=function(d,h,l){var e;t(d);e=mor.objdata(d);mor.call("updpen?"+
mor.login.authparams(),"POST",e,function(c){n=mor.lcs.putPen(c[0]);h(n)},function(c,g){m(d);l(c,g)},"")},u=function(){var d,m,l;l=mor.byId("pnamein").value;d=mor.byId("formbuttons").innerHTML;mor.out("formbuttons","Creating Pen Name...");m={};m.name=l;n&&n.settings&&(m.settings=n.settings,t(m));m=mor.objdata(m);mor.call("newpen?"+mor.login.authparams(),"POST",m,function(d){n=mor.lcs.putPen(d[0]);h||(h=[]);h.push(n);mor.rel.resetStateVars("new");q()},function(e,c){mor.out("penformstat",c);mor.out("formbuttons",
d)},"")},A=function(h){var m="";d=h;mor.login.updateAuthentDisplay("hide");mor.out("centerhdiv","");n&&n.pen&&(m='<button type="button" id="cancelbutton" onclick="mor.pen.cancelNewPen();return false;">Cancel</button>');mor.out("contentdiv",'<div id="chead"> </div><div id="cmain"><p>Your pen name is a unique expression of style. You can have separate pen names for different personas, revealing as much (or as little) about yourself as you want. Use your real name, or get creative...</p><div id="penformstat">&nbsp;</div><table class="pennametable"><tr><td rowspan="2"><img src="img/penname.png"/></td><td class="formattr">Writing as...</td></tr><tr><td class="formval"><input type="text" id="pnamein" size="34"/></td></tr><tr><td colspan="2" id="formbuttons"align="center">'+
m+'<button type="button" id="createbutton">Create</button></td></tr></table></div>');mor.onchange("pnamein",u);mor.onclick("createbutton",u);mor.layout.adjust();mor.byId("pnamein").focus()},y=function(d){if(!h||0===h.length)return A(d);var m,l="0000-00-00T00:00:00Z",e;if(h&&h.length)for(m=0;m<h.length;m+=1)h[m].pen.accessed>l&&(l=h[m].pen.accessed,e=h[m]);n=e;mor.skinner.setColorsFromPen(n.pen);q(d)},x=function(d){var m;h&&y(d);mor.out("contentdiv","<p>Retrieving your pen name(s)...</p>");mor.layout.adjust();
m="mypens?"+mor.login.authparams();mor.call(m,"GET",null,function(l){var e;h=[];for(e=0;e<l.length;e+=1)h.push(mor.lcs.putPen(l[e]));y(d)},function(d,e){mor.out("contentdiv","Pen name retrieval failed: "+d+" "+e)},"")};return{resetStateVars:function(){d=n=h=null},getPen:function(d){if(n)return d(n.pen);x(d)},currPenId:function(){return n&&n.pen?mor.instId(n.pen):0},currPenRef:function(){return n},updatePen:function(d,h,l){r(d,h,l)},getPenNames:function(){var d,m=[];for(d=0;h&&d<h.length;d+=1)m.push(h[d].pen);
return m},newPenName:function(d){A(d)},selectPenByName:function(d){var m;for(m=0;m<h.length;m+=1)if(h[m].pen.name===d){n=h[m];mor.skinner.setColorsFromPen(n.pen);mor.rel.resetStateVars("reload",n.pen);r(h[m].pen,mor.profile.display,mor.profile.display);break}},refreshCurrent:function(){p()},deserializeFields:function(d){m(d)},cancelNewPen:function(){mor.login.updateAuthentDisplay();mor.profile.display()}}});
define("amd/rel",[],function(){var h,n,d=function(b,a,c){b=mor.lcs.getPenRef(b);a="outbound"===a?"outrels":"inrels";!b[a]&&c&&(b[a]=[]);return b[a]},t=function(b,a,c){c=mor.lcs.putRel(c);b=mor.lcs.getPenRef(b);a="outbound"===a?"outrels":"inrels";b[a]||(b[a]=[]);b[a].push(c)},m=function(b,a,c,g){var e;if(d(b,a)&&!g)return mor.rel.displayRelations(b,a,c);e=mor.login.authparams()+"&"+("outbound"===a?"originid":"relatedid")+"="+mor.instId(b);g&&(e+="&cursor="+g);mor.call("findrels?"+e,"GET",null,function(d){var g,
e;for(g=0;g<d.length;g+=1){if(d[g].fetched){d[g].cursor&&(e=d[g].cursor);break}t(b,a,d[g])}e?m(b,a,c,e):mor.rel.displayRelations(b,a,c)},function(a,b){var c="loadDisplayRels error code "+a+": "+b;mor.log(c);mor.err(c)},"")},p=function(b,a){var c,d;c=b.rel.relatedid;d=mor.lcs.getPenRef(c);d.pen&&(c=b.rel.originid,d=mor.lcs.getPenRef(c));if(d.pen)return a();mor.lcs.getPenFull(c,a)},q=function(b,a,c){b=mor.lcs.getPenRef(b.rel["outbound"===a?"relatedid":"originid"]);if("ok"!==b.status&&"not cached"!==
b.status)return"";if(b.pen&&(c=mor.profile.penListItemHTML(b.pen),"inbound"===a)){a=c=c.slice(0,c.indexOf("</li>"));a:{b=b.pen;var g,e;e=mor.instId(b);g=d(b,"outbound");for(c=0;g&&c<g.length;c+=1)if(g[c].rel.relatedid===e){b="";break a}b=' <a href="#followback" title="follow '+b.name+'" onclick="mor.rel.followBack('+mor.instId(b)+');return false;" class="smalltext">[follow back]</a>'}c=a+(b+"</li>")}return c},r=function(b,a,c){var g,e,l,h;e=d(b,a);g='<ul class="penlist">';if(e)if(0<e.length){for(l=
0;l<e.length&&100>l&&!(h=q(e[l],a,"<li>Fetching pen names</li>"),g+=h,"<li>Fetching pen names</li>"===h);l+=1);l===e.length&&(g+='<div id="srchpenslinkdiv"><a id="srchpens" href="#findpens" onclick="mor.activity.pensearchdialog();return false;"><img class="reviewbadge" src="img/follow.png">Find pen names to follow</a></div>')}else 0===e.length&&("outbound"===a?(g+="<li>Not following anyone.</li>",mor.instId(b)===mor.pen.currPenId()&&(g+="<li>"+mor.activity.searchPensLinkHTML()+"</li>")):g+="<li>No followers.</li>");
else g+="<li>fetching relationships...</li>";mor.out(c,g+"</ul>");e?"<li>Fetching pen names</li>"===h&&p(e[l],function(){r(b,a,c)}):m(b,a,c)},u=function(){mor.safeget("follow","checked")?mor.out("fstatdescr","Show new reviews under friend reviews"):mor.safeget("block","checked")?mor.out("fstatdescr","List as following, but do not show new reviews"):mor.safeget("nofollow","checked")&&mor.out("fstatdescr","Do not show new reviews, do not list as following")},A=function(b){var a;"blocked"===b.status?
mor.byId("block").checked=!0:mor.byId("follow").checked=!0;if(b.mute){b=b.mute.split(",");for(a=0;a<b.length;a+=1)mor.byId(b[a]).checked=!0}u()},y=function(b){var a=mor.objdata(b);"nofollow"===b.status?mor.call("delrel?"+mor.login.authparams(),"POST",a,function(a){var c=a[1];mor.lcs.putPen(a[0]);mor.lcs.putPen(c);var d,g=mor.instId(b),c=mor.pen.currPenRef();if(c.outrels){for(d=0;d<c.outrels.length&&mor.instId(c.outrels[d].rel)!==g;d+=1);d<c.outrels.length&&c.outrels.splice(d,1)}mor.lcs.remRel(b);
mor.layout.closeDialog();mor.activity.reset();mor.profile.byprofid(mor.instId(a[1]))},function(a,b){mor.err("Relationship deletion failed code "+a+": "+b)},""):mor.call("updrel?"+mor.login.authparams(),"POST",a,function(a){mor.lcs.putRel(a[0]);mor.layout.closeDialog();mor.activity.reset();mor.profile.byprofid(a[0].relatedid)},function(a,b){mor.err("Relationship update failed code "+a+": "+b)},"")},x=function(b,a,c){var d='<div class="dlgclosex"><a id="closedlg" href="#close" onclick="mor.layout.closeDialog();return false;">&lt;close&nbsp;&nbsp;X&gt;</a></div><div class="floatclear"></div><span class="headingtxt">',
d=c?d+("You are now following "+a.name):d+("Follow settings for "+a.name),d=d+('</span><table class="formstyle"><tr><td><b>Status</b> '+mor.radiobutton("fstat","follow","",!1,"mor.rel.fchg")+"&nbsp;"+mor.radiobutton("fstat","block","",!1,"mor.rel.fchg")+"&nbsp;"+mor.radiobutton("fstat","nofollow","Stop Following",!1,"mor.rel.fchg")+'</td></tr><tr><td><div id="fstatdescr"></div></td></tr><tr><td><b>Ignore reviews from '+a.name+" about</b>"+mor.review.reviewTypeCheckboxesHTML("mtype")+'</td></tr><tr><td colspan="2" align="center" id="settingsbuttons"><button type="button" id="savebutton">Save</button></td></tr></table>');
mor.out("dlgdiv",d);A(b);mor.onclick("savebutton",function(){mor.out("settingsbuttons","Saving...");var a,c;mor.byId("follow").checked?b.status="following":mor.byId("block").checked?b.status="blocked":mor.byId("nofollow").checked&&(b.status="nofollow");b.mute="";a=document.getElementsByName("mtype");for(c=0;c<a.length;c+=1)a[c].checked&&(b.mute&&(b.mute+=","),b.mute+=a[c].value);y(b)});mor.byId("dlgdiv").style.visibility="visible";mor.onescapefunc=mor.layout.closeDialog},w=function(b){var a,c;a=mor.pen.currPenRef().pen;
a=d(a,"outbound");for(c=0;a&&c<a.length;c+=1)if(a[c].rel.relatedid===b)return a[c].rel},v=function(b,a){var c,d;(c=w(mor.instId(a)))?x(c,a):h?alert("Still loading relationships, try again in a few seconds"):(d={},d.originid=mor.instId(b),d.relatedid=mor.instId(a),mor.assert(d.originid&&d.relatedid),d.status="following",d.mute="",d.cutoff=0,c=mor.objdata(d),mor.call("newrel?"+mor.login.authparams(),"POST",c,function(a){var b=a[0],c=a[1];d=a[2];mor.lcs.putPen(b);mor.lcs.putPen(c);t(b,"outbound",d);
mor.profile.refresh();x(a[2],a[1],!0)},function(a,b){mor.err("Relationship creation failed code "+a+": "+b)},""))},l=function(b){mor.pen.getPen(function(a){mor.lcs.getPenFull(b,function(b){v(a,b.pen,mor.instId(a))})})},e=function(b){var a=mor.pen.currPenRef();a.outrels||(a.outrels=[]);a.outrels.push(b)},c=function(){var b,a;b=mor.pen.currPenRef().pen;a=mor.login.authparams()+"&originid="+mor.instId(b);h&&"starting"!==h&&(a+="&cursor="+mor.enc(h));mor.call("findrels?"+a,"GET",null,function(a){var d,
g;h="";for(d=0;d<a.length;d+=1){if(a[d].fetched){a[d].cursor&&(h=a[d].cursor);break}g=mor.lcs.putRel(a[d]);e(g)}h?setTimeout(function(){c(b)},50):mor.profile.updateHeading()},function(a,b){mor.log("loadOutboundRelationships errcode "+a+": "+b);alert("Sorry. Data error. Please reload the page")},"")},g=function(){!n&&!mor.pen.currPenRef().outrels&&(n=!0,h="starting",setTimeout(function(){c()},50))};return{resetStateVars:function(b,a){h=null;n=!1;"new"===b?(mor.pen.currPenRef().outrels=[],n=!0,mor.profile.updateHeading()):
"logout"!==b&&mor.rel.loadoutbound()},reledit:function(b,a){v(b,a)},fchg:function(){u()},outbound:function(b){return w(b)},loadoutbound:function(){g()},outboundids:function(){var b,a,c=[];b=mor.pen.currPenRef().pen;b=d(b,"outbound");for(a=0;b&&a<b.length;a+=1)"following"===b[a].rel.status&&c.push(b[a].rel.relatedid);n?h&&c.push("loading"):c.push("waiting");return c},displayRelations:function(b,a,c){return r(b,a,c)},followBack:function(b){l(b)},relsLoaded:function(){return n&&!h}}});
define("amd/skinner",[],function(){var h,n,d,t,m=[{id:"bodybg",label:"background"},{id:"darkbg",label:"shadow"},{id:"lightbg",label:"text area"},{id:"text",label:"text"},{id:"link",label:"link"},{id:"hover",label:"hover"}],p=[{name:"paper (warm)",id:"paperw",bodybg:"#fffffc",text:"#111111",lightbg:"#fffffe",darkbg:"#9b9b9a",link:"#521919",hover:"#885555"},{name:"paper (cool)",id:"paperc",bodybg:"#f8f8f8",text:"#111111",lightbg:"#fcfcfc",darkbg:"#a2a2a2",link:"#006666",hover:"#339999"},{name:"slate",
id:"slate",bodybg:"#ccdad9",text:"#111111",lightbg:"#d0deda",darkbg:"#72817f",link:"#003300",hover:"#447744"},{name:"parchment",id:"parchment",bodybg:"#dfb374",text:"#111111",lightbg:"#ffefaf",darkbg:"#997335",link:"#333300",hover:"#666633"}],q=function(a){return{name:a.name,id:a.id,bodybg:a.bodybg,text:a.text,lightbg:a.lightbg,darkbg:a.darkbg,link:a.link,hover:a.hover}},r=function(a,b){a.style.setProperty&&a.style.setProperty("color",b,null)},u=function(a,b,c){a[b]+=c;255<a[b]&&(a[b]=255);0>a[b]&&
(a[b]=0)},A=function(a,b){var c;c=a;0<=c.indexOf("#")&&(c=c.slice(1));c=c.toUpperCase();c=[parseInt(c.slice(0,2),16),parseInt(c.slice(2,4),16),parseInt(c.slice(4,6),16)];u(c,0,b);u(c,1,b);u(c,2,b);var d="#",g,e;for(e=0;e<c.length;e+=1)g=c[e].toString(16),2>g.length&&(g="0"+g),d+=g;return d},y=function(){mor.colors.lightbg||(mor.colors.lightbg=A(mor.colors.bodybg,4));return mor.colors.lightbg},x=function(){mor.colors.darkbg||(mor.colors.darkbg=A(mor.colors.bodybg,-56));return mor.colors.darkbg},w=
function(){var a,b,c=["recentli","bestli","followingli","followersli","searchli"];if(a=mor.byId("bodyid"))a.style.color=mor.colors.text,a.style.backgroundColor=mor.colors.bodybg;if(a=mor.byId("topsectiondiv"))a.style.backgroundColor=y(),b="8px 8px 4px "+x(),a.style.boxShadow=b;if(a=mor.byId("shoutdiv"))a.style.backgroundColor=y();for(b=0;b<c.length;b+=1)if((a=mor.byId(c[b]))&&"unselectedTab"===a.className)a.style.backgroundColor=x();a=document.styleSheets[0].cssRules;for(b=0;a&&b<a.length;b+=1)mor.prefixed(a[b].cssText,
"A:link")?r(a[b],mor.colors.link):mor.prefixed(a[b].cssText,"A:visited")?r(a[b],mor.colors.link):mor.prefixed(a[b].cssText,"A:active")?r(a[b],mor.colors.link):mor.prefixed(a[b].cssText,"A:hover")&&r(a[b],mor.colors.hover)},v=function(a){var b,c,d;b='<table><tr><td align="right">Display</td><td align="left"><select id="presetsel">';for(c=0;c<p.length;c+=1)d=p[c].id,b+='<option id="'+d+'"',a&&(a.settings&&a.settings.colorPresetId===d)&&(b+=' selected="selected"'),b+=">"+p[c].name+"</option>";return b+
'</select></td><td>&nbsp;&nbsp;<a href="#toggleSkinControls" id="skinctrltoggle" class="permalink" onclick="mor.skinner.toggleControls();return false;">show color controls</a></td></tr></table>'},l=function(a){a||(a=0);"string"===typeof a&&(a=parseInt(a,10));t=m[a];mor.out("colortitlediv",t.label+' <span class="smalltext">(click only, drag disabled)</span>');d.setColor(mor.colors[t.id],!0)},e=function(a){var b,c,g,e;e='<table border="0">';for(b=0;b<m.length;b+=1)c=m[b].label,g=m[b].id,e+='<tr><td class="colorattrtd">'+
c+'</td><td><div id="'+g+'div" class="colorswatch" onclick="mor.skinner.swatchClick(\''+b+'\');return false;" style="background:'+mor.colors[g]+';"></div>',0===b&&(e+='<td rowspan="'+m.length+'" valign="top"><div id="colortitlediv"></div><div id="colorwidgetdiv"></div></td>'),e+="</tr>";mor.out("colorctrlsdiv",e+"</table>");d&&d.destroy();d=new a({onChange:function(a){mor.byId(t.id+"div").style.backgroundColor=a;mor.colors[t.id]=a;w()}},"colorwidgetdiv");l(0)},c=function(){var a;"show color controls"===
mor.byId("skinctrltoggle").innerHTML?(a=document.styleSheets[0].cssRules)&&a[0].style.setProperty?(mor.byId("colorctrlsdiv").style.display="block",mor.out("skinctrltoggle","hide color controls"),(a=mor.byId("colorctrlsdiv").innerHTML)||require(mor.cdnconf,["dojox/widget/ColorPicker","dojo/domReady!"],function(a){e(a)})):mor.byId("skinctrltoggle").style.color="#666666":(mor.byId("colorctrlsdiv").style.display="none",mor.out("skinctrltoggle","show color controls"))},g=function(a){var b,c=mor.byId("presetsel");
for(b=0;b<c.options.length;b+=1)if(c.options[b].selected){n=a;a.settings.colorPresetId=p[b].id;c=a=a=void 0;mor.colors=q(p[b]);w();if(a=mor.byId("colorctrlsdiv").innerHTML){for(a=0;a<m.length;a+=1)c=mor.byId(m[a].id+"div"),c.style.backgroundColor=mor.colors[m[a].id];l(0)}break}},b=function(a,b){var c;h=q(mor.colors);c=v(b)+'<div id="colorctrlsdiv" style="display:none;"></div>';mor.out(a,c);mor.onx("change","presetsel",function(a){a.preventDefault();a.stopPropagation();mor.pen.getPen(g)})};return{init:function(a,
c){b(a,c)},cancel:function(){h&&(mor.colors=h);n&&(n.settings&&n.settings.colorPresetId)&&(n.settings.colorPresetId=h.id);w()},save:function(a){a.settings.colors=q(mor.colors)},setColorsFromPen:function(a){a?a.settings?("string"===typeof a.settings&&mor.pen.deserializeFields(a),mor.colors=a.settings.colors?q(a.settings.colors):p[0]):mor.colors=p[0]:mor.colors=p[0];w()},lightbg:function(){return y()},darkbg:function(){return x()},toggleControls:function(){c()},swatchClick:function(a){l(a)}}});
define("amd/services",[],function(){var h,n=["enabled","disabled","on click"],d="",t=function(d){var m,n;for(m=0;m<h.length;m+=1)if(h[m].name===d){n=h[m];break}n&&!n.svcDispName&&(n.svcDispName=n.name);return n},m=function(d,h,m,n,p){return'<a href="'+d+'" title="'+n+'" onclick="'+h+'"><img class="'+m+'" alt="'+n+'" src="'+p+'" border="0"/></a>'},p=function(d){var h,m=!1;if("string"!==typeof d.name||d.status)return!1;"string"!==typeof d.state&&(d.state=n[0]);for(h=0;h<n.length;h+=1)if(d.state===n[h]){m=
!0;break}m||(d.state=n[0]);return!0},q=function(d,m){var r,q,w,v,l,e;r=[];mor.pen.deserializeFields(d);d.settings.consvcs||(d.settings.consvcs=[]);for(q=0;q<d.settings.consvcs.length;q+=1)if(l=d.settings.consvcs[q],p(l))for(w=0;w<h.length;w+=1)v=h[w],l.name===v.name&&r.push(l);for(q=0;q<h.length;q+=1){v=h[q];e=!1;for(w=0;!e&&w<d.settings.consvcs.length;w+=1)l=d.settings.consvcs[w],l.name===v.name&&p(l)&&(e=!0);e||(l={name:v.name,state:n[0]},r.push(l))}d.settings.consvcs=r;m()},r=function(d,m){if(h)return q(d,
m);require(["ext/facebook","ext/twitter","ext/googleplus","ext/email"],function(n,p,r,v){mor.facebook||(mor.facebook=n);mor.twitter||(mor.twitter=p);mor.googleplus||(mor.googleplus=r);mor.email||(mor.email=v);h=[n,p,r,v];q(d,m)})};return{display:function(d,h){r(h,function(){var m,p="Posting Services: <table>";mor.pen.deserializeFields(h);if(h.settings.consvcs&&0<h.settings.consvcs.length)for(m=0;m<h.settings.consvcs.length;m+=1){var q=h.settings.consvcs[m],r=void 0,l=void 0,e=void 0,e=t(q.name),r=
l="<tr><td>",l=e,c=void 0,g="";if(c=l.svcIconURL||l.iconurl)g+='<img class="svcico" src="',g=0===c.indexOf("http")?g+c:0===c.indexOf("img")?g+c:g+("svcpic?serviceid="+l.name),g+='"/>';l=r+g;l+='</td><td><select id="'+e.name+'sel" onchange="mor.services.changestate(\''+e.name+"');return false;\">";for(r=0;r<n.length;r+=1)l+='<option id="'+q.name+ +r+'"',q.state===n[r]&&(l+=' selected="selected"'),l+=">"+n[r]+"</option>";l+='</select></td><td><a href="#'+e.svcDispName+'" title="'+mor.ellipsis(e.svcDesc,
65)+'" onclick="mor.services.toggleDesc(\'svcdescdiv'+e.name+"');return false;\">"+e.svcDispName+'</a><div id="svcdescdiv'+e.name+'" style="display:none;">'+mor.linkify(e.svcDesc)+"</div></td></tr>";p+=l}else p+="<tr><td>No posting services available</td></tr>";mor.out(d,p+"</table>")})},toggleDesc:function(d){if(d=mor.byId(d))d.style.display="none"===d.style.display?"block":"none"},changestate:function(d){mor.pen.getPen(function(h){var m,p,r;mor.pen.deserializeFields(h);if(m=mor.byId(d+"sel")){for(r=
0;!p&&r<h.settings.consvcs.length;r+=1)h.settings.consvcs[r].name===d&&(p=h.settings.consvcs[r]);p&&(p.state=n[m.selectedIndex])}})},getRevStarsTxt:function(d,h){var m,n;m=mor.review.starRating(d.rating,!1);n="("+m.roundnum+" "+(1===m.roundnum?"star":"stars")+")";return"combo"===h?m.unihtml+" "+n:"txtexp"===h?m.asterisks+" "+n:"numeric"===h?n:"unicode"===h?m.unicode:m.asterisks},getRevTitleTxt:function(d){var h,m;m=mor.review.getReviewTypeByValue(d.revtype);h=d[m.key];m.subkey&&(h+=", "+d[m.subkey]);
return h},getRevTypeImage:function(d){return"http://www.myopenreviews.com/img/"+mor.review.getReviewTypeByValue(d.revtype).img},displayShare:function(h,p,q,x){d=p;r(q,function(){var d,p,l,e,c,g,b="";mor.pen.deserializeFields(q);x.svcdata||(x.svcdata={});if(q.settings.consvcs&&0<q.settings.consvcs.length){b='<table id="svcbuttontable"><tr>';for(l=0;l<q.settings.consvcs.length;l+=1)e=q.settings.consvcs[l],c=t(e.name),g="shareicodis",d="#disabled",p="",e.state===n[0]?(setTimeout(c.doInitialSetup,50),
d=c.getLinkURL(x),p=c.getOnClickStr(x),g="shareico"):e.state===n[2]&&(d="#disabled, click to enable",p="mor.services.enable('"+e.name+"');return false;"),b+='<td id="'+c.name+'td">'+m(d,p,g,c.getShareImageAlt(),c.getShareImageSrc())+"</td>";b+="</tr></table>"}mor.out(h,b)})},enable:function(d){var h;h=mor.review.getCurrentReview();d=t(d);setTimeout(d.doInitialSetup,50);h=m(d.getLinkURL(h),d.getOnClickStr(h),"shareico",d.getShareImageAlt(),d.getShareImageSrc());mor.out(d.name+"td",h)},getRevPermalink:function(d){return"http://www.myopenreviews.com/statrev/"+
mor.instId(d)},getPostServiceMsgDiv:function(){return d},serviceLinkHTML:function(d,h,n,p,r){return m(d,h,n,p,r)}}});
define("amd/lcs",[],function(){var h={},n={},d={},t=function(c){"object"===typeof c&&(c=mor.instId(c));"number"===typeof c&&(c=String(c));return c},m=function(c){var d;c=t(c);(d=h[c])||(d={status:"not cached",penid:c,updtime:new Date});return d},p=function(c){var d;mor.pen.deserializeFields(c);d=m(c);h[t(c)]=d;d.pen=c;d.status="ok";d.updtime=new Date;return d},q=function(c,d){var b,a;if((b=m(c))&&"ok"===b.status&&b.pen)return d(b);b="penid="+t(c);mor.call("penbyid?"+b,"GET",null,function(b){0<b.length?
d(p(b[0])):(a={status:"deleted",updtime:new Date},h[t(c)]=a,d(a))},function(b,e){a={status:String(b)+": "+e,updtime:new Date};h[t(c)]=a;d(a)},"",null,[400,404])},r=function(c){var d;c=t(c);(d=n[c])||(d={status:"not cached",relid:c,updtime:new Date});return d},u=function(c){var g;c=t(c);(g=d[c])||(g={status:"not cached",revid:c,updtime:new Date});return g},A=function(c){var g;g=u(c);d[t(c)]=g;g.rev=c;g.status="ok";g.updtime=new Date;return g},y=function(c,g){var b,a;if((b=u(c))&&"ok"===b.status&&b.rev)return g(b);
b="revid="+t(c);mor.call("revbyid?"+b,"GET",null,function(b){0<b.length?g(A(b[0])):(a={status:"deleted",updtime:new Date},d[t(c)]=a,g(a))},function(b,e){a={status:String(b)+": "+e,updtime:new Date};d[t(c)]=a;g(a)},"",null,[400,404])},x=function(c,g){var b,a,e=[];for(b in d)if(d.hasOwnProperty(b)&&((a=d[b])&&!a.revlink&&e.push(b),20<=e.length))break;0<e.length?(b="revids="+e.join(",")+"&"+mor.login.authparams(),mor.call("revlinks?"+b,"GET",null,function(a){var b,g;for(b=0;b<e.length;b+=1)g=String(e[b]),
d[g].revlink={revid:parseInt(g,10),helpful:"",remembered:"",corresponding:""};for(b=0;b<a.length;b+=1)g=String(a[b].revid),d[g].revlink=a[b];x(c,!0)},function(a,b){mor.err("verifyReviewLinks revlinks call failed "+a+" "+b)},"")):0===e.length&&g&&c()},w=function(c,d){var b,a,e,h;b=c.revlink;a=String(mor.instId(d))+":"+d.penid;if(b.corresponding){e=b.corresponding.split(",");for(h=0;h<e.length;h+=1)if(e[h]===a)return;e.push(a);b.corresponding=e.join(",")}else b.corresponding=a;b.critsec="";a=mor.objdata(b);
mor.call("updlink?"+mor.login.authparams(),"POST",a,function(a){mor.log("verifyCorrespondingLink updated "+a[0].revid+" corresponding: "+a[0].corresponding)},function(a,b){mor.log("verifyCorrespondingLink failed "+a+" "+b)},b.critsec)},v=function(c,d){var b,a;c.penid!==d.penid&&(b=u(mor.instId(c)),"not cached"===b.status&&(b=A(c)),a=u(mor.instId(d)),"not cached"===a.status&&(a=A(d)),!b.revlink||!a.revlink?setTimeout(function(){x(function(){v(c,d)})},50):(w(b,d),w(a,c)))},l=function(c){var e,b;for(e in d)d.hasOwnProperty(e)&&
(b=d[e])&&(b.rev&&b.rev.cankey===c.cankey&&b.rev.penid!==c.penid)&&v(c,b.rev)},e=function(c){var d;l(c);d="revtype="+c.revtype+"&cankey="+c.cankey+"&"+mor.login.authparams();mor.call("revbykey?"+d,"GET",null,function(b){var a;for(a=0;a<b.length;a+=1)A(b[a]);l(c)},function(b,a){mor.log("checkAllCorresponding failed "+b+": "+a)},"")};return{getPenRef:function(c){return m(c)},getPenFull:function(c,d){q(c,d)},putPen:function(c){return p(c)},remPen:function(c){c=m(c);c.status="deleted";c.updtime=new Date;
c.pen=null},getRelRef:function(c){return r(c)},putRel:function(c){var d;d=r(c);n[t(c)]=d;d.rel=c;d.status="ok";d.updtime=new Date;return d},remRel:function(c){c=r(c);c.status="deleted";c.updtime=new Date;c.pen=null},getRevRef:function(c){return u(c)},getRevFull:function(c,d){y(c,d)},putRev:function(c){return A(c)},verifyReviewLinks:function(c){x(c)},verifyCorrespondingLinks:function(c,d){v(c,d)},checkAllCorresponding:function(c){e(c)}}});
define("amd/basicmod",[],function(){var h;return{logit:function(){h=h?h+1:1;console.log("basicmod logCount: "+h)}}});
define("ext/facebook",[],function(){var h,n=function(c){var b="<p>&nbsp;</p><p>Facebook login success! Fetching your info...</p>";mor.out("contentdiv",b);FB.api("/me",function(a){b="<p>&nbsp;</p><p>Welcome "+a.name+"</p>";mor.out("contentdiv",b);mor.login.setAuth("fbid",c.authResponse.accessToken,a.id+" "+a.name);mor.login.authComplete()})},d=function(c,b,a,d){c="<p>"+("not_authorized"===c.status?"You have not yet authorized MyOpenReviews, click to authorize...":"You are not currently logged into Facebook, click to log in...")+
'</p><table><tr><td><a href="http://www.facebook.com" title="Log in to Facebook" onclick="mor.facebook.'+a+';return false;"><img class="loginico" src="img/f_logo.png" border="0"/> Log in to Facebook</a></td>';d&&(c+='<td>&nbsp;<button type="button" id="cancelbutton" onclick="'+d+';return false;">Cancel</button></td>');mor.out(b,c+"</tr></table>");d&&mor.layout.adjust()},t=function(){FB.login(function(c){"connected"===c.status?n(c):mor.login.init()})},m=function(){FB.getLoginStatus(function(c){"connected"===
c.status?n(c):d(c,"contentdiv","loginFB()","mor.login.init()")})},p=function(c,b){var a,d;window.fbAsyncInit=function(){FB.init({appId:0xf104803ca267,status:!0,cookie:!0,xfbml:!0});c()};mor.byId("facebook-jssdk")||(a=document.createElement("script"),a.id="facebook-jssdk",a.async=!0,a.src="//connect.facebook.net/en_US/all.js",d=document.getElementsByTagName("script")[0],d.parentNode.insertBefore(a,d),b||(b="contentdiv"),"quiet"!==b&&mor.out(b,"<p>&nbsp;</p><p>Loading Facebook API...</p>"),mor.layout.adjust())},
q=function(c,b,a){var d;if(!a)return mor.err("No userID received from Facebook"),mor.profile.displayAuthSettings(c,b);d=parseInt(a,10);if(!d||0>=d)return mor.err("Invalid userID received from Facebook"),mor.profile.displayAuthSettings(c,b);mor.out(c,"Recording Facebook authorization...");b.fbid=a;mor.pen.updatePen(b,function(a){mor.profile.displayAuthSettings(c,a)},function(a,d){mor.err("facebook.addProfileAuth3 error "+a+": "+d);b.fbid=0;mor.profile.displayAuthSettings(c,b)})},r=function(c,b){FB.getLoginStatus(function(a){"connected"===
a.status?q(c,b,a.authResponse.userID):d(a,c,"authFB('"+c+"')")})},u=function(c,b){if(0!==window.location.href.indexOf(mor.mainsvr))return alert("Facebook authentication is only supported from "+mor.mainsvr),mor.profile.displayAuthSettings(c,b);if("object"===typeof FB||"function"===typeof FB)return r(c,b);p(function(){r(c,b)})},A=function(c){FB.login(function(b){"connected"===b.status?mor.pen.getPen(function(a){q(c,a,b.authResponse.userID)}):mor.pen.getPen(function(a){mor.profile.displayAuthSettings(c,
a)})})},y=function(){var c=mor.byId("overlaydiv");c.innerHTML="";c.style.visibility="hidden"},x=function(c){c.svcdata.Facebook="bailout"},w=function(c){var b,a,d,e;b=mor.services.getRevStarsTxt(c,"unicode")+" "+mor.services.getRevTitleTxt(c);a=mor.services.getRevPermalink(c);d="http://www.myopenreviews.com/#command=remember&penid="+c.penid+"&revid="+mor.instId(c);e=mor.services.getRevTypeImage(c);FB.ui({method:"feed",message:c.revtype+" review",name:b,caption:c.keywords,description:c.text,link:a,
picture:e,actions:[{name:"Remember",link:d}],user_message_prompt:"Check this out if..."},function(a){a&&a.post_id?(mor.log("Review posted to Facebook"),c.svcdata.Facebook=a.post_id):(mor.log("Posting to Facebook did not happen."),c.svcdata.Facebook="nopost")})},v=function(c){FB.login(function(b){y();mor.onescapefunc=null;"connected"===b.status?w(c):x(c)})},l=function(c){FB.getLoginStatus(function(b){var a;"connected"===b.status?w(c,b.authResponse.userID):(h=c,a=mor.byId("overlaydiv"),a.style.top=
"80px",a.style.visibility="visible",a.style.backgroundColor=mor.skinner.lightbg(),mor.onescapefunc=function(){y();x(c)},d(b,"overlaydiv","postTmpRev()","bailTmpRev()"))})},e=function(){0===window.location.href.indexOf(mor.mainsvr)&&!("object"===typeof FB||"function"===typeof FB)?p(function(){console.log("facebook service initial setup done")},"quiet"):console.log("facebook service initial setup skipped")},c=function(c){if(0!==window.location.href.indexOf(mor.mainsvr))return alert("Posting to Facebook is only supported from "+
mor.mainsvr),x(c);if("object"===typeof FB||"function"===typeof FB)return l(c);p(function(){l(c)})};return{loginurl:"https://www.facebook.com",name:"Facebook",svcDispName:"Facebook Wall Post",svcDesc:"Posts a review to your wall",iconurl:"img/f_logo.png",loginFB:function(){t()},authenticate:function(){a:{try{if(mor.isDefined(FB)){m();break a}}catch(c){mor.log("facebook.js authenticate error: "+c)}p(m)}},addProfileAuth:function(c,b){u(c,b)},authFB:function(c){A(c)},doInitialSetup:function(){e()},getLinkURL:function(c){c=
mor.services.getRevPermalink(c);return c="http://www.facebook.com/sharer/sharer.php?u="+mor.enc(c)},getOnClickStr:function(c){return"mor.facebook.shareCurrentReview();return false;"},shareCurrentReview:function(){c(mor.review.getCurrentReview())},getShareImageAlt:function(){return"Post to your wall"},getShareImageSrc:function(){return mor.facebook.iconurl},postTmpRev:function(){y();v(h)},bailTmpRev:function(){y();x(h)}}});
define("ext/twitter",[],function(){var h=function(){var d=mor.dojo.cookie("addAuthOutDiv");return d?mor.pen.getPen(function(h){mor.profile.displayAuthSettings(d,h)}):mor.login.init()},n=function(d){mor.out("contentdiv","Restoring session...");if(!mor.login.readAuthCookie())return mor.log("no previous login found on return from Twitter"),mor.login.init();mor.out("contentdiv","Recording Twitter authorization...");mor.pen.getPen(function(n){n.twid=d;mor.pen.updatePen(n,function(d){h()},function(d,m){mor.err("twitterAuthComplete error "+
d+": "+m);n.twid=0;h()})})},d=function(d){var p;p=mor.dojo.cookie("addAuthOutDiv")||"contentdiv";d.oauth_token&&d.oauth_verifier?(mor.out("contentdiv","Returned from Twitter..."),d="name=Twitter&url="+mor.enc("https://api.twitter.com/oauth/access_token")+"&toksec="+mor.dojo.cookie(d.oauth_token)+"&oauth_token="+d.oauth_token+"&oauth_verifier="+d.oauth_verifier,mor.call("oa1call","POST",d,function(d){var h=d[0],m,p;p=mor.dojo.cookie("addAuthOutDiv");h=mor.paramsToObj(h.content);d=h.oauth_token;mor.dojo.cookie(d,
h.oauth_token_secret,{expires:365});mor.dojo.cookie("addAuthOutDiv","",{expires:-1});m=h.user_id;h=h.screen_name;p?n(m):(mor.out("contentdiv","<p>&nbsp;</p><p>Welcome "+h+"</p>"),mor.login.setAuth("twid",d,m+" "+h),mor.login.authComplete())},function(d,m){mor.log("twitter token conversion failed code "+d+": "+m);h()},"")):(mor.out(p,"Setting up call to Twitter..."),d="name=Twitter&url="+mor.enc("https://api.twitter.com/oauth/request_token")+"&oauth_callback="+mor.enc("http://www.myopenreviews.com#command=AltAuth1"),
mor.call("oa1call","POST",d,function(d){var m=d[0],n,m=mor.paramsToObj(m.content);d=m.oauth_token;n=m.oauth_token_secret;(m=m.oauth_callback_confirmed)&&d&&n?(mor.dojo.cookie(d,n,{expires:2}),window.location.href="http://api.twitter.com/oauth/authenticate?oauth_token="+d):(mor.log("Request token returned from Twitter not valid: "+m+" "+d+" "+n),h())},function(d,m){mor.log("twitter initial oauth failed code "+d+": "+m);h()},""))},t=function(d){var h;h=mor.services.getRevStarsTxt(d,"unicode")+" "+mor.services.getRevTitleTxt(d);
d=mor.services.getRevPermalink(d);return d="https://twitter.com/intent/tweet?text="+mor.embenc(h)+"&url="+mor.enc(d)};return{loginurl:"https://www.twitter.com",name:"Twitter",svcDispName:"Tweet",svcDesc:"Tweets a condensed review",iconurl:"img/tw_logo.png",authenticate:function(h){d(h)},addProfileAuth:function(h,n){0!==window.location.href.indexOf(mor.mainsvr)?(alert("Twitter authentication is only supported from ",mor.mainsvr),mor.profile.displayAuthSettings(h,n)):(mor.dojo.cookie("addAuthOutDiv",
h,{expires:2}),d({}))},doInitialSetup:function(){mor.log("twitter service initial setup done")},getLinkURL:function(d){return t(d)},getOnClickStr:function(d){var h,n=0;d=t(d);h=Math.round(mor.winw/2-275);420<mor.winh&&(n=Math.round(mor.winh/2-210));return"window.open('"+d+"', 'intent', 'scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,left="+h+",top="+n+"');return false;"},getShareImageAlt:function(){return"Tweet condensed review"},getShareImageSrc:function(){return mor.twitter.iconurl}}});
define("ext/googleplus",[],function(){var h=function(){var d=mor.dojo.cookie("addAuthOutDiv");return d?mor.pen.getPen(function(h){mor.profile.displayAuthSettings(d,h)}):mor.login.init()},n=function(d){mor.out("contentdiv","Restoring session...");if(!mor.login.readAuthCookie())return mor.log("no previous login found on return from Google"),mor.login.init();mor.out("contentdiv","Recording Google authorization...");mor.pen.getPen(function(n){n.gsid=d;mor.pen.updatePen(n,function(d){h()},function(d,m){mor.err("record Google auth error "+
d+": "+m);n.gsid="0";h()})})},d=function(d,p){var q;if("1009259210423.apps.googleusercontent.com"!==d.audience)return mor.log("The received token was not intended for this app"),h();mor.dojo.cookie("addAuthOutDiv")?n(d.user_id):(q=mor.enc("https://www.googleapis.com/oauth2/v1/userinfo?access_token="+p),q="jsonget?geturl="+q,mor.call(q,"GET",null,function(d){mor.out("contentdiv","<p>Welcome "+d.name+"</p>");mor.login.setAuth("gsid",p,d.id+" "+d.name);mor.login.authComplete()},function(d,m){mor.log("Google authent fetch details failed code "+
d+": "+m);h()},""))},t=function(m){var n;m.access_token?(mor.out("contentdiv","Returned from Google..."),n="https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="+m.access_token,n=mor.enc(n),mor.call("jsonget?geturl="+n,"GET",null,function(h){d(h,m.access_token)},function(d,m){mor.log("Google token retrieval failed code "+d+": "+m);h()},"")):(n="https://accounts.google.com/o/oauth2/auth?response_type=token&client_id=1009259210423.apps.googleusercontent.com&redirect_uri="+mor.enc("http://www.myopenreviews.com/")+
"&scope="+mor.enc("https://www.googleapis.com/auth/userinfo.profile")+"&state=AltAuth2",window.location.href=n)};return{loginurl:"https://plus.google.com",name:"GooglePlus",loginDispName:"Google+",svcDispName:"Google+ Share",svcDesc:"Posts a review to your Google+ Stream",svcIconURL:"https://www.gstatic.com/images/icons/gplus-32.png",iconurl:"https://www.google.com/favicon.ico",authenticate:function(d){t(d)},addProfileAuth:function(d,h){0!==window.location.href.indexOf(mor.mainsvr)?(alert("Google+ authentication is only supported from ",
mor.mainsvr),mor.profile.displayAuthSettings(d,h)):(mor.dojo.cookie("addAuthOutDiv",d,{expires:2}),t({}))},doInitialSetup:function(){mor.log("google+ service initial setup done")},getLinkURL:function(d){d="http://www.myopenreviews.com/statrev/"+mor.instId(d);return d="https://plus.google.com/share?url="+mor.enc(d)},getOnClickStr:function(){return"window.open(this.href,  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"},getShareImageAlt:function(){return"Post to your Google+ stream"},
getShareImageSrc:function(){return"https://www.gstatic.com/images/icons/gplus-32.png"}}});
define("ext/github",[],function(){var h=function(){var d=mor.dojo.cookie("addAuthOutDiv");return d?mor.pen.getPen(function(h){mor.profile.displayAuthSettings(d,h)}):mor.login.init()},n=function(d,n){mor.out("contentdiv","Restoring session...");if(!mor.login.readAuthCookie())return mor.log("no previous login found on return from GitHub"),mor.login.init();mor.out("contentdiv","Recording GitHub authorization...");mor.pen.getPen(function(d){d.ghid=n.id;mor.pen.updatePen(d,function(d){h()},function(m,
n){mor.err("record GitHub auth error "+m+": "+n);d.ghid=0;h()})})},d=function(d){var p,q;p=mor.dojo.cookie("addAuthOutDiv");q=mor.enc("https://api.github.com/user?access_token="+d);q="jsonget?geturl="+q;mor.call(q,"GET",null,function(h){p?n(d,h):(mor.out("contentdiv","<p>Welcome "+h.login+"</p>"),mor.login.setAuth("ghid",d,h.id+" "+h.login),mor.login.authComplete())},function(d,m){mor.log("GitHub authent fetch details failed code "+d+": "+m);h()},"")},t=function(m){var n;m.code?(mor.out("contentdiv",
"Returned from GitHub..."),n=mor.dojo.cookie("githubAuthState"),n!==m.state&&(mor.log("Bad state returned from GitHub. Sent "+n+" got back "+m.state),h()),m="githubtok?code="+m.code+"&state="+n,mor.call(m,"GET",null,function(h){d(h.access_token)},function(d,m){mor.log("GitHub token retrieval failed code "+d+": "+m);h()},"")):(n="AltAuth3"+Math.random().toString(36).slice(2),mor.dojo.cookie("githubAuthState",n,{expires:2}),m="https://github.com/login/oauth/authorize?client_id=5ac4b34b8ae0c21465dc&redirect_uri="+
mor.enc("http://www.myopenreviews.com/")+"&state="+n,window.location.href=m)};return{loginurl:"https://github.com",name:"GitHub",iconurl:"img/blacktocat-32.png",authenticate:function(d){t(d)},addProfileAuth:function(d,h){0!==window.location.href.indexOf(mor.mainsvr)?(alert("GitHub authentication is only supported from ",mor.mainsvr),mor.profile.displayAuthSettings(d,h)):(mor.dojo.cookie("addAuthOutDiv",d,{expires:2}),t({}))}}});
