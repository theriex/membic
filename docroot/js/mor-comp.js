define("amd/layout",[],function(){var f=["sloganPadded.png","sloganPadded.png","promo_balloons2.png","promo_list.png","promo_cycle.png"],c=0,e=0,q=320,p=null,n=function(){mor.out("dlgdiv","");mor.byId("dlgdiv").style.visibility="hidden";mor.layout.adjust();mor.onescapefunc=null},v=function(c,a){var b;if(!a||!a.trim())a=c+" contains no text";b=a.indexOf("<body>");0<b&&(a=a.slice(b+6,a.indexOf("</body")));mor.out("dlgdiv",'<div id="closeline"><a id="closedlg" href="#close" onclick="mor.layout.closeDialog();return false">&lt;close&nbsp;&nbsp;X&gt;</a></div>'+
a);mor.onescapefunc=n},h=function(c){var a=window.location.href,a=a.slice(0,a.lastIndexOf("/")+1);return a+c},s=function(c){var a="Fetching "+c+" ...";window.scrollTo(0,0);mor.out("dlgdiv",a);mor.byId("dlgdiv").style.visibility="visible";0>c.indexOf(":")&&(c=h(c));mor.call(c,"GET",null,function(a){v(c,a)},function(a,e){v(c,e)},"")},t=function(c,a){mor.onxnode("click",c,function(b){b.preventDefault();b.stopPropagation();s(a)})},k=function(){var m,a;if(mor.byId("slidesdiv")){if(mor.isLowFuncBrowser())a=
'<img src="img/slides/'+f[c]+'" class="slideimg"/>',mor.out("slidesdiv",a),c=(c+1)%f.length;else{m=mor.byId("introslide"+e);if(!m)return;e=(e+1)%2;c=(c+1)%f.length;a=mor.byId("introslide"+e);if(!a)return;a.src="img/slides/"+f[c];a.style.opacity=1;m.style.opacity=0}0===f[c].indexOf("mor")?setTimeout(k,1200):0===f[c].indexOf("slogan")?setTimeout(k,2400):setTimeout(k,6400)}},u=function(){var c,a,b;window.innerWidth&&window.innerHeight?(mor.winw=window.innerWidth,mor.winh=window.innerHeight):"CSS1Compat"===
document.compatMode&&document.documentElement&&document.documentElement.offsetWidth?(mor.winw=document.documentElement.offsetWidth,mor.winh=document.documentElement.offsetHeight):document.body&&document.body.offsetWidth?(mor.winw=document.body.offsetWidth,mor.winh=document.body.offsetHeight):(mor.winw=240,mor.winh=320);a=mor.byId("contentfill");c=mor.byId("contentdiv").offsetHeight;b=mor.winh-q;a.style.height=c<b?b-c+"px":"16px";b=mor.winw-120;if(c=mor.byId("topdiv"))c.style.width=b+"px";if(c=mor.byId("contentdiv"))c.style.width=
b+"px";mor.review.getCurrentReview()&&(b="lihr"+mor.instId(mor.review.getCurrentReview()),(b=mor.byId(b))&&b.focus())};return{init:function(){mor.dojo.on(window,"resize",u);k();var c,a=mor.dojo.query("a"),b,e;for(c=0;a&&c<a.length;c+=1)b=a[c],(e=b.href)&&0<=e.indexOf("docs/")&&t(b,e);u();document.styleSheets[0].cssRules||(mor.byId("bodyid").style.backgroundImage="url('../img/blank.png')")},initContent:function(){mor.byId("chead")||(mor.out("contentdiv",'<div id="chead"> </div><div id="cmain"> </div>'),
mor.profile.updateHeading(),mor.activity.updateHeading(),mor.review.updateHeading())},adjust:function(){u()},displayDoc:function(c){s(c)},closeDialog:function(){n()},setTopPaddingAndScroll:function(c){q=c},dragstart:function(c){c&&(p={domobj:c.target,screenX:c.screenX,screenY:c.screenY},mor.log("dndStart "+p.domobj+" "+p.screenX+","+p.screenY),c.dataTransfer&&c.dataTransfer.setData&&c.dataTransfer.setData("text/plain","general drag"))},dragend:function(c){c&&p&&(mor.log("dndEnd called"),p.ended=!0)},
bodydragover:function(c){c&&(p&&(!p.ended||p.dropped))&&c.preventDefault()},bodydrop:function(c){var a,b,e,d,r;mor.log("dndDrop called");c&&p&&(p.dropped=!0,a=c.screenX-p.screenX,b=c.screenY-p.screenY,e=p.domobj,mor.log("dropping "+e+" moved "+a+","+b),d=e.offsetLeft,r=e.offsetTop,e.style.left=String(d+a)+"px",e.style.top=String(r+b)+"px",c.preventDefault(),c.stopPropagation())}}});
define("amd/login",[],function(){var f="",c="",e="",q="",p="Changing your login credentials",n=[],v="",h=function(a){var c=window.location.href;return c=0<c.indexOf(":8080")||0===c.indexOf("https://")?a:"https://myopenreviews.appspot.com/"+a},s=function(){var a,b;a="am="+f+"&at="+c+"&an="+mor.enc(e);(b=mor.dojo.cookie(c))&&(a+="&as="+mor.enc(b));return a},t=function(){mor.dojo.cookie(mor.authcookname,"",{expires:-1});e=c=f="";mor.review.resetStateVars();mor.activity.resetStateVars();mor.profile.resetStateVars();
mor.pen.resetStateVars();mor.rel.resetStateVars()},k=function(){var a=window.location.pathname;history&&(history.pushState&&"function"===typeof history.pushState)&&history.pushState("",document.title,a)},u=function(a){var b;a||(a=mor.parseParams());if(a.returnto){b=decodeURIComponent(a.returnto)+"#";var d="authmethod="+f+"&authtoken="+c+"&authname="+mor.enc(e);b+=d;a.reqprof&&(b+="&view=profile&profid="+a.reqprof);"chgpwd"===a.command&&(a.command="");(a=mor.objdata(a,["logout","returnto"]))&&(b+=
"&"+a);window.location.href=b}else{if("profile"===a.anchor)return k(),mor.profile.display(a.action,a.errmsg);if(b=mor.currState()){if("profile"===b.view)return b.profid?mor.profile.initWithId(b.profid):mor.profile.display();if("activity"===b.view)return mor.activity.display();"review"===b.view&&b.revid&&mor.review.initWithId(b.revid,b.mode,a.action,a.errmsg)}mor.activity.display()}},m=function(a,b,d){mor.dojo.cookie(mor.authcookname,a+"..morauth.."+b+"..morauth.."+d,{expires:365});f=a;c=b;e=d;mor.login.updateAuthentDisplay()},
a=function(){var a;if(a=mor.dojo.cookie(mor.authcookname))a=a.split("..morauth.."),f=a[0],c=a[1],e=a[2];mor.login.updateAuthentDisplay();return c},b=function(){var a="http://www.myopenreviews.com";0===window.location.href.indexOf("http://localhost:8080")&&(a="http://localhost:8080");window.location.href=a},y=function(){var a,b,c;a=mor.byId("npin").value;if(!a||!a.trim())return p="New password must have a value",mor.login.displayChangePassForm();b=mor.byId("npemailin").value;c=h("chgpwd");a="pass="+
mor.enc(a)+"&email="+mor.enc(b)+"&"+mor.login.authparams();mor.call(c,"POST",a,function(a){m("mid",a[0].token,e);u()},function(a,b){p=b;mor.login.displayChangePassForm()},"")},d=function(){var a="";"chgpwd"!==h("chgpwd")&&(window.location.href=mor.secsvr+"#returnto="+mor.enc(mor.mainsvr)+"&command=chgpwd&"+s());mor.login.updateAuthentDisplay("hide");a+='<p>&nbsp;</p><div id="chpstatdiv">'+p+'</div><table><tr><td align="right">username</td><td align="left"><input type="text" size="20" value="'+e+'" disabled="disabled"/></td></tr><tr><td align="right">new password</td><td align="left"><input type="password" id="npin" size="20"/></td></tr><tr><td align="right">email</td><td align="left"><input type="text" id="npemailin" size="30"/></td></tr><tr><td colspan="2" align="center" class="actbuttons"><button type="button" id="cancelbutton">Cancel</button>&nbsp;<button type="button" id="changebutton">Change</button></td></tr></table>';
mor.out("contentdiv",a);mor.onclick("cancelbutton",b);mor.onclick("changebutton",y);mor.layout.adjust();mor.byId("npin").focus()},r=function(){var a=mor.byId("userin").value,b=mor.byId("passin").value,c=mor.byId("emailin").value||"",d="",g,e;!a||!b||!a.trim()||!b.trim()?mor.out("maccstatdiv","Please specify a username and password"):(g=h("newacct"),e=mor.byId("newaccbuttonstd").innerHTML,mor.out("newaccbuttonstd","Creating new account..."),d=mor.objdata({user:a,pass:b,email:c}),mor.call(g,"POST",
d,function(b){mor.out("logindiv","<p>Welcome "+a+"! Your account has been created. </p><p>Signing in...</p>");m("mid",b[0].token,a);setTimeout(u,3E3)},function(a,b){mor.out("maccstatdiv",b);mor.out("newaccbuttonstd",e)},""))},g=function(){var a=mor.byId("userin").value;mor.isProbablyEmail(a)&&(mor.byId("emailin").value=a);mor.byId("passin").focus()},A=function(){mor.out("logindiv",'<div id="maccstatdiv">Creating a new account</div><table><tr><td align="right"><label for="userin">username</label></td><td align="left"><input type="text" name="username" id="userin" size="20"/></td></tr><tr><td align="right"><label for="passin">password</label></td><td align="left"><input type="password" name="password" id="passin" size="20"/></td></tr><tr><td align="right">email</td><td align="left"><input type="text" id="emailin" size="30"/></td><td align="left">&nbsp;(optional - used if you forget your login)</td></tr><tr><td id="newaccbuttonstd" colspan="2" align="center"><button type="button" id="cancelbutton" onclick="mor.login.init();return false;">Cancel</button>&nbsp;<button type="button" id="createbutton" onclick="mor.login.createAccount();return false;">Create</button></td></tr></table>');
mor.onchange("userin",g);mor.onchange("passin",function(){mor.byId("emailin").focus()});mor.onchange("emailin",r);mor.layout.adjust();mor.byId("userin").focus()},C=function(){var a=mor.byId("emailin").value,b="";!a||!a.trim()||!mor.isProbablyEmail(a)?mor.out("emcrediv","Please enter your email address"):(mor.out("sendbuttons","Sending..."),b="email="+mor.enc(a),mor.call("mailcred","POST",b,function(a){a=""+("<p>Your account information has been emailed to <code>"+mor.byId("emailin").value+'</code> and should arrive in a few minutes.  If it doesn\'t show up, please </p><ol><li>Make sure you have entered your email address correctly<li>Check your spam folder to see if the message was filtered out<li>Verify the email address you entered is the same one you used when you created your account.</ol><p>If you did not specify an email address when you created your account, then your login information cannot be retrieved. </p><p><a id="retlogin" href="return to login">return to login</a></p>');
mor.out("logindiv",a);mor.onclick("retlogin",mor.login.init);mor.layout.adjust()},function(a,b){mor.out("emcrediv",b)},""))},O=function(){mor.out("logindiv",'<div id="emcrediv">If you filled out your email address when you created your account, then your username and password can be mailed to you. </div><table><tr><td align="right">email</td><td align="left"><input type="text" id="emailin" size="30"/></td></tr><tr><td colspan="2" align="center" id="sendbuttons"><button type="button" id="cancelbutton">Cancel</button>&nbsp;<button type="button" id="sendbutton">Send</button></td></tr></table>');
mor.onclick("cancelbutton",mor.login.init);mor.onclick("sendbutton",C);mor.onchange("emailin",C);mor.layout.adjust();mor.byId("emailin").focus()},P=function(){var a=mor.byId("userin").value,b=mor.byId("passin").value,c;!a||!b||!a.trim()||!b.trim()?mor.out("loginstatdiv","Please specify a username and password"):(mor.out("loginbspan","Signing in..."),c=h("login"),b=mor.objdata({user:a,pass:b}),mor.call(c,"POST",b,function(b){m("mid",b[0].token,a);u()},function(a,b){mor.out("loginstatdiv","Login failed: "+
b);mor.out("loginbspan",'<button type="button" id="loginbutton" onclick="mor.login.upwlogin();return false;">Sign in</button>')},"",null,[401]))},J=function(a,b){var c;b||(b=mor.parseParams());0<=window.location.href.indexOf("localhost")?mor.err("Not redirecting to main server off localhost. Confusing."):0!==window.location.href.indexOf(mor.mainsvr)?(c=mor.mainsvr+"#command=AltAuth"+ +a,b.reqprof&&(c+="&view=profile&profid="+b.reqprof),setTimeout(function(){window.location.href=c},20)):n[a].authenticate(b)},
K=function(){var a,b,c=[];for(a=0;a<n.length;a+=1)b=n[a].loginDispName||n[a].name,b='<a href="'+n[a].loginurl+'" title="Sign in via '+b+'" onclick="mor.login.altLogin('+a+');return false;"><img class="loginico" src="'+n[a].iconurl+'" border="0"/> </a>',c.push(b);c.shuffle();b="";for(a=0;a<c.length;a+=1)b+='<span class="altauthspan">'+c[a]+"</span>";return b},L=function(a){var b,c="";mor.out("centerhdiv","");mor.byId("logindiv")||(c='<div id="logindiv">'+v+"</div>",mor.out("contentdiv",c));mor.byId("loginform").style.display=
"inline";c="";for(b in a)a.hasOwnProperty(b)&&(c+='<input type="hidden" name="'+b+'" value="'+a[b]+'"/>');a.returnto||(c+='<input type="hidden" name="returnto" value="'+window.location.protocol+"//"+window.location.host+'"/>');mor.out("loginparaminputs",c);a.loginerr&&mor.out("loginstatdiv",a.loginerr);mor.out("sittd","Sign in directly...");mor.out("osacctd","&nbsp;&nbsp;...or with your social account");mor.out("altauthmethods",K());mor.out("secexp",'<a id="seclogin" href="#secure login" title="How login credentials are handled securely" onclick="mor.layout.displayDoc(\'docs/seclogin.html\');return false;">(secured)</a>');
mor.byId("seclogin").style.fontSize="x-small";mor.out("macctd",'<a id="macc" href="create new account..." title="Set up a new local login">Create a new account</a>');mor.onclick("macc",A);mor.out("forgotpwtd",'<a id="forgotpw" href="forgot credentials..." title="Retrieve your credentials using the email address you set for your account">forgot your password?</a>');mor.byId("forgotpw").style.fontSize="x-small";mor.onclick("forgotpw",O);mor.onchange("userin",function(){mor.byId("passin").focus()});
mor.layout.adjust();e&&(mor.byId("userin").value=e);mor.byId("userin").focus()},Q=function(a){"chgpwd"===a.command?d():"remember"===a.command||"respond"===a.command||"review"===a.view&&a.revid?mor.profile.retrievePen(a.penid,function(b){mor.profile.verifyStateVariableValues(b);mor.review.initWithId(a.revid,"read",a.command)}):a.url?mor.review.readURL(mor.dec(a.url),a):"string"===typeof a.mid?mor.profile.addMyOpenReviewsAuthId(a.mid):u(a)};return{init:function(){mor.out("contentfill","loading login extensions...");
v||(v=mor.byId("logindiv").innerHTML);mor.amdtimer.ext={start:new Date};require(["ext/facebook","ext/twitter","ext/googleplus","ext/github"],function(b,d,g,e){mor.amdtimer.ext.end=new Date;mor.out("contentfill"," &nbsp; ");var r,f=mor.amdtimer;r=f.dojo.end.getTime()-f.dojo.start.getTime();mor.log("load dojo: "+r);r=f.mor.end.getTime()-f.mor.start.getTime();mor.log("load mor: "+r);r=f.ext.end.getTime()-f.ext.start.getTime();mor.log("load ext: "+r);mor.facebook||(mor.facebook=b);mor.twitter||(mor.twitter=
d);mor.googleplus||(mor.googleplus=g);mor.github||(mor.github=e);n=[b,d,g,e];d=mor.parseParams();d.authmethod&&(d.am=d.authmethod);d.authtoken&&(d.at=d.authtoken);d.authname&&(d.an=d.authname);d.am&&(d.at&&d.an)&&(d.at=mor.enc(d.at),m(d.am,d.at,d.an));d.logout&&t();d.returnto||k();d.view&&d.profid?mor.historyCheckpoint({view:d.view,profid:d.profid}):d.revedit&&mor.historyCheckpoint({view:"review",mode:"edit",revid:d.revedit});d.command&&0===d.command.indexOf("AltAuth")?(b=d.command.slice(7),J(b,d)):
d.state&&0===d.state.indexOf("AltAuth")?(b=d.state.slice(7,8),J(b,d)):c||a()?Q(d):"login"===h("login")?L(d):mor.redirectToSecureServer(d)})},updateAuthentDisplay:function(a){var b="";q||(q=mor.byId("topworkdiv").innerHTML);c&&"hide"!==a?(b='<div id="topactionsdiv"><table id="topactionstable" border="0"><tr><td><div id="homepenhdiv"></div></td><td><div id="recentacthdiv">'+mor.activity.activityLinkHTML()+'</div></td></tr><tr><td><div id="writerevhdiv">'+mor.review.reviewLinkHTML()+'</div></td><td><div id="rememberedhdiv">'+
mor.activity.rememberedLinkHTML()+"</div></td></tr></table></div>",mor.out("topworkdiv",b),mor.byId("logoimg").style.width="260px",mor.byId("logoimg").style.height="120px",mor.byId("logodiv").style.width="260px",mor.byId("topsectiondiv").style.height="120px",mor.byId("topworkdiv").style.marginLeft="280px",mor.byId("mascotdiv").style.top="135px",mor.layout.setTopPaddingAndScroll(250)):"hide"===a?mor.out("topworkdiv",'<img src="img/slides/slogan.png" class="slideimg"/>'):mor.out("topworkdiv",q)},displayChangePassForm:function(){d()},
authparams:function(){return s()},readAuthCookie:function(){return a()},logout:function(){var a;t();mor.profile.cancelPenNameSettings();mor.historyCheckpoint({view:"profile",profid:0});mor.login.updateAuthentDisplay();mor.byId("logindiv")||(a='<div id="logindiv">'+v+"</div>",mor.out("contentdiv",a));mor.login.init()},altLogin:function(a){J(a)},upwlogin:function(){P()},setAuth:function(a,b,c){m(a,b,c)},authComplete:function(){u()},createAccount:function(){r()},getAuthMethod:function(){return f},loginInfoHTML:function(){var a;
switch(f){case "mid":a="img/iconMOR.png";break;case "fbid":a=mor.facebook.iconurl;break;case "twid":a=mor.twitter.iconurl;break;case "gsid":a=mor.googleplus.iconurl;break;case "ghid":a=mor.github.iconurl}a='<img class="loginico" src="'+a+'" /> <em>'+e+'</em> &nbsp; <a href="logout" id="logout" onclick="mor.login.logout();return false;">sign out</a>';"mid"===f&&(a+=' &nbsp; <a href="changepwd" id="cpwd" onclick="mor.login.displayChangePassForm();return false;">change password</a>');return a}}});
define("amd/review",[],function(){var f="",c="",e={},q=!1,p="",n=[{type:"book",plural:"books",img:"TypeBook50.png",keyprompt:"Title",key:"title",subkey:"author",fields:["publisher","year"],dkwords:"Fluff;Light;Heavy;Kid Ok;Educational;Suspenseful;Amusing;Engaging".split(";")},{type:"movie",plural:"movies",img:"TypeMovie50.png",keyprompt:"Movie name",key:"title",fields:["year","starring"],dkwords:"Fluff;Light;Heavy;Kid Ok;Educational;Cult;Classic;Funny;Suspenseful".split(";")},{type:"video",plural:"videos",
img:"TypeVideo50.png",keyprompt:"Title",key:"title",fields:["artist"],dkwords:"Light;Heavy;Kid Ok;Educational;Funny;Cute;Artistic;Disturbing".split(";")},{type:"music",plural:"music",img:"TypeSong50.png",keyprompt:"Title",key:"title",subkey:"artist",fields:["album","year"],dkwords:"Light Heavy Wakeup Travel Office Workout Dance Social Sex".split(" ")},{type:"food",plural:"food",img:"TypeFood50.png",keyprompt:"Name of restaurant or dish",key:"name",fields:["address"],dkwords:"Breakfast Brunch Lunch Dinner Snack Inexpensive Expensive Fast Slow Outdoor Quiet Loud".split(" ")},
{type:"drink",plural:"drinks",img:"TypeDrink50.png",keyprompt:"Name and where from",key:"name",fields:["address"],dkwords:"Traditional Innovative Inexpensive Expensive Essential Special Quiet Loud Outdoor".split(" ")},{type:"activity",plural:"activities",img:"TypeActivity50.png",keyprompt:"Name of activity, place, or event",key:"name",fields:["address"],dkwords:"Indoor;Outdoor;Educational;Artistic;Kid Ok;Inexpensive;Expensive".split(";")},{type:"other",plural:"other",img:"TypeOther50.png",keyprompt:"Name or title",
key:"name",fields:[],dkwords:"Specialized General Professional Personal Hobby Research".split(" ")}],v=function(a,b){var c={},d,g="No stars;Half a star;One star;One and a half stars;Two stars;Two and a half stars;Three stars;Three and a half stars;Four stars;Four and a half stars;Five stars".split(";");"string"===typeof a&&(a=parseInt(a,10));if(!a||"number"!==typeof a||0>a)a=0;93<a&&(a=100);d=Math.floor(a*(g.length-1)/100);b&&(d=Math.min(d+1,g.length-1),a=Math.floor(100*(d/(g.length-1))));c.value=
a;c.step=d;c.maxstep=g.length-1;c.title=g[d];return c},h=function(a,b,c){var d,g,l=c||"starsimg";d=v(a);a=Math.floor(d.step*(85/d.maxstep));g=""+('<img class="'+l+'" src="img/blank.png" style="width:'+a+"px;height:15px;background:url('img/stars18ptC.png');\" title=\""+d.title+'" alt="'+d.title+'"/>');b?1===d.step%2?(b=Math.floor(85/d.maxstep),g+='<img class="'+l+'" src="img/blank.png" style="width:'+(85-a)+"px;height:15px;background:url('img/stars18ptCg.png') -"+b+'px 0;" title="'+d.title+'" alt="'+
d.title+'"/>'):g+='<img class="'+l+'" src="img/blank.png" style="width:'+(85-a)+"px;height:15px;background:url('img/stars18ptCg.png');\" title=\""+d.title+'" alt="'+d.title+'"/>':c||(g=g+('<img class="'+l+'" src="img/blank.png" style="width:'+(85-a)+'px;height:15px;"/>')+('<img class="'+l+'" src="img/blank.png" style="width:10px;height:15px;"/>'));return g},s=function(a,b,c){var d=a.plural.capitalize(),g="";a.img&&(g='<img class="reviewbadge" src="img/'+a.img+'" title="'+d+'" alt="'+d+'"/>',b&&(c&&
(d='<span style="color:#999999;">'+d+"</span>"),g+=d));return g},t=function(a,b,c,d,g){var l,w=0,x,e,r,k="<table>";for(l=0;l<n.length;l+=1){e=n[l].type;x=!1;if(g&&(!g[e]||0===g[e].length))x=!0;x=s(n[l],!0,x);r=n[l].plural;e=e===c;0===w&&(k+="<tr>");k+="<td>"+mor.checkrad(a,b,r,x,e,d)+"</td>";w+=1;if(4===w||l===n.length-1)k+="</tr>",w=0}return k+"</table>"},k=function(a){var b;if(!a)return null;a=a.toLowerCase();for(b=0;b<n.length;b+=1)if(n[b].type===a||n[b].plural===a)return n[b];return n[n.length-
1]},u=function(a){a.newrev&&(e.revtype=mor.dec(a.newrev));a.name&&(e.name=mor.dec(a.name));a.title&&(e.title=mor.dec(a.title));a.artist&&(e.artist=mor.dec(a.artist));a.author&&(e.author=mor.dec(a.author));a.publisher&&(e.publisher=mor.dec(a.publisher));a.album&&(e.album=mor.dec(a.album));a.starring&&(e.starring=mor.dec(a.starring));a.address&&(e.address=mor.dec(a.address));a.year&&(e.year=mor.dec(a.year));a.imguri&&(e.imguri=mor.dec(a.imguri))},m=function(a,b){0<a.indexOf(".amazon.")?require(["ext/amazon"],
b):require(["ext/readurl"],b)},a=function(a,b){var c=mor.byId("reviewtext");c&&(e.text=c.value)},b=function(b,c){var d,g=[];c||(c={});if(!b&&(d=mor.byId("urlin")))b=d.value;a(e.revtype,g);if(b&&!(0<g.length)){if(d=mor.byId("readurlbuttoncontainer"))d.innerHTML="reading...";b?(e.url=f=b,u(c),m(f,function(a){a.fetchData(e,b,c)})):mor.review.display()}},y=function(){var a,b=0,c,d;d='<div id="revfdiv" class="formstyle" align="center"><div id="formrejustifydiv" class="centertablediv"><ul class="reviewformul"><li><table border="0"><tr><td colspan="4"><div class="bigoverlabel">Choose a review type</div></td></tr>';
for(a=0;a<n.length;a+=1)if(0===b&&(d+="<tr>"),c=n[a].type.capitalize(),d+='<td><div class="revtypeselectiondiv">'+mor.imgntxt(n[a].img,c,"mor.review.setType('"+n[a].type+"')","#"+c,"Create a "+n[a].type+" review")+"</div></td>",b+=1,4===b||a===n.length-1)d+="</tr>",b=0;d+="</table></li>";d=f?d+('<li><a href="'+f+'">'+f+"</a></li>"):d+'<li><table border="0"><tr><td colspan="2"><div class="bigoverlabel">or paste a web address to read information from</div></td></tr><tr><td align="right">URL</td><td align="left"><input type="text" id="urlin" size="40" onchange="mor.review.readURL();return false;"/>&nbsp;<span id="readurlbuttoncontainer"><button type="button" id="readurlbutton" onclick="mor.review.readURL();return false;" title="Read review form fields from pasted URL">Read</button></span></td></tr></table></li>';
d+="</ul></div></div>";mor.byId("cmain")||mor.layout.initContent();mor.out("cmain",d);mor.byId("urlin").focus();mor.layout.adjust()},d=function(){var a;a="";var b=mor.instId(e);if(b)a+=mor.paramsToFormInputs(mor.login.authparams()),a=a+('<input type="hidden" name="_id" value="'+b+'"/>')+('<input type="hidden" name="penid" value="'+e.penid+'"/>'),a+='<input type="hidden" name="returnto" value="'+mor.enc(window.location.href+"#revedit="+b)+'"/>',a='<form action="/revpicupload" enctype="multipart/form-data" method="post"><div id="closeline"><a id="closedlg" href="#close" onclick="mor.cancelPicUpload();return false">&lt;close&nbsp;&nbsp;X&gt;</a></div>'+
a+'<table><tr><td>Upload Review Pic</td></tr><tr><td><input type="file" name="picfilein" id="picfilein"/></td></tr><tr><td align="center"><input type="submit" value="Upload"/></td></tr></form>',mor.out("overlaydiv",a),a=mor.byId("overlaydiv"),a.style.top="300px",a.style.visibility="visible",a.style.backgroundColor=mor.skinner.lightbg(),mor.onescapefunc=mor.cancelPicUpload,mor.byId("picfilein").focus();else if(a=mor.byId("revformbuttonstd").innerHTML,0<=a.indexOf("<button"))return mor.review.save(!1,
"uploadpic")},r=function(a){a=mor.byId(a);a.style.color="red";0>a.innerHTML.indexOf("*")&&(a.innerHTML+="*")},g=function(a){var b;a||(a="");b=a.capitalize();"url"===a&&(b='<img class="webjump" src="img/gotolink.png"/>URL');return b},A=function(a){return!a?"":'<a href="'+a+'" onclick="window.open(\''+a+'\');return false;" title="'+a+'"><img class="webjump" src="img/gotolink.png"/></a>'},C=function(){var a=mor.byId("urlin");f&&(e.url=f,f="");a&&(e.url=a.value)},O=function(a,b){var d,c=mor.byId("keyin");
!c||!c.value?(r("keyinlabeltd"),b.push("Please specify a value for "+a.key)):(e[a.key]=c.value,d=e[a.key]);a.subkey&&(c=mor.byId("subkeyin"),!c||!c.value?(r("subkeyinlabeltd"),b.push("Please specify a value for "+a.subkey)):(e[a.subkey]=c.value,d+=e[a.subkey]));d&&(e.cankey=mor.canonize(d))},P=function(a,b){var d,c;for(c=0;c<a.fields.length;c+=1)if(d=mor.byId("field"+c))e[a.fields[c]]=d.value;e.rating||b.push("Please set a star rating for this review")},J=function(a,b){var c=mor.byId("keywordin");
c&&(e.keywords=c.value)},K=function(a,b,c,d){b="";c&&"edit"===d&&("video"===a.revtype&&(a.title&&a.artist)&&(b+='<a href="#" title="Swap the artist and title values" onclick="mor.review.swapVidTitleAndArtist();return false;">Swap title and artist</a>&nbsp;&nbsp;&nbsp;'),"video"===a.revtype&&(b+='<a href="#" title="Review this as music" onclick="mor.review.changeReviewType(\'music\');return false;">Review as music</a>&nbsp;&nbsp;&nbsp;'),"music"===a.revtype&&(b+='<a href="#" title="Review this as video" onclick="mor.review.changeReviewType(\'video\');return false;">Review as video</a>&nbsp;&nbsp;&nbsp;'),
a.url&&(b+='<a href="#" title="Refetch imported data field values" onclick="mor.review.readURL(\''+a.url+"');return false;\">Reimport</a>&nbsp;&nbsp;&nbsp;"));return b},L=function(a,b,c,d,g){if(d)if("edit"===g)mor.onescapefunc=mor.review.reset,c='<div id="revbuttonsdiv"><button type="button" id="cancelbutton" onclick="mor.review.reset('+(mor.instId(b)?"false":"true")+');return false;">Cancel</button>&nbsp;<button type="button" id="savebutton" onclick="mor.review.save(true,\'\');return false;">Save</button>&nbsp;',
d&&(c+='<button type="button" id="donebutton" onclick="mor.review.save(true,\'runServices\');return false;">Save and Share</button>'),c+="</div>";else if(b.penid===mor.pen.currPenId())mor.onescapefunc=null,a="statrev/"+mor.instId(b),c='<div id="revbuttonsdiv"><button type="button" id="deletebutton" onclick="mor.review.delrev();return false;">Delete</button>&nbsp;<button type="button" id="editbutton" onclick="mor.review.display();return false;">Edit</button>&nbsp;<button type="button" id="sharebutton" onclick="mor.review.share();return false;">Share</button>&nbsp;&nbsp;<a href="'+
a+'" class="permalink" onclick="window.open(\''+a+"');return false;\">permalink</a></div>";else{c='<div id="socialrevactdiv"><table class="socialrevacttable" border="0"><tr><td><div id="respondbutton" class="buttondiv">'+mor.imgntxt("writereview.png","Your review","mor.review.respond()","#respond","Edit your corresponding review","","respond")+'</div></td><td><div id="memobutton" class="buttondiv">';a:{d=mor.instId(b);if(a.revmem&&a.revmem.remembered)for(b=0;b<a.revmem.remembered.length;b+=1)if(d===
a.revmem.remembered[b]){a=!0;break a}a=void 0}c=a?c+mor.imgntxt("remembered.png","Remembered","mor.review.memo(true)","#nomemo","Click to stop remembering","","memo"):c+mor.imgntxt("rememberq.png","Remember","mor.review.memo(false)","#memo","Click to remember","","memo");c+="</div></td></tr></table></div>"}else mor.onescapefunc=mor.review.reset,c='<div id="revbuttonsdiv"><button type="button" id="cancelbutton" onclick="mor.review.reset(true);return false;">Cancel</button>&nbsp;<button type="button" id="savebutton" onclick="mor.review.validate();return false;">Create Review</button></div>';
return c+'<br/><div id="revsavemsg"></div>'},Q=function(a,b,c,d){var e="",l;"edit"===d&&(e+='<tr><td id="starslabeltd"></td><td id="keyinlabeltd">'+g(b.keyprompt)+"</td><td>"+g(c?"url":b.subkey)+"</td></tr>");e+='<tr><td id="starstd">';c&&(e+='<span id="stardisp">'+h(a.rating,"edit"===d)+"</span>");e+="&nbsp;"+s(b)+"</td>";"edit"===d?(d="mor.review.validate();return false;",b.subkey&&(d="mor.byId('subkeyin').focus();return false;"),l=a[b.key]||"",e+='<td><input type="text" id="keyin" size="30" onchange="'+
d+'" value="'+l+'"></td>',c?(l=a.url||"",e+='<td><input type="text" id="urlin" size="30" value="'+l+'"/></td>'):b.subkey&&(l=a[b.subkey]||"",e+='<td id="subkeyinlabeltd"><input type="text" id="subkeyin" size="30" onchange="mor.review.validate();return false;" value="'+l+'"/></td>')):(l=a[b.key]||"",e+='<td><span class="revtitle">'+l+"</span></td>",b.subkey&&(l=a[b.subkey]||"",e+='<td><span class="revauthor">'+l+"</span></td>"),"url"!==b.key&&"url"!==b.subkey&&(l=a.url||"",e+="<td>"+A(l)+"</td>"));
return e+"</tr>"},U=function(){var a=Math.max(mor.winw-350,200);return a=Math.min(a,750)},G=function(a,b,c,d){var g;b='<tr><td colspan="4" class="textareatd">';c?(a=a.text||"",g=U(),g="color:"+mor.colors.text+";background-color:"+mor.skinner.lightbg()+";width:"+g+"px;","edit"===d?b+='<textarea id="reviewtext" class="shoutout" placeholder=">>What was the most striking thing about this for you?" style="'+(g+"height:100px;")+'">'+a+"</textarea>":(a=a||"No comment",g+="height:100px;overflow:auto;padding:2px 5px;border:1px solid "+
mor.skinner.darkbg()+";",b+='<div id="reviewtext" class="shoutout" style="'+g+'">'+mor.linkify(a)+"</div>")):b+='<div id="revautodiv" class="autocomplete" style="width:'+g+'px;"> </div>';return b+"</td></tr>"},H=function(a,b,c,d){var g;c?a.imguri?(g='<a href="'+a.url+'" onclick="window.open(\''+a.url+'\');return false;"><img style="max-width:125px;height:auto;" src="'+a.imguri+'"/></a>',"edit"===d&&(g+='<br/><a href="#remove image link" onclick="mor.review.removeImageLink();return false;">remove image</a>')):
(g="","edit"===d&&(g="img/emptyprofpic.png"),a.revpic&&(g="revpic?revid="+mor.instId(a)),g='<img class="revpic" src="'+g+'"',"edit"===d&&(g+=" onclick=mor.review.picUploadForm();return false;"),g+="/>"):g="";g='<tr><td align="right" rowspan="3">'+g+'</td><td colspan="2"><table class="subtable" border="0" width="100%"><tr><td valign="top">';var l="",w,x,r;if(c){l+="<table>";"edit"===d&&b.subkey&&(x=b.subkey,r=a[b.subkey]||"",l+='<tr><td id="subkeyinlabeltd"><span class="secondaryfield">'+x.capitalize()+
'</span></td><td align="left"><input type="text" id="subkeyin" size="25" value="'+r+'"/></td></tr>');for(w=0;w<b.fields.length;w+=1)if(x=b.fields[w],r=a[x]||"","url"!==x){if(r||"edit"===d)l+='<tr><td><span class="secondaryfield">'+x.capitalize()+"</span></td>";l="edit"===d?l+('<td align="left"><input type="text" id="field'+w+'" size="25" value="'+r+'"/></td>'):l+("<td>"+r+"</td>");l+="</tr>"}l+="</table>"}g=g+l+'</td><td valign="top">';l="";if(c){if("edit"===d){c=l;l=0;e.keywords||(e.keywords="");
w="<table>";for(d=0;d<b.dkwords.length;d+=1)if(0===l&&(w+="<tr>"),w+='<td style="white-space:nowrap;"><input type="checkbox" name="dkw'+d+'" id="dkw'+d+'" value="'+b.dkwords[d]+'" onclick="mor.review.toggleKeyword(\'dkw'+d+"');\"",0<=e.keywords.indexOf(b.dkwords[d])&&(w+=' checked="checked"'),w+='/><label for="dkw'+d+'">'+b.dkwords[d]+"</label></td>",l+=1,3===l||d===b.dkwords.length-1)w+="</tr>",l=0;a=c+(w+'</table>Keywords: <input type="text" id="keywordin" size="30" value="'+mor.safestr(a.keywords)+
'"/>')}else a=l+('<div class="csvstrdiv">'+mor.safestr(a.keywords)+"</div>");l=a}return g+l+"</td></tr></table></td></tr>"},z=function(a,b){var d,c;d=mor.byId("stardisp");d=mor.dojo.domgeo.position(d);c=a.pageX;a.changedTouches&&a.changedTouches[0]&&(c=a.changedTouches[0].pageX);c=Math.max(c-d.x,0);d=Math.min(Math.round(100*(c/d.w)),100);b&&(d=v(d,!0).value);e.rating=d;d=h(e.rating,!0);mor.out("stardisp",d)},V=function(a){q=!0;z(a,!0)},N=function(a){q=!1},E=function(a){var b,d,c;b=mor.byId("starstd");
b=mor.dojo.domgeo.position(b);d=a.pageX;c=a.pageY;a.changedTouches&&a.changedTouches[0]&&(d=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY);if(d<b.x||d>b.x+b.w||c<b.y||c>b.y+b.h)q=!1},I=function(a){q&&z(a)},R=function(a){z(a,!0)},B=function(a,b){var d,c,g=null;c="<"+a+">";d=b.indexOf(c);0<=d&&(b=b.slice(d+c.length),c="</"+a+">",d=b.indexOf(c),0<=d&&(g={content:b.slice(0,d),remainder:b.slice(d+c.length)}));return g},D=function(a,b){var d=B(a,b);d&&(d=d.content.trim());return d?"&nbsp;<i>"+d+
"</i>":""},S=function(a){if(mor.byId("revautodiv")&&mor.byId("keyin"))if(a=mor.byId("keyin").value,mor.byId("subkeyin")&&(a+=" "+mor.byId("subkeyin").value),a!==p){if(p=a,"book"===e.revtype||"movie"===e.revtype)a="amazonsearch?revtype="+e.revtype+"&search="+mor.enc(a),mor.call(a,"GET",null,function(a){var b=mor.dec(a[0].content),d,c,l;a="<ul>";for(b=B("Item",b);b;)d=B("DetailPageURL",b.content),d=d.content||"",c=B("ItemAttributes",b.content),l=B("Title",c.content),(l=l.content||"")&&("book"===e.revtype?
l+=D("Author",c.content):"movie"===e.revtype?l+=D("ProductGroup",c.content):"music"===e.revtype&&(l+=D("Artist",c.content)+" "+D("Manufacturer",c.content)+D("ProductGroup",c.content))),a+='<li><a href="'+d+'" onclick="mor.review.readURL(\''+d+"');return false;\">"+l+"</a></li>",b=B("Item",b.remainder);mor.out("revautodiv",a+"</ul>");setTimeout(S,400);mor.layout.adjust()},function(a,b){mor.out("revautodiv","");mor.log("Amazon info retrieval failed code "+a+": "+b);setTimeout(S,400);mor.layout.adjust()},
"")}else setTimeout(S,750)},ba=function(a,b){var d;d="Your review";b&&(d=h(b.rating,!1,"inlinestarsimg"),d="Your review: "+d);d=mor.imgntxt("writereview.png",d,"mor.review.respond()","#respond","Edit your corresponding review","","respond");mor.out("respondbutton",d)},W=function(a,b){var d,c;if(a.top20s&&(c=a.top20s[e.revtype])&&c.length)for(d=0;d<c.length;d+=1)if(c[d].cankey===e.cankey&&c[d].revtype===e.revtype)return b(a,c[d]);d="penid="+mor.instId(a)+"&revtype="+e.revtype+"&cankey="+e.cankey+"&"+
mor.login.authparams();mor.call("revbykey?"+d,"GET",null,function(d){var l=null;0<d.length&&(l=d[0]);b(a,l)},function(a,b){mor.err("findCorrespondingReview failed "+a+" "+b)},"")},M=function(a,b,d,g){var e,l,w,x;l=k(b.revtype);w=b[l.key];e='<div class="formstyle" style="width:'+(U()+100)+'px;"><table class="revdisptable" border="0">';"edit"===d&&c&&(e+='<tr><td colspan="4"><div id="attributiondiv">'+c+"</div></td></tr>");e+=Q(b,l,w,d);e+=G(b,l,w,d);e+=H(b,l,w,d);(x=K(b,l,w,d))&&(e+='<tr><td colspan="3" id="transformactionstd">'+
x+"</td></tr>");e+='<tr><td colspan="3" id="revformbuttonstd">'+L(a,b,l,w,d)+"</td></tr></table></div>";mor.byId("cmain")||mor.layout.initContent();mor.out("cmain",e);"edit"===d&&(mor.onx("mousedown","starstd",V),mor.onx("mouseup","starstd",N),mor.onx("mouseout","starstd",E),mor.onx("mousemove","starstd",I),mor.onx("click","starstd",R),mor.onx("touchstart","starstd",V),mor.onx("touchend","starstd",N),mor.onx("touchcancel","starstd",N),mor.onx("touchmove","starstd",I),w?mor.byId("subkeyin")&&!b[l.subkey]?
mor.byId("subkeyin").focus():mor.byId("reviewtext").focus():mor.byId("keyin").focus());mor.layout.adjust();g&&mor.out("revsavemsg",g);mor.byId("respondbutton")&&mor.pen.getPen(function(a){W(a,ba)});mor.byId("revautodiv")&&(p="",S())},F=null,X=function(){F=setTimeout(function(){var a,b="",d=[];F=null;if(a=k(e.revtype))if(O(a,d),0<d.length){for(a=0;a<d.length;a+=1)b+=d[a]+"<br/>";mor.out("revsavemsg",b);return}mor.review.display()},400)},Y=function(b,d){var g=[],r,f="",l;l=mor.byId("revformbuttonstd").innerHTML;
mor.out("revformbuttonstd","Verifying...");if(r=k(e.revtype))if(C(),O(r,g),P(r,g),J(r,g),a(r,g),0<g.length){mor.out("revformbuttonstd",l);for(r=0;r<g.length;r+=1)f+=g[r]+"<br/>";mor.out("revsavemsg",f)}else mor.out("revformbuttonstd","Saving..."),mor.onescapefunc=null,g="updrev?",mor.instId(e)||(g="newrev?",e.svcdata=""),f=mor.objdata(e),mor.call(g+mor.login.authparams(),"POST",f,function(a){mor.profile.resetReviews();e=a[0];setTimeout(mor.pen.refreshCurrent,100);b?(c="",mor.review.displayRead(d)):
mor.review.display(d)},function(a,b){mor.log("saveReview failed code: "+a+" "+b);mor.review.display()},"");else mor.out("revformbuttonstd",l),mor.out("revsavemsg","Unknown review type")},ca=function(a,b,d,c){mor.call("revbyid?revid="+a,"GET",null,function(g){0<g.length?(e=g[0],"edit"===b?mor.review.display(d,c):mor.review.displayRead(d)):mor.err("initWithId found no review id "+a)},function(a,b){mor.err("initWithId failed code "+a+": "+b)},"")},da=function(a,b){b||(b={},b.srcrev=mor.instId(e),b.penid=
mor.instId(a),b.revtype=e.revtype,b.rating=e.rating,b.cankey=e.cankey);e.imguri&&(!b.imguri&&!b.revpic)&&(b.imguri=e.imguri);e.name&&!b.name&&(b.name=e.name);e.title&&!b.title&&(b.title=e.title);e.url&&!b.url&&(b.url=e.url);e.artist&&!b.artist&&(b.artist=e.artist);e.author&&!b.author&&(b.author=e.author);e.publisher&&!b.publisher&&(b.publisher=e.publisher);e.album&&!b.album&&(b.album=e.album);e.starring&&!b.starring&&(b.starring=e.starring);e.address&&!b.address&&(b.address=e.address);e.year&&!b.year&&
(b.year=e.year);e=b;mor.review.display()},Z=function(a,b){var d,c=mor.instId(e);a.revmem||(a.revmem={});a.revmem.remembered||(a.revmem.remembered=[]);for(d=a.revmem.remembered.indexOf(c);0<=d;)a.revmem.remembered.splice(d,1),d=a.revmem.remembered.indexOf(c);b||(a.revmem.remembered.unshift(c),mor.activity.cacheReview(e));mor.pen.updatePen(a,function(a){mor.review.displayRead()},function(a,b){mor.err("Remember update failed "+a+" "+b)})},$=function(){var a;e&&window.confirm("Are you sure you want to delete this review?")&&
(mor.out("cmain","Deleting review..."),a=mor.objdata(e),mor.call("delrev?"+mor.login.authparams(),"POST",a,function(a){mor.out("cmain","<p>Review deleted.  If this review was one of your top 20 best, then you may see an id reference message until the next time you review something.  Recalculating your recent reviews...</p>");setTimeout(function(){mor.profile.resetReviews();mor.profile.display()},12E3)},function(a,b){mor.err("Delete failed code: "+a+" "+b);mor.profile.display()},""))},T=function(a,
b,c,g){e||(e={});e.penid||(e.penid=mor.pen.currPenId());setTimeout(function(){e.penid!==mor.instId(a)?mor.profile.retrievePen(e.penid,function(b){mor.profile.writeNavDisplay(a,b)}):mor.profile.writeNavDisplay(a)},50);b?(M(a,e),e.penid===mor.pen.currPenId()?"runServices"===c&&mor.services.run(a,e):"remember"===c?mor.review.memo():"respond"===c&&mor.review.respond()):k(e.revtype)?"uploadpic"===c?(M(a,e,"edit"),d()):M(a,e,"edit",g):y()};return{resetStateVars:function(){f="";e={};c=""},display:function(a,
b){mor.pen.getPen(function(d){T(d,!1,a,b)})},displayRead:function(a){mor.pen.getPen(function(b){T(b,!0,a)})},delrev:function(){$()},reviewLinkHTML:function(){return'<div class="topnavitemdiv">'+mor.imgntxt("writereview.png","Write a Review","mor.review.reset(true)","#Write","Write a review")+"</div>"},updateHeading:function(){},getReviewTypes:function(){return n},getReviewTypeByValue:function(a){return k(a)},reviewTypeCheckboxesHTML:function(a){return t("checkbox",a)},reviewTypeRadiosHTML:function(a,
b,d,c){return t("radio",a,c,b,d)},reviewTypeSelectOptionsHTML:function(a){var b,d,c,g="";for(b=0;b<n.length;b+=1){d=n[b].type;c=!1;if(a&&(!a[d]||0===a[d].length))c=!0;g+='<option value="'+d+'"';c&&(g+=' disabled="disabled"');g+=">"+n[b].plural.capitalize()+"</option>"}return g},badgeImageHTML:function(a){return s(a)},starsImageHTML:function(a,b){return h(a,b)},readURL:function(a,d){return b(a,d)},setType:function(a){e.revtype=a;mor.review.display()},picUploadForm:function(){d()},toggleKeyword:function(a){var b,
d,c,g,l;a=mor.byId(a);b="";d=mor.byId("keywordin");c=d.value.split(",");for(g=0;g<c.length;g+=1)if(l=c[g])l=l.trim(),l===a.value&&(l=""),b&&l&&(b+=", "),b+=l;a.checked&&(b&&(b+=", "),b+=a.value);d.value=b},reset:function(a){mor.onescapefunc=null;F&&(clearTimeout(F),F=null);a||!e||!mor.instId(e)?(e={},c=f="",q=!1,p="",mor.review.display()):mor.review.displayRead()},validate:function(){X()},save:function(a,b){Y(a,b)},share:function(){mor.pen.getPen(function(a){T(a,!0,"runServices")})},setCurrentReview:function(a){e=
a},getCurrentReview:function(){return e},initWithId:function(a,b,d,c){ca(a,b,d,c)},respond:function(){mor.byId("respondtxttd").style.color="#666666";setTimeout(function(){mor.pen.getPen(function(a){W(a,da)})},50)},memo:function(a){mor.byId("memotxttd").style.color="#666666";setTimeout(function(){mor.pen.getPen(function(b){Z(b,a)})},50)},graphicAbbrevSiteLink:function(a){return A(a)},swapVidTitleAndArtist:function(){var a=mor.byId("keyin"),b=a.value,d=mor.byId("field0");a.value=d.value;d.value=b},
changeReviewType:function(b){a(e.revtype,[]);e.revtype=b;mor.review.display()},removeImageLink:function(){e.imguri="";mor.review.display()},setAttribution:function(a){c=a}}});
define("amd/profile",[],function(){var f,c,e=[],q={results:[]},p={},n,v,h={},s=[],t="",k=0,u=1,m="pen",a=function(a){a.params={};a.results=[];a.cursor="";a.total=0;a.initialized=!1},b=function(){mor.pen.getPen(function(a){mor.rel.reledit(a,c)})},y=function(a,b){b||(b=a);var d='<div class="topnavitemdiv">'+mor.imgntxt("profile.png",a.name,"mor.profile.display()","#view=profile&profid="+mor.instId(a),"Show profile for your current pen name")+"</div>";mor.out("homepenhdiv",d);var c=b,g,e;e=mor.instId(c);
d=c.name;g='<div id="profhdiv"><span id="penhnamespan">'+('<a href="#view=profile&profid='+e+'" title="Show profile for '+d+'" onclick="mor.profile.byprofid(\''+e+"');return false;\">"+d+"</a>")+'</span><span id="penhbuttonspan"> </span></div>';mor.out("centerhdiv",g);g=mor.instId(a)===mor.instId(c)?mor.imglink("#Settings","Adjust your application settings","mor.profile.settings()","settings.png"):mor.rel.relsLoaded()?(c=mor.rel.outbound(e))?mor.imglink("#Settings","Adjust follow settings for "+d,
"mor.profile.relationship()","settings.png"):mor.imglink("#Follow","Follow "+d+" reviews","mor.profile.relationship()","follow.png"):"...";mor.out("penhbuttonspan",g)},d=function(a){var b=mor.byId("pennamein");b&&(a.name=b.value)},r=function(a){d(a);mor.skinner.save(a);mor.pen.updatePen(a,function(){mor.layout.closeDialog();mor.profile.display()},function(a,b){mor.out("settingsmsgtd",b)})},g=function(a){mor.skinner.cancel();mor.layout.closeDialog();a&&"string"===typeof a&&(mor.out("centerhdiv",""),
mor.out("cmain",a))},A=function(a){switch(a){case "mid":return"MyOpenReviews";case "gsid":return"Google+";case "fbid":return"Facebook";case "twid":return"Twitter";case "ghid":return"GitHub"}},C=function(a,b){var d,c;c='<div id="accountdiv">'+mor.login.loginInfoHTML()+'</div>Access "'+b.name+'" via: <table>';d=A("mid");c+='<tr><td><input type="checkbox" name="aamid" value="'+d+'" id="aamid" onchange="mor.profile.toggleAuthChange(\'mid\',\''+a+"');return false;\"";mor.isId(b.mid)&&(c+=' checked="checked"');
c=c+('/><label for="aamid">'+d+"</label></td></tr>")+"<tr>";d=A("fbid");c+='<td><input type="checkbox" name="aafbid" value="'+d+'" id="aafbid" onchange="mor.profile.toggleAuthChange(\'fbid\',\''+a+"');return false;\"";mor.isId(b.fbid)&&(c+=' checked="checked"');c+='/><label for="aafbid">'+d+"</label></td>";d=A("twid");c+='<td><input type="checkbox" name="aatwid" value="'+d+'" id="aatwid" onchange="mor.profile.toggleAuthChange(\'twid\',\''+a+"');return false;\"";mor.isId(b.twid)&&(c+=' checked="checked"');
c+='/><label for="aatwid">'+d+"</label></td>";c+="</tr><tr>";d=A("gsid");c+='<td><input type="checkbox" name="aagsid" value="'+d+'" id="aagsid" onchange="mor.profile.toggleAuthChange(\'gsid\',\''+a+"');return false;\"";mor.isId(b.gsid)&&(c+=' checked="checked"');c+='/><label for="aagsid">'+d+"</label></td>";d=A("ghid");c+='<td><input type="checkbox" name="aaghid" value="'+d+'" id="aaghid" onchange="mor.profile.toggleAuthChange(\'ghid\',\''+a+"');return false;\"";mor.isId(b.ghid)&&(c+=' checked="checked"');
c+='/><label for="aaghid">'+d+"</label></td>";c+="</tr></table>";mor.out(a,c)},O=function(a,b,d){var c="remove",g;mor.byId("aa"+b).checked&&(c="add");if("remove"===c)c=(a.mid?1:0)+(a.gsid?1:0)+(a.fbid?1:0)+(a.twid?1:0)+(a.ghid?1:0),2>c?(alert("You must have at least one authentication type."),mor.byId("aa"+b).checked=!0):b===mor.login.getAuthMethod()?(alert("You can't remove the authentication you are currently logged in with."),mor.byId("aa"+b).checked=!0):confirm("Are you sure you want to remove access to this Pen Name from "+
A(b)+"?")?(mor.out(d,"Updating..."),g=a[b],a[b]=0,mor.pen.updatePen(a,function(a){C(d,a)},function(c,e){mor.err("handleAuthChangeToggle error "+c+": "+e);a[b]=g;C(d,a)})):mor.byId("aa"+b).checked=!0;else if("add"===c)switch(b){case "mid":mor.out(d,'<form action="'+mor.secsvr+'/loginid" enctype="multipart/form-data" method="post"><table><tr><td colspan="2">Adding native authorization to '+a.name+':</td></tr><tr><td align="right">username</td><td align="left"><input type="text" id="userin" name="userin" size="20"/></td></tr><tr><td align="right">password</td><td align="left"><input type="password" id="passin" name="passin" size="20"/></td></tr><tr><td colspan="2" align="center" id="settingsbuttons"><input type="submit" value="Log in"></td></tr></table></form>');
break;case "fbid":require(["ext/facebook"],function(b){mor.facebook||(mor.facebook=b);b.addProfileAuth(d,a)});break;case "twid":require(["ext/twitter"],function(b){mor.twitter||(mor.twitter=b);b.addProfileAuth(d,a)});break;case "gsid":require(["ext/googleplus"],function(b){mor.googleplus||(mor.googleplus=b);b.addProfileAuth(d,a)});break;case "ghid":require(["ext/github"],function(b){mor.github||(mor.github=b);b.addProfileAuth(d,a)})}},P=function(a){var b,d=mor.pen.getPenNames(),c;b='<div id="penseldiv"><span class="headingtxt">Writing as </span><select id="penselect" onchange="mor.profile.switchPen();return false;">';
for(c=0;c<d.length;c+=1)b+='<option id="'+mor.instId(d[c])+'"',d[c].name===a.name&&(b+=' selected="selected"'),b+=">"+d[c].name+"</option>";mor.out("dlgdiv",'<table><tr><td colspan="2" align="left" id="pensettitletd">'+(b+'<option id="newpenopt">New Pen Name</option></select>&nbsp;<button type="button" id="penselectok" onclick="mor.profile.switchPen();return false;">go</button></div>')+'</td></tr><tr><td colspan="2" id="settingsmsgtd"></td></tr><tr><td rowspan="2" align="right" valign="top"><img src="img/penname.png" alt="Pen Name"/></td><td align="left"><input type="text" id="pennamein" size="25" value="'+
a.name+'"/></td></tr><tr><td id="settingsauthtd"></td></tr><tr><td colspan="2" id="settingsskintd"></td></tr><tr><td colspan="2" id="consvcstd"></td></tr><tr><td colspan="2" align="center" id="settingsbuttons"><button type="button" id="cancelbutton">Cancel</button>&nbsp;<button type="button" id="savebutton">Save</button></td></tr></table>');mor.onchange("pennamein",mor.profile.setPenName);mor.onclick("cancelbutton",g);mor.onclick("savebutton",mor.profile.saveSettings);C("settingsauthtd",a);mor.services.display("consvcstd",
a);mor.skinner.init("settingsskintd",a);mor.byId("dlgdiv").style.visibility="visible";mor.isLowFuncBrowser()&&(mor.byId("dlgdiv").style.backgroundColor="#eeeeee");mor.onescapefunc=g},J=function(a,b){var d;b?(d=a.mid,a.mid=b,mor.pen.updatePen(a,function(a){P(a)},function(b,c){mor.err("addMyOpenReviewsAuthId error "+b+": "+c);a.mid=d;mor.profile.display()})):(mor.err("No account ID received."),mor.profile.display())},K=function(a){var b=mor.instId(a),d,c,g;c=mor.objdata({view:"profile",profid:b});(g=
mor.ellipsis(a.shoutout,75))||(g="View profile for "+a.name);d="img/emptyprofpic.png";a.profpic&&(d="profpic?profileid="+b);b='<li><a href="#'+c+'" onclick="mor.profile.changeid(\''+b+'\');return false;" title="'+g+'">'+('<img class="srchpic" src="'+d+'"/>&nbsp;<span class="penfont">'+a.name+"</span></a>");a.city&&(b+=' <span class="smalltext">('+a.city+")</span>");var e;d="";mor.pen.deserializeFields(a);g=mor.review.getReviewTypes();for(c=0;a.top20s&&c<g.length;c+=1)e=g[c].type,a.top20s[e]&&20<=
a.top20s[e].length&&(d+=mor.review.badgeImageHTML(g[c]));return b=b+d+"</li>"},L=function(a,b){var d;for(d=0;b&&d<b.length;d+=1)if(mor.instId(b[d])===a)return b[d]},Q=function(a){var b;b||(b=L(a,mor.pen.getPenNames()));b||(b=L(a,s));b||(b=L(a,e));return b},U=function(a,b){var d;if(d=Q(a))return b(d);mor.call("penbyid?penid="+a,"GET",null,function(d){0<d.length?(e.push(d[0]),b(d[0])):mor.err("findOrLoadPen found no pen id: "+a)},function(a,b){mor.err("findOrLoadPen failed code "+a+": "+b)},"")},G=
function(a,b){0>b.indexOf(";")&&(b+=";");return'<a href="#'+a+'" title="Click to see '+a+'" onclick="'+b+'return false;">'+a+"</a>"},H=function(a,b){var d,g,e;g=mor.byId("proftabsul");for(d=0;d<g.childNodes.length;d+=1)e=g.childNodes[d],e.className="unselectedTab",e.style.backgroundColor=mor.skinner.darkbg();e=mor.byId(a);e.className="selectedTab";e.style.backgroundColor="transparent";f=b;mor.historyCheckpoint({view:"profile",profid:mor.instId(c),tab:mor.profile.currentTabAsString()})},z=function(a,
b){var d,c;d=mor.instId(a);c=mor.review.getReviewTypeByValue(a.revtype);d="<li>"+mor.review.starsImageHTML(a.rating)+mor.review.badgeImageHTML(c)+'&nbsp;<a id="lihr'+d+'" href="'+("statrev/"+d)+'" onclick="mor.profile.readReview(\''+d+'\');return false;" title="See full review">';d=c.subkey?d+("<i>"+mor.ellipsis(a[c.key],60)+"</i> "+mor.ellipsis(a[c.subkey],40)):d+mor.ellipsis(a[c.key],60);d+="</a>";a.url&&(d+=" &nbsp;"+mor.review.graphicAbbrevSiteLink(a.url));b&&(c=mor.objdata({view:"profile",profid:a.penid}),
d+='<div class="revtextsummary"><a href="#'+c+'" onclick="mor.profile.changeid(\''+a.penid+'\');return false;" title="Show profile for '+mor.ndq(b)+'">review by '+b+"</a></div>");d+='<div class="revtextsummary">'+mor.ellipsis((a.text||"")+" "+(a.keywords||""),255)+"</div>";return d+"</li>"},V=function(a,b){var d,g='<ul class="revlist">',e;for(d=0;d<a.results.length;d+=1)g+=z(a.results[d]);if(b){a.cursor="";for(d=0;d<b.length;d+=1){if(b[d].fetched){e=b[d].fetched;"number"===typeof e&&0<=e&&(a.total+=
b[d].fetched,g+='<div class="sumtotal">'+a.total+" reviews searched</div>");b[d].cursor&&(a.cursor=b[d].cursor);break}a.results.push(b[d]);g+=z(b[d])}}a.total=Math.max(a.total,a.results.length);0===a.total&&(g+="<li>No recent reviews.",mor.instId(c)===mor.pen.currPenId()&&(g+=" "+mor.review.reviewLinkHTML()),g+="</li>");g+="</ul>";a.cursor&&(0===d&&0===a.results.length?2E3>a.total?setTimeout(mor.profile.revsmore,10):g+="No recent reviews found, only batch updates.":g+='<a href="#continuesearch" onclick="mor.profile.revsmore();return false;" title="More reviews">more reviews...</a>');
mor.out("profcontdiv",g);mor.layout.adjust()},N=function(a){var b;a.params.penid||(a.params.penid=mor.instId(c));b=mor.objdata(a.params)+"&"+mor.login.authparams();a.cursor&&(b+="&cursor="+mor.enc(a.cursor));mor.call("srchrevs?"+b,"GET",null,function(b){V(a,b)},function(a,b){mor.out("profcontdiv","findRecentReviews failed code "+a+" "+b)},"")},E=function(){var b,d;H("recentli",E);q&&q.initialized&&q.penid===mor.instId(c)?V(q):(b="Retrieving recent activity for "+c.name+"...",mor.out("profcontdiv",
b),mor.layout.adjust(),a(q),b=new Date,d=new Date(b.getTime()-2592E6),q.params.maxdate=b.toISOString(),q.params.mindate=d.toISOString(),q.penid=mor.instId(c),q.initialized=!0,N(q))},I=function(){var a,b,d;H("bestli",I);"string"===typeof c.top20s&&(c.top20s=mor.dojo.json.parse(c.top20s));p.dispType||(p.dispType="book",c.top20s&&c.top20s.latestrevtype&&(p.dispType=c.top20s.latestrevtype));a=mor.review.reviewTypeRadiosHTML("trbchoice","mor.profile.topTypeChange",c.top20s,p.dispType);b=[];c.top20s&&(b=
c.top20s[p.dispType]||[]);a+='<ul class="revlist">';0===b.length&&(a+="<li>No top rated reviews.",mor.instId(c)===mor.pen.currPenId()&&(a+=" "+mor.review.reviewLinkHTML()),a+="</li>");for(d=0;d<b.length;d+=1)if("string"===typeof b[d])if(0<=b[d].indexOf("not found"))a+="</li>Review "+b[d]+"</li>";else if("object"===typeof p.review&&mor.instId(p.review)===b[d])b[d]=p.review,a+=z(b[d]);else{a+="<li>Fetching review "+b[d]+"...</li>";break}else"object"===typeof b[d]&&(a+=z(b[d]));mor.out("profcontdiv",
a+"</ul>");mor.layout.adjust();d<b.length&&mor.call("revbyid?revid="+b[d],"GET",null,function(a){0<a.length?p.review=a[0]:b[d]+=": not found";mor.profile.best()},function(a,c){b[d]+=": not found";mor.profile.best()},"")},R=function(){H("followingli",R);n||(n={profpen:c,direction:"outbound",divid:"profcontdiv"});mor.rel.displayRelations(n);mor.layout.adjust()},B=function(){H("followersli",B);v||(v={profpen:c,direction:"inbound",divid:"profcontdiv"});mor.rel.displayRelations(v);mor.layout.adjust()},
D=function(a){var b,d,c;c={pen:{ulc:"penlist",stype:"pen names"},rev:{ulc:"revlist",stype:"reviews"}};c=c[m];d='<ul class="'+c.ulc+'">';for(b=0;b<s.length;b+=1)"pen"===m?d+=K(s[b]):"rev"===m&&(d+=z(s[b]));if(!a||0===a.length)a=[{fetched:0,cursor:""}];t="";for(b=0;b<a.length;b+=1){if("number"===typeof a[b].fetched){k+=a[b].fetched;d+='<div class="sumtotal">'+k+" "+c.stype+" searched</div>";a[b].cursor&&(t=a[b].cursor);break}var g;g=void 0;g="rev"===m?!1:(g=mor.rel.outbound(mor.instId(a[b])))?h.includeFollowing&&
"following"===g.status||h.includeBlocked&&"blocked"===g.status?!1:!0:!1;g||(s.push(a[b]),"pen"===m?d+=K(a[b]):"rev"===m&&(d+=z(a[b])))}d+="</ul>";t&&(0===b&&k<1E3*u?setTimeout(mor.profile.srchmore,10):(k>=1E3*u&&(u+=1),d+='<a href="#continuesearch" onclick="mor.profile.srchmore();return false;" title="Continue searching for more matching '+c.stype+'">continue search...</a>'));mor.out("searchresults",d);mor.byId("srchbuttonspan").style.display="inline";mor.out("srchmessagespan","")},S=function(){var a,
b,d;a=mor.byId("searchtxt").value;a=mor.login.authparams()+"&qstr="+mor.enc(a)+"&cursor="+mor.enc(t);0<h.activeDaysAgo&&(b=(new Date).getTime(),b-=864E5*h.activeDaysAgo,b=new Date(b),b=b.toISOString(),a+="&time="+mor.enc(b));if(0<h.reqmin.length){b="";for(d=0;d<h.reqmin.length;d+=1)0<d&&(b+=","),b+=h.reqmin[d];a+="&t20="+mor.enc(b)}h.includeLurkers&&(a+="&lurkers=include");mor.call("srchpens?"+a,"GET",null,function(a){D(a)},function(a,b){mor.out("searchresults","error code: "+a+" "+b)},"")},ba=function(){var a,
b,d,c;a=mor.byId("searchtxt").value;b=document.getElementsByName("srchrevtype");for(d=0;d<b.length;d+=1)if(b[d].checked){c=mor.review.getReviewTypeByValue(b[d].value);break}b=(new Date).toISOString();d=(new Date(0)).toISOString();a=mor.login.authparams()+"&qstr="+mor.enc(mor.canonize(a))+"&revtype="+c.type+"&penid="+mor.pen.currPenId()+"&maxdate="+b+"&mindate="+d+"&cursor="+mor.enc(t);mor.call("srchrevs?"+a,"GET",null,function(a){D(a)},function(a,b){mor.out("searchresults","error code: "+a+" "+b)},
"")},W=function(){var a,b,d,c;h.reqmin=[];a=document.getElementsByName("reqmin");for(b=0;b<a.length;b+=1)a[b].checked&&(d=mor.review.getReviewTypeByValue(a[b].value),h.reqmin.push(d.type));a=mor.byId("srchactivesel").options;for(b=0;b<a.length;b+=1)if(a[b].selected){switch(a[b].id){case "pastweek":c=7;break;case "pastmonth":c=30;break;case "pastyear":c=365;break;case "whenever":c=-1}break}h.activeDaysAgo=c;h.includeFollowing=!1;h.includeBlocked=!1;h.includeLurkers=!1;a=document.getElementsByName("srchinc");
for(b=0;b<a.length;b+=1)a[b].checked&&("following"===a[b].value&&(h.includeFollowing=!0),"blocked"===a[b].value&&(h.includeBlocked=!0),"lurkers"===a[b].value&&(h.includeLurkers=!0));mor.byId("pensearchoptionsdiv").style.display="none";mor.byId("revsearchoptionsdiv").style.display="none";mor.out("srchoptstogglehref","+ search options");mor.byId("srchbuttonspan").style.display="none";mor.out("srchmessagespan","Searching...");switch(m){case "pen":return S();case "rev":return ba()}},M=function(){s=[];
t="";k=0;u=1;mor.out("searchresults","");W()},F=function(){var a=mor.byId(m+"searchoptionsdiv");a&&("none"===a.style.display?(mor.out("srchoptstogglehref","- search options"),a.style.display="block"):(mor.out("srchoptstogglehref","+ search options"),a.style.display="none"));mor.layout.adjust()},X=function(){var a,b,d=m;b=document.getElementsByName("searchmode");for(a=0;a<b.length;a+=1)if(b[a].checked)if("pen"===b[a].value){mor.byId("revsearchoptionsdiv").style.display="none";mor.byId("pensearchoptionsdiv").style.display=
"block";mor.byId("searchtxt").placeholder="Pen name, city or shoutout...";m="pen";break}else if("rev"===b[a].value){mor.byId("revsearchoptionsdiv").style.display="block";mor.byId("pensearchoptionsdiv").style.display="none";mor.byId("searchtxt").placeholder="Review title or name...";m="rev";break}mor.out("srchoptstogglehref","");d!==m&&mor.out("searchresults","");"pen"===m&&F()},Y=function(){return f===E?"recent":f===I?"best":f===R?"following":f===B?"followers":f===mor.profile.search?"search":"recent"},
ca=function(){mor.profile.updateHeading();mor.profile.display()},da=function(a,b){mor.out("sysnotice",b)},Z=function(a){var b;if(b=mor.byId("profcityin"))a.city=b.value;if(b=mor.byId("shouttxt"))a.shoutout=b.value;mor.pen.updatePen(a,mor.profile.display,da)},$=function(){mor.byId("profcancelb")||(mor.out("profeditbspan",'&nbsp;<button type="button" id="profcancelb">Cancel</button>&nbsp;<button type="button" id="profsaveb">Save</button>'),mor.onclick("profcancelb",ca),mor.onclick("profsaveb",mor.profile.save))},
T=function(a){var b;a.style.color=mor.colors.text;a.style.backgroundColor=mor.skinner.lightbg();b=Math.max(mor.winw-350,200);b=Math.min(b,600);a.style.width=b+"px";b+=mor.byId("profpictd").offsetWidth;b+=50;mor.byId("profcontdiv").style.width=String(b)+"px"},fa=function(a){var b;mor.out("profshouttd",'<div id="shoutdiv" class="shoutout"></div>');b=mor.byId("shoutdiv");T(b);b.style.overflow="auto";b.style.border="1px solid "+mor.colors.bodybg;b=mor.linkify(a.shoutout)||'<span style="color:#999999;">No shoutout</span>';
mor.out("shoutdiv",b);if(mor.profile.authorized(a))mor.onclick("shoutdiv",function(){var b;mor.out("profshouttd",'<textarea id="shouttxt" class="shoutout"></textarea>');b=mor.byId("shouttxt");T(b);b.readOnly=!1;b.value=a.shoutout;b.focus();$()})},ga=function(){mor.byId("shoutdiv")&&mor.profile.save()},ha=function(a){var b="img/emptyprofpic.png";a.profpic&&(b="profpic?profileid="+mor.instId(a));mor.out("profpictd",'<img class="profpic" src="'+b+'"/>');if(mor.profile.authorized(a))mor.onclick("profpictd",
function(){mor.byId("profcancelb")&&Z(a);var b;b=""+mor.paramsToFormInputs(mor.login.authparams());b+='<input type="hidden" name="_id" value="'+mor.instId(a)+'"/>';b+='<input type="hidden" name="returnto" value="'+mor.enc(window.location.href+"#profile")+'"/>';mor.out("overlaydiv",'<form action="/profpicupload" enctype="multipart/form-data" method="post"><div id="closeline"><a id="closedlg" href="#close" onclick="mor.cancelPicUpload();return false">&lt;close&nbsp;&nbsp;X&gt;</a></div>'+b+'<table><tr><td>Upload New Profile Pic</td></tr><tr><td><input type="file" name="picfilein" id="picfilein"/></td></tr><tr><td align="center"><input type="submit" value="Upload"/></td></tr></form>');
b=mor.byId("overlaydiv");b.style.top="80px";b.style.visibility="visible";b.style.backgroundColor=mor.skinner.lightbg();mor.onescapefunc=mor.cancelPicUpload;mor.byId("picfilein").focus()})},ea=function(a,b,d,g){b||(b=a);c!==b&&(c=b,v=n=null);mor.historyCheckpoint({view:"profile",profid:mor.instId(c),tab:Y()});y(a,b);mor.skinner.setColorsFromPen(a);mor.out("cmain",'<div id="proftopdiv"><table id="profdisptable"><tr><td id="sysnotice" colspan="2"></tr><tr><td id="profpictd" rowspan="2"><img class="profpic" src="img/emptyprofpic.png"/></td><td id="profshouttd"><div id="shoutdiv" class="shoutout"></div></td></tr><tr><td id="profcitytd"><span id="profcityspan"> </span><span id="profeditbspan"> </span></td></tr><tr><td colspan="2"><div id="proftabsdiv"> </div></td></tr><tr><td colspan="2"><div id="profcontdiv"> </div></td></tr></table></div>');
fa(b);a=b;var e="";a.city||(mor.byId("profcityspan").style.color="#999999");d=a.city||"City not specified";a.city||(e=' style="color:#999999;"');mor.profile.authorized(a)&&(d='<a href="#edit city" title="Edit city" id="profcitya" onclick="mor.profile.editCity();return false;"'+e+">"+d+"</a>");mor.out("profcityspan",d);ha(b);b='<ul id="proftabsul"><li id="recentli" class="selectedTab">'+G("Recent Activity","mor.profile.recent()")+'</li><li id="bestli" class="unselectedTab">'+G("Top Rated","mor.profile.best()")+
'</li><li id="followingli" class="unselectedTab">'+G("Following ("+b.following+")","mor.profile.following()")+'</li><li id="followersli" class="unselectedTab">'+G("Followers ("+b.followers+")","mor.profile.followers()")+"</li>";mor.instId(c)===mor.pen.currPenId()&&(b+='<li id="searchli" class="unselectedTab">'+G("Search","mor.profile.search()")+"</li>");mor.out("proftabsdiv",b+"</ul>");f||(f=E);f();mor.layout.adjust();g&&mor.err("Previous processing failed: "+g)},aa=function(b){a(q);q.tab="recent";
U(b,function(a){mor.pen.getPen(function(b){ea(b,a)})})};return{resetStateVars:function(){c=f=null;e=[];a(q);p={};v=n=null;h={};s=[];t="";k=0;u=1},display:function(a,b){mor.pen.getPen(function(d){ea(d,null,a,b)})},updateHeading:function(){mor.pen.getPen(function(a){y(a,c)})},settings:function(){mor.pen.getPen(P)},recent:function(){E()},best:function(){I()},following:function(){R()},followers:function(){B()},search:function(){"string"===typeof c.top20s&&(c.top20s=mor.dojo.json.parse(c.top20s));H("searchli",
mor.profile.search);var a='<table class="searchtable"><tr><td class="formstyle" style="vertical-align:top;">'+mor.checkrad("radio","searchmode","pen","Pen Names","pen"===m,"mor.profile.srchmode")+"<br/>"+mor.checkrad("radio","searchmode","rev","My Reviews","rev"===m,"mor.profile.srchmode")+'</td><td style="text-align:center;vertical-align:middle;"><input type="text" id="searchtxt" size="40" placeholder="Pen name, city or shoutout..." value=""/> &nbsp; <span id="srchbuttonspan"><button type="button" id="searchbutton">Search</button></span><span id="srchmessagespan"> </span><br/><span id="srchoptstoggle" class="formstyle"><a href="#searchoptions" id="srchoptstogglehref" title="search options" onclick="mor.profile.togglesrchopts();return false;"></a></span></tr></table>'+
('<div id="pensearchoptionsdiv" class="formstyle"><i>Must have reviewed their top 20</i>'+mor.review.reviewTypeCheckboxesHTML("reqmin")+'<i>Must have been active within the past</i>&nbsp;<select id="srchactivesel"><option id="whenever">Whenever</option><option id="pastyear" selected="selected">Year</option><option id="pastmonth">Month</option><option id="pastweek">Week</option></select><br/><i>Include</i>&nbsp;'+mor.checkbox("srchinc","following")+mor.checkbox("srchinc","blocked")+mor.checkbox("srchinc",
"lurkers")+" <i> in the search results</i><br/>&nbsp;<br/></div>"),b;b="book";c.top20s&&c.top20s.latestrevtype&&(b=c.top20s.latestrevtype);b='<div id="revsearchoptionsdiv" class="formstyle">'+mor.review.reviewTypeRadiosHTML("srchrevtype","",c.top20s,b)+"<br/>&nbsp;<br/></div>";mor.out("profcontdiv",a+b+'<div id="searchresults"></div>');var d;if(h.reqmin)for(a=0;a<h.reqmin.length;a+=1)mor.byId(h.reqmin[a]).checked=!0;if(h.activeDaysAgo){d=h.activeDaysAgo;b=mor.byId("srchactivesel").options;for(a=0;a<
b.length;a+=1)switch(b[a].id){case "pastweek":b[a].selected=7===d;break;case "pastmonth":b[a].selected=30===d;break;case "pastyear":b[a].selected=365===d;break;case "whenever":b[a].selected=0>=d}}mor.byId("following").checked=h.includeFollowing;mor.byId("blocked").checked=h.includeBlocked;mor.byId("lurkers").checked=h.includeLurkers;s&&0<s.length&&D([]);mor.onchange("searchtxt",M);mor.onclick("searchbutton",M);X();mor.byId("searchtxt").focus();mor.layout.adjust();"pen"===m&&(!s||0===s.length)&&M()},
togglesrchopts:function(){F()},resetReviews:function(){a(q);q.tab="recent"},authorized:function(a){return mor.isId(a.mid)||mor.isId(a.gsid)||mor.isId(a.fbid)||mor.isId(a.twid)||mor.isId(a.ghid)?!0:!1},save:function(){mor.pen.getPen(Z)},setPenName:function(){mor.pen.getPen(d)},saveSettings:function(){mor.pen.getPen(r)},byprofid:function(a){aa(a)},changeid:function(a){f=E;aa(a)},initWithId:function(a){mor.pen.getPen(function(b){aa(a)})},setTab:function(a){switch(a){case "recent":f=E;break;case "best":f=
I;break;case "following":f=R;break;case "followers":f=B;break;case "search":f=mor.profile.search}},srchmore:function(){W()},relationship:function(){b()},retrievePen:function(a,b){return U(a,b)},getCachedPen:function(a){return Q(a)},switchPen:function(){var a,b=mor.byId("penselect");a="";for(a=0;a<b.options.length;a+=1)if(b.options[a].selected){"newpenopt"===b.options[a].id?(g("Creating new pen name..."),mor.pen.newPenName(mor.profile.display)):(a=b.options[a].value,g("Switching pen names..."),mor.pen.selectPenByName(a));
break}},penListItemHTML:function(a){return K(a)},updateCache:function(a){var b,d=mor.instId(a);for(b=0;b<s.length;b+=1)if(mor.instId(s[b])===d){s[b]=a;break}for(b=0;b<e.length;b+=1)if(mor.instId(e[b])===d){e[b]=a;break}},currentTabAsString:function(){return Y()},revsmore:function(){N(q)},readReview:function(a){var b,d,g,e,r;for(b=0;!d&&b<q.results.length;b+=1)mor.instId(q.results[b])===a&&(d=q.results[b]);if(!d&&c&&c.top20s&&"object"===typeof c.top20s)for(e in g=c.top20s,g)if(g.hasOwnProperty(e)&&
e&&(r=g[e])&&r.length&&"string"!==typeof r)for(b=0;!d&&b<r.length;b+=1)"object"===typeof r[b]&&mor.instId(r[b])===a&&(d=r[b]);d||(d=mor.activity.findReview(a));if(!d&&s&&s.length)for(b=0;b<s.length&&s[b].revtype;b+=1)mor.instId(s[b])===a&&(d=s[b]);d?(mor.historyCheckpoint({view:"review",mode:"display",revid:a}),mor.review.setCurrentReview(d),mor.review.displayRead()):mor.err("readReview "+a+" not found")},topTypeChange:function(){var a,b;a=document.getElementsByName("trbchoice");for(b=0;b<a.length;b+=
1)if(a[b].checked){if((a=mor.review.getReviewTypeByValue(a[b].value))&&a.type!==p.dispType)p.dispType=a.type;break}mor.profile.best()},reviewItemHTML:function(a,b){return z(a,b)},toggleAuthChange:function(a,b){mor.pen.getPen(function(d){O(d,a,b)})},displayAuthSettings:function(a,b){C(a,b)},srchmode:function(){X()},addMyOpenReviewsAuthId:function(a){mor.pen.getPen(function(b){J(b,a)})},writeNavDisplay:function(a,b){y(a,b)},verifyStateVariableValues:function(a){c!==a&&(c=a,v=n=null)},cancelPenNameSettings:function(){g()},
editCity:function(){var a;if(!mor.byId("profcityin")){a=mor.byId("profcityspan").innerHTML;if(0===a.indexOf("<a")||0===a.indexOf("<A"))a=mor.byId("profcitya").innerHTML;"City not specified"===a&&(a="");mor.out("profcityspan",'<input type="text" id="profcityin" size="25" placeholder="City or Region" value="'+a+'"/>');$();mor.onchange("profcityin",ga);mor.byId("profcityin").focus()}},setSearchMode:function(a){m=a}}});
define("amd/activity",[],function(){var f,c,e,q="",p={},n=[],v="activity",h=function(){var a;"activity"===v?(a="rssact?pen="+mor.pen.currPenId(),a="Recent friend reviews "+mor.imglink(a,"RSS feed for recent friend reviews","window.open('"+a+"')","rssicon.png","rssico")):"memo"===v&&(a="Remembered reviews");mor.out("centerhdiv",a)},s=function(){setTimeout(function(){mor.profile.setTab("search");mor.profile.setSearchMode("pen");mor.profile.display()},50)},t=function(a){var b;if(p[a])return p[a];for(b=
0;a&&c&&b<c.length;b+=1)if(mor.instId(c[b])===a)return c[b]},k=function(a){var b,d,c,e,k,f,u=50;mor.pen.deserializeFields(a);d='<ul class="revlist">';if(!a.revmem||!a.revmem.remembered||!a.revmem.remembered.length)d+='<li>You have not remembered any reviews. If you see a review worth remembering, click the "Remember" button for it and it will be kept here.</li>';else{u=Math.min(u,a.revmem.remembered.length);for(b=0;b<u;b+=1)if(c=t(a.revmem.remembered[b])){if(!c.penNameStr&&(k=mor.profile.getCachedPen(c.penid)))c.penNameStr=
k.name;if(!c.penNameStr){f=c.penid;d+="<li>Fetching Pen Name "+f+"...</li>";break}d+=mor.profile.reviewItemHTML(c,c.penNameStr)}else if(0<=n.indexOf(a.revmem.remembered[b]))u+=1;else{e=a.revmem.remembered[b];d+="<li>Fetching Review "+e+"...</li>";break}}mor.out("revactdiv",d+"</ul>");mor.layout.adjust();e&&setTimeout(function(){mor.call("revbyid?revid="+e,"GET",null,function(a){mor.activity.cacheReview(a[0]);mor.activity.display()},function(a,b){mor.log("displayRemembered revbyid "+e+" "+a+" "+b);
n.push(e)},"",null,[404])},50);f&&setTimeout(function(){mor.profile.retrievePen(f,mor.activity.display)},50)},u=function(){var a,b,d='<ul class="revlist">';0===c.length&&(d+="<li>No review activity</li>");for(a=0;a<c.length;a+=1)if(d+=mor.profile.reviewItemHTML(c[a],c[a].penNameStr),!c[a].penNameStr){b=c[a].penid;break}b&&setTimeout(function(){mor.profile.retrievePen(b,mor.activity.notePenNameStr)},50);d+="</ul>";q&&(d+='<a href="#moreact" onclick="mor.activity.moreact();return false;" title="More activity">more activity...</a>');
mor.out("revactdiv",d);mor.layout.adjust()},m=function(a){var b=mor.rel.outbound(a.penid);return a.rating<b.cutoff||b.mute&&b.mute.indexOf(0<=a.revtype)?!0:!1},a=function(a){var b,d;d="penids="+f.join(",");!a&&e&&(d+="&since="+e.toISOString());a&&(d+="&cursor="+q);b=(new Date).getTime();mor.call("revact?"+d,"GET",null,function(d){b=(new Date).getTime()-b;mor.log("revact returned in "+b/1E3+" seconds.");e=new Date;var k;if(a){q="";for(k=0;k<d.length;k+=1)d[k].fetched?d[k].cursor&&(q=d[k].cursor):m(d[k])||
c.push(d[k])}else for(k=0;k<d.length;k+=1)!d[k].fetched&&!m(d[k])&&c.unshift(d[k]);q&&0===c.length&&setTimeout(mor.activity.moreact,10);u()},function(a,b){mor.out("revactdiv","error code: "+a+" "+b)},"")},b=function(){return'<a href="#searchpens" onclick="mor.activity.searchpens();return false;">Search pen names</a>'},y=function(){var d,g=!1;h();f=mor.rel.outboundids();0===f.length?d="You are not following anyone. To follow someone, go to their profile and click the follow icon next to their name. "+
b():"waiting"===f[f.length-1]||"loading"===f[f.length-1]?(g=!0,d="Loading relationships..."):(c=[],d="Loading activity...");mor.out("revactdiv",d);mor.layout.adjust();c&&a(!0);g&&setTimeout(y,500)},d=function(b){mor.historyCheckpoint({view:"activity"});h();mor.byId("revactdiv")||(mor.byId("cmain")||mor.layout.initContent(),mor.out("cmain",'<div id="revactdiv"></div>'));"memo"===v?k(b):c?(u(),a()):y()};return{resetStateVars:function(){e=c=f=null;q="";p={};n=[];v="activity"},display:function(){mor.pen.getPen(d)},
updateHeading:function(){h()},searchpens:function(){s()},moreact:function(){a()},notePenNameStr:function(a){var b,d=mor.instId(a);for(b=0;b<c.length;b+=1)c[b].penid===d&&(c[b].penNameStr=a.name);u()},findReview:function(a){return t(a)},cacheReview:function(a){p[mor.instId(a)]=a},searchPensLinkHTML:function(){return b()},activityLinkHTML:function(){return'<div class="topnavitemdiv">'+mor.imgntxt("friendact.png","Friend Reviews","mor.activity.displayActive()","#Activity","See what's been posted recently")+
"</div>"},rememberedLinkHTML:function(){return'<div class="topnavitemdiv">'+mor.imgntxt("remembered.png","Remembered Reviews","mor.activity.displayRemembered()","#Remembered","Show remembered reviews")+"</div>"},displayActive:function(){v="activity";mor.pen.getPen(d)},displayRemembered:function(){v="memo";mor.pen.getPen(d)}}});
define("amd/pen",[],function(){var f,c,e,q=function(a){"object"===typeof a.revmem&&(a.revmem=mor.dojo.json.stringify(a.revmem));"object"===typeof a.settings&&(a.settings=mor.dojo.json.stringify(a.settings))},p=function(a){var b,c;if(a.revmem){if("object"!==typeof a.revmem)try{b=a.revmem,c=mor.dojo.json.parse(b),a.revmem=c}catch(d){mor.log("pen.deserializeFields "+a.name+": "+d),a.revmem={}}}else a.revmem={};"object"!==typeof a.revmem&&(mor.log("Re-initializing penName revmem.  Deserialized value was not an object: "+
a.revmem),a.revmem={});if(a.settings){if("object"!==typeof a.settings)try{b=a.settings,c=mor.dojo.json.parse(b),a.settings=c}catch(e){mor.log("pen.deserializeFields "+a.name+": "+e),a.settings={}}}else a.settings={};"object"!==typeof a.settings&&(mor.log("Re-initializing penName settings.  Deserialized value was not an object: "+a.settings),a.settings={});a.top20s?"string"===typeof a.top20s&&(a.top20s=mor.dojo.json.parse(a.top20s)):a.top20s={}},n=function(){var a;c&&(a="penid="+mor.instId(c),mor.call("penbyid?"+
a,"GET",null,function(a){0<a.length&&(c.name=a[0].name,c.shoutout=a[0].shoutout,c.city=a[0].city,c.accessed=a[0].accessed,c.modified=a[0].modified,c.top20s=a[0].top20s,c.following=a[0].following,c.followers=a[0].followers)},function(a,c){mor.log("refreshCurrentPenFields "+a+" "+c)},""))},v=function(a){a||(a=e);mor.layout.initContent();mor.rel.loadoutbound(c);a(c)},h=function(a,b,e){q(a);a=mor.objdata(a);mor.call("updpen?"+mor.login.authparams(),"POST",a,function(a){c=a[0];p(c);b(c)},function(a,b){e(a,
b)},"")},s=function(){var a,b,e;e=mor.byId("pnamein").value;a=mor.byId("formbuttons").innerHTML;mor.out("formbuttons","Creating Pen Name...");b={};b.name=e;c&&c.settings&&(b.settings=c.settings,q(b));b=mor.objdata(b);mor.call("newpen?"+mor.login.authparams(),"POST",b,function(a){c=a[0];f||(f=[]);f.push(c);p(c);mor.rel.resetStateVars("new");mor.activity.resetStateVars();mor.login.updateAuthentDisplay();v()},function(b,c){mor.out("penformstat",c);mor.out("formbuttons",a)},"")},t=function(a){var b="";
e=a;mor.login.updateAuthentDisplay("hide");mor.out("centerhdiv","");c&&(b='<button type="button" id="cancelbutton" onclick="mor.pen.cancelNewPen();return false;">Cancel</button>');mor.out("contentdiv",'<div id="chead"> </div><div id="cmain"><p>Your pen name is a unique expression of style. You can have separate pen names for different personas, revealing as much (or as little) about yourself as you want. Use your real name, or get creative...</p><div id="penformstat">&nbsp;</div><table class="pennametable"><tr><td rowspan="2"><img src="img/penname.png"/></td><td class="formattr">Writing as...</td></tr><tr><td class="formval"><input type="text" id="pnamein" size="34"/></td></tr><tr><td colspan="2" id="formbuttons"align="center">'+
b+'<button type="button" id="createbutton">Create</button></td></tr></table></div>');mor.onchange("pnamein",s);mor.onclick("createbutton",s);mor.layout.adjust();mor.byId("pnamein").focus()},k=function(){var a,b="0000-00-00T00:00:00Z",c;if(f&&f.length)for(a=0;a<f.length;a+=1)p(f[a]),f[a].accessed>b&&(b=f[a].accessed,c=f[a]);return c},u=function(a){if(!f||0===f.length)return t(a);c=k();mor.skinner.setColorsFromPen(c);v(a)},m=function(a){var b;f&&u(a);mor.out("contentdiv","<p>Retrieving your pen name(s)...</p>");
mor.layout.adjust();b="mypens?"+mor.login.authparams();mor.call(b,"GET",null,function(b){f=b;u(a)},function(a,b){mor.out("contentdiv","Pen name retrieval failed: "+a+" "+b)},"")};return{resetStateVars:function(){e=c=f=null},getPen:function(a){if(c)return a(c);m(a)},currPenId:function(){return mor.instId(c)||0},updatePen:function(a,b,c){h(a,b,c)},noteUpdatedPen:function(a){var b,e=mor.instId(a);for(b=0;f&&b<f.length;b+=1)if(mor.instId(f[b])===e){f[b]=a;break}mor.instId(c)===e&&(c=a)},getPenNames:function(){return f},
newPenName:function(a){t(a)},selectPenByName:function(a){var b;for(b=0;b<f.length;b+=1)if(f[b].name===a){c=f[b];mor.skinner.setColorsFromPen(c);mor.rel.resetStateVars("reload",c);mor.activity.resetStateVars();h(f[b],mor.profile.display,mor.profile.display);break}},getHomePen:function(a){a:{var b;for(b=0;f&&b<f.length;b+=1)if(mor.instId(f[b])===a){a=f[b];break a}a=void 0}return a},findHomePen:function(){return k()},refreshCurrent:function(){n()},deserializeFields:function(a){p(a)},cancelNewPen:function(){mor.login.updateAuthentDisplay();
mor.profile.display()}}});
define("amd/rel",[],function(){var f,c,e,q=function(a){var b;b="outbound"===a.direction?"originid":"relatedid";b=mor.login.authparams()+"&"+b+"="+mor.instId(a.profpen);a.cursor?b+="&cursor="+a.cursor:a.offset&&(b+="&offset="+a.offset);mor.call("findrels?"+b,"GET",null,function(b){var d;a.rels=[];for(d=0;d<b.length;d+=1){if(b[d].fetched){b[d].cursor&&(a.cursor=b[d].cursor);break}a.rels.push(b[d])}mor.rel.displayRelations(a)},function(a,b){var c="loadDisplayRels error code "+a+": "+b;mor.log(c);mor.err(c)},
a.critsec)},p=function(a){var b=a.rels[a.pens.length];mor.profile.retrievePen("outbound"===a.direction?b.relatedid:b.originid,function(b){a.pens.push(b);mor.rel.displayRelations(a)})},n=function(a){var b;"blocked"===a.status?mor.byId("block").checked=!0:mor.byId("follow").checked=!0;if(a.mute){a=a.mute.split(",");for(b=0;b<a.length;b+=1)mor.byId(a[b]).checked=!0}},v=function(a){var b=mor.objdata(a);"nofollow"===a.status?mor.call("delrel?"+mor.login.authparams(),"POST",b,function(b){mor.pen.noteUpdatedPen(b[0]);
mor.profile.updateCache(b[1]);var d,c=mor.instId(a);for(d=0;d<f.length&&mor.instId(f[d])!==c;d+=1);d<f.length&&f.splice(d,1);mor.layout.closeDialog();mor.profile.byprofid(mor.instId(b[1]))},function(a,b){mor.err("Relationship deletion failed code "+a+": "+b)},""):mor.call("updrel?"+mor.login.authparams(),"POST",b,function(a){var b=a[0],c,g=mor.instId(b);for(c=0;c<f.length;c+=1)if(mor.instId(f[c])===g){f[c]=b;break}mor.layout.closeDialog();mor.profile.byprofid(a[0].relatedid)},function(a,b){mor.err("Relationship update failed code "+
a+": "+b)},"")},h=function(a,b){var c='<table class="formstyle"><tr><td><b>Status</b> '+mor.radiobutton("fstat","follow")+"&nbsp;"+mor.radiobutton("fstat","block")+"&nbsp;"+mor.radiobutton("fstat","nofollow","Stop Following")+"</td></tr><tr><td><b>Ignore reviews from "+b.name+" about</b>"+mor.review.reviewTypeCheckboxesHTML("mtype")+'</td></tr><tr><td colspan="2" align="center" id="settingsbuttons"><button type="button" id="cancelbutton">Cancel</button>&nbsp;<button type="button" id="savebutton">Save</button></td></tr></table>';
mor.out("dlgdiv",c);n(a);mor.onclick("cancelbutton",mor.layout.closeDialog);mor.onclick("savebutton",function(){mor.out("settingsbuttons","Saving...");var b,c;mor.byId("follow").checked?a.status="following":mor.byId("block").checked?a.status="blocked":mor.byId("nofollow").checked&&(a.status="nofollow");a.mute="";b=document.getElementsByName("mtype");for(c=0;c<b.length;c+=1)b[c].checked&&(a.mute&&(a.mute+=","),a.mute+=b[c].value);mor.activity.resetStateVars();v(a)});mor.byId("dlgdiv").style.visibility=
"visible";mor.onescapefunc=mor.layout.closeDialog},s=function(a){var b;for(b=0;f&&b<f.length;b+=1)if(f[b].relatedid===a)return f[b]},t=function(a,b,e){var d;(d=s(mor.instId(b)))?h(d,b):c?alert("Still loading relationships, try again in a few seconds"):(d={},d.originid=mor.instId(a),d.relatedid=mor.instId(b),mor.assert(d.originid&&d.relatedid),d.status="following",d.mute="",d.cutoff=0,a=mor.objdata(d),mor.call("newrel?"+mor.login.authparams(),"POST",a,function(a){mor.pen.noteUpdatedPen(a[0]);mor.profile.updateCache(a[1]);
f.push(a[2]);mor.activity.resetStateVars();e||(e=mor.instId(a[1]));mor.profile.byprofid(e)},function(a,b){mor.err("Relationship creation failed code "+a+": "+b)},""))},k=function(a){mor.pen.getPen(function(b){mor.profile.retrievePen(a,function(a){t(b,a,mor.instId(b))})})},u=function(a){var b;b=mor.login.authparams()+"&originid="+mor.instId(a);c&&"starting"!==c&&(b+="&cursor="+mor.enc(c));mor.call("findrels?"+b,"GET",null,function(b){var d;c="";for(d=0;d<b.length;d+=1){if(b[d].fetched){b[d].cursor&&
(c=b[d].cursor);break}f.push(b[d])}c?setTimeout(function(){u(a)},50):mor.profile.updateHeading()},function(a,b){mor.log("loadOutboundRelationships errcode "+a+": "+b);alert("Sorry. Data error. Please reload the page")},"")},m=function(a){e||(e=!0,c="starting",setTimeout(function(){f=[];u(a)},500))};return{resetStateVars:function(a,b){c=f=null;e=!1;"new"===a?f=[]:"reload"===a&&mor.rel.loadoutbound(b)},reledit:function(a,b){t(a,b)},outbound:function(a){return s(a)},loadoutbound:function(a){m(a)},outboundids:function(){var a,
b=[];for(a=0;f&&a<f.length;a+=1)"following"===f[a].status&&b.push(f[a].relatedid);e?c&&b.push("loading"):b.push("waiting");return b},alloutbound:function(){return f},displayRelations:function(a){var b;if(a){b='<ul class="penlist">';if(a.rels)if(a.pens&&0<a.pens.length){var c,d="",e;for(c=0;c<a.pens.length;c+=1){e=mor.profile.penListItemHTML(a.pens[c]);if("inbound"===a.direction){e=e.slice(0,e.indexOf("</li>"));var g;b:{g=a.pens[c];for(var k=void 0,u=void 0,m=void 0,k=void 0,m=mor.instId(g),k=0;k<
f.length;k+=1)if(u=f[k],u.relatedid===m){g="";break b}g=k=' <a href="#followback" title="follow '+g.name+'" onclick="mor.rel.followBack('+mor.instId(g)+');return false;" class="smalltext">[follow back]</a>'}e+=g+"</li>"}d+=e}b+=d}else 0===a.rels.length?"outbound"===a.direction?(b+="<li>Not following anyone.",mor.instId(a.profpen)===mor.pen.currPenId()&&(b+=" "+mor.activity.searchPensLinkHTML()),b+="</li>"):b+="<li>No followers.</li>":b+="<li>fetching pen names...</li>";else b+="<li>fetching relationships...</li>";
mor.out(a.divid,b+"</ul>");a.rels?(a.pens||(a.pens=[]),a=a.rels.length!==a.pens.length?p(a):void 0):a=q(a)}else mor.err("displayRelatedPens called without display object"),a=void 0;return a},followBack:function(a){k(a)},relsLoaded:function(){return e&&!c}}});
define("amd/skinner",[],function(){var f,c,e,q=[{id:"bodybg",label:"background"},{id:"darkbg",label:"shadow"},{id:"lightbg",label:"text area"},{id:"text",label:"text"},{id:"link",label:"link"},{id:"hover",label:"hover"}],p=[{name:"paper (warm)",id:"paperw",bodybg:"#fffffc",text:"#111111",lightbg:"#fffffe",darkbg:"#9b9b9a",link:"#521919",hover:"#885555"},{name:"paper (cool)",id:"paperc",bodybg:"#f8f8f8",text:"#111111",lightbg:"#fcfcfc",darkbg:"#a2a2a2",link:"#006666",hover:"#339999"},{name:"slate",
id:"slate",bodybg:"#ccdad9",text:"#111111",lightbg:"#d0deda",darkbg:"#72817f",link:"#003300",hover:"#447744"},{name:"parchment",id:"parchment",bodybg:"#dfb374",text:"#111111",lightbg:"#ffefaf",darkbg:"#997335",link:"#333300",hover:"#666633"}],n=function(a){return{bodybg:a.bodybg,lightbg:a.lightbg,darkbg:a.darkbg,text:a.text,link:a.link,hover:a.hover}},v=function(a,b){a.style.setProperty&&a.style.setProperty("color",b,null)},h=function(a,b,d){a[b]+=d;255<a[b]&&(a[b]=255);0>a[b]&&(a[b]=0)},s=function(a,
b){var d;d=a;0<=d.indexOf("#")&&(d=d.slice(1));d=d.toUpperCase();d=[parseInt(d.slice(0,2),16),parseInt(d.slice(2,4),16),parseInt(d.slice(4,6),16)];h(d,0,b);h(d,1,b);h(d,2,b);var c="#",e,k;for(k=0;k<d.length;k+=1)e=d[k].toString(16),2>e.length&&(e="0"+e),c+=e;return c},t=function(){mor.colors.lightbg||(mor.colors.lightbg=s(mor.colors.bodybg,4));return mor.colors.lightbg},k=function(){mor.colors.darkbg||(mor.colors.darkbg=s(mor.colors.bodybg,-56));return mor.colors.darkbg},u=function(){var a,b,d=["recentli",
"bestli","followingli","followersli","searchli"];if(a=mor.byId("bodyid"))a.style.color=mor.colors.text,a.style.backgroundColor=mor.colors.bodybg;if(a=mor.byId("topsectiondiv"))a.style.backgroundColor=t(),b="8px 8px 4px "+k(),a.style.boxShadow=b;if(a=mor.byId("shoutdiv"))a.style.backgroundColor=t();for(b=0;b<d.length;b+=1)if((a=mor.byId(d[b]))&&"unselectedTab"===a.className)a.style.backgroundColor=k();a=document.styleSheets[0].cssRules;for(b=0;a&&b<a.length;b+=1)mor.prefixed(a[b].cssText,"A:link")?
v(a[b],mor.colors.link):mor.prefixed(a[b].cssText,"A:visited")?v(a[b],mor.colors.link):mor.prefixed(a[b].cssText,"A:active")?v(a[b],mor.colors.link):mor.prefixed(a[b].cssText,"A:hover")&&v(a[b],mor.colors.hover)},m=function(a){var b,d,c;b='<table><tr><td align="right">Display</td><td align="left"><select id="presetsel">';for(d=0;d<p.length;d+=1)c=p[d].id,b+='<option id="'+c+'"',a&&(a.settings&&a.settings.colorPresetId===c)&&(b+=' selected="selected"'),b+=">"+p[d].name+"</option>";return b+'</select></td><td>&nbsp;&nbsp;<a href="#toggleSkinControls" id="skinctrltoggle" class="permalink" onclick="mor.skinner.toggleControls();return false;">show color controls</a></td></tr></table>'},
a=function(a){a||(a=0);"string"===typeof a&&(a=parseInt(a,10));e=q[a];mor.out("colortitlediv",e.label+' <span class="smalltext">(click only, drag disabled)</span>');c.setColor(mor.colors[e.id],!0)},b=function(b){var d,k,f,m;m='<table border="0">';for(d=0;d<q.length;d+=1)k=q[d].label,f=q[d].id,m+='<tr><td class="colorattrtd">'+k+'</td><td><div id="'+f+'div" class="colorswatch" onclick="mor.skinner.swatchClick(\''+d+'\');return false;" style="background:'+mor.colors[f]+';"></div>',0===d&&(m+='<td rowspan="'+
q.length+'" valign="top"><div id="colortitlediv"></div><div id="colorwidgetdiv"></div></td>'),m+="</tr>";mor.out("colorctrlsdiv",m+"</table>");c&&c.destroy();c=new b({onChange:function(a){mor.byId(e.id+"div").style.backgroundColor=a;mor.colors[e.id]=a;u()}},"colorwidgetdiv");a(0)},y=function(){var a;"show color controls"===mor.byId("skinctrltoggle").innerHTML?(a=document.styleSheets[0].cssRules)&&a[0].style.setProperty?(mor.byId("colorctrlsdiv").style.display="block",mor.out("skinctrltoggle","hide color controls"),
(a=mor.byId("colorctrlsdiv").innerHTML)||require(mor.cdnconf,["dojox/widget/ColorPicker","dojo/domReady!"],function(a){b(a)})):mor.byId("skinctrltoggle").style.color="#666666":(mor.byId("colorctrlsdiv").style.display="none",mor.out("skinctrltoggle","show color controls"))},d=function(b){var d,c=mor.byId("presetsel");for(d=0;d<c.options.length;d+=1)if(c.options[d].selected){b.settings.colorPresetId=p[d].id;c=b=b=void 0;mor.colors=n(p[d]);u();if(b=mor.byId("colorctrlsdiv").innerHTML){for(b=0;b<q.length;b+=
1)c=mor.byId(q[b].id+"div"),c.style.backgroundColor=mor.colors[q[b].id];a(0)}break}},r=function(a,b){var c;f=n(mor.colors);c=m(b)+'<div id="colorctrlsdiv" style="display:none;"></div>';mor.out(a,c);mor.onx("change","presetsel",function(a){a.preventDefault();a.stopPropagation();mor.pen.getPen(d)})};return{init:function(a,b){r(a,b)},cancel:function(){mor.colors=f;u()},save:function(a){a.settings.colors=n(mor.colors)},setColorsFromPen:function(a){a?a.settings?("string"===typeof a.settings&&mor.pen.deserializeFields(a),
mor.colors=a.settings.colors?n(a.settings.colors):p[0]):mor.colors=p[0]:mor.colors=p[0];u()},lightbg:function(){return t()},darkbg:function(){return k()},toggleControls:function(){y()},swatchClick:function(b){a(b)}}});
define("amd/services",[],function(){var f,c=["always ask","auto post","disabled"],e=function(c){var e,f="";if(e=c.svcIconURL||c.iconurl)f+='<img class="svcico" src="',f=0===e.indexOf("http")?f+e:0===e.indexOf("img")?f+e:f+("svcpic?serviceid="+c.name),f+='"/>';return f},q=function(c){var e,m;for(e=0;e<f.length;e+=1)if(f[e].name===c){m=f[e];break}m&&!m.svcDispName&&(m.svcDispName=m.name);return m},p=function(c,f){var m,a;m="";a=q(f.name);m+="<p>"+e(a)+"&nbsp;"+a.svcDispName+"</p>";m+=mor.linkify(a.svcDesc);
m+='<p class="headingtxt">Run it?</p><p class="headingtxt"><button type="button" onclick="mor.services.promptresp(\''+a.name+"','No');return false;\">No</button>&nbsp;<button type=\"button\" onclick=\"mor.services.promptresp('"+a.name+"','Yes');return false;\">Yes</button></p><p class=\"smalltext\"><i>You can manage connection services through the settings button next to your pen name</i></p>";mor.out("overlaydiv",m);m=mor.byId("overlaydiv");m.style.top="80px";m.style.visibility="visible";m.style.backgroundColor=
mor.skinner.lightbg();mor.onescapefunc=function(){mor.services.promptresp(a.name,"No")}},n=function(e,f){var m,a,b;mor.pen.deserializeFields(e);f.svcdata||(f.svcdata={});if(e.settings.consvcs&&0<e.settings.consvcs.length)for(m=0;m<e.settings.consvcs.length;m+=1)if(a=e.settings.consvcs[m],b=a.name,!f.svcdata[b]||"confirmed"===f.svcdata[b]){f.svcdata[b]||(f.svcdata[b]=a.state);if(f.svcdata[b]===c[0])return p(f,a);if(f.svcdata[b]===c[1]||"confirmed"===f.svcdata[b]){m=f;b=void 0;b=q(a.name);b.doPost(m);
return}}mor.profile.display()},v=function(c,e){var f,a;f=mor.review.getCurrentReview();a=mor.byId("overlaydiv");f.svcdata[c]="Yes"===e?"confirmed":"rejected";a.innerHTML="";a.style.visibility="hidden";mor.onescapefunc=null;setTimeout(function(){mor.pen.getPen(function(a){mor.services.runServices(a,f)})},50)},h=function(e){var f,h=!1;if("string"!==typeof e.name||e.status)return!1;"string"!==typeof e.state&&(e.state=c[0]);for(f=0;f<c.length;f+=1)if(e.state===c[f]){h=!0;break}h||(e.state=c[0]);return!0},
s=function(e,s){var m,a,b,t,d,r;m=[];mor.pen.deserializeFields(e);e.settings.consvcs||(e.settings.consvcs=[]);for(a=0;a<e.settings.consvcs.length;a+=1)if(d=e.settings.consvcs[a],h(d))for(b=0;b<f.length;b+=1)t=f[b],d.name===t.name&&m.push(d);for(a=0;a<f.length;a+=1){t=f[a];r=!1;for(b=0;!r&&b<e.settings.consvcs.length;b+=1)d=e.settings.consvcs[b],d.name===t.name&&h(d)&&(r=!0);r||(d={name:t.name,state:c[0]},m.push(d))}e.settings.consvcs=m;s()},t=function(c,e){if(f)return s(c,e);require(["ext/facebook",
"ext/twitter","ext/googleplus","ext/email"],function(h,a,b,t){mor.facebook||(mor.facebook=h);mor.twitter||(mor.twitter=a);mor.googleplus||(mor.googleplus=b);mor.email||(mor.email=t);f=[h,a,b,t];s(c,e)})};return{display:function(f,h){t(h,function(){var s,a="Posting Services: <table>";mor.pen.deserializeFields(h);if(h.settings.consvcs&&0<h.settings.consvcs.length)for(s=0;s<h.settings.consvcs.length;s+=1){for(var b=h.settings.consvcs[s],t=void 0,d=void 0,r=void 0,r=q(b.name),d="<tr><td>",d=d+e(r),d=
d+('</td><td><select id="'+r.name+'sel" onchange="mor.services.changestate(\''+r.name+"');return false;\">"),t=0;t<c.length;t+=1)d+='<option id="'+b.name+ +t+'"',b.state===c[t]&&(d+=' selected="selected"'),d+=">"+c[t]+"</option>";d+='</select></td><td><a href="#'+r.svcDispName+'" title="'+mor.ellipsis(r.svcDesc,65)+'" onclick="mor.services.toggleDesc(\'svcdescdiv'+r.name+"');return false;\">"+r.svcDispName+'</a><div id="svcdescdiv'+r.name+'" style="display:none;">'+mor.linkify(r.svcDesc)+"</div></td></tr>";
a+=d}else a+="<tr><td>No posting services available</td></tr>";mor.out(f,a+"</table>")})},toggleDesc:function(c){if(c=mor.byId(c))c.style.display="none"===c.style.display?"block":"none"},changestate:function(e){mor.pen.getPen(function(f){var h,a,b;mor.pen.deserializeFields(f);if(h=mor.byId(e+"sel")){for(b=0;!a&&b<f.settings.consvcs.length;b+=1)f.settings.consvcs[b].name===e&&(a=f.settings.consvcs[b]);a&&(a.state=c[h.selectedIndex])}})},run:function(c,e){t(c,function(){n(c,e)})},runServices:function(c,
e){n(c,e)},promptresp:function(c,e){v(c,e)},getRevStarsTxt:function(c){var e="";(c=c.rating)&&("number"===typeof c&&5<c)&&(e=15>c?"+":25>c?"*":35>c?"*+":45>c?"**":55>c?"**+":65>c?"***":75>c?"***+":85>c?"****":95>c?"****+":"*****");return e},getRevTitleTxt:function(c){var e,f;f=mor.review.getReviewTypeByValue(c.revtype);e=c[f.key];f.subkey&&(e+=", "+c[f.subkey]);return e},getRevTypeImage:function(c){return"http://www.myopenreviews.com/img/"+mor.review.getReviewTypeByValue(c.revtype).img},continueServices:function(c){mor.pen.getPen(function(e){n(e,
c)})}}});define("amd/basicmod",[],function(){var f;return{logit:function(){f=f?f+1:1;console.log("basicmod logCount: "+f)}}});
define("ext/facebook",[],function(){var f,c=function(a){var b="<p>&nbsp;</p><p>Facebook login success! Fetching your info...</p>";mor.out("contentdiv",b);FB.api("/me",function(c){b="<p>&nbsp;</p><p>Welcome "+c.name+"</p>";mor.out("contentdiv",b);mor.login.setAuth("fbid",a.authResponse.accessToken,c.id+" "+c.name);mor.login.authComplete()})},e=function(a,b,c,e){a="<p>"+("not_authorized"===a.status?"You have not yet authorized MyOpenReviews, click to authorize...":"You are not currently logged into Facebook, click to log in...")+
'</p><table><tr><td><a href="http://www.facebook.com" title="Log in to Facebook" onclick="mor.facebook.'+c+';return false;"><img class="loginico" src="img/f_logo.png" border="0"/> Log in to Facebook</a></td>';e&&(a+='<td>&nbsp;<button type="button" id="cancelbutton" onclick="'+e+';return false;">Cancel</button></td>');mor.out(b,a+"</tr></table>");e&&mor.layout.adjust()},q=function(){FB.login(function(a){"connected"===a.status?c(a):mor.login.init()})},p=function(){FB.getLoginStatus(function(a){"connected"===
a.status?c(a):e(a,"contentdiv","loginFB()","mor.login.init()")})},n=function(a){var b,c;window.fbAsyncInit=function(){FB.init({appId:0xf104803ca267,status:!0,cookie:!0,xfbml:!0});a()};mor.byId("facebook-jssdk")||(b=document.createElement("script"),b.id="facebook-jssdk",b.async=!0,b.src="//connect.facebook.net/en_US/all.js",c=document.getElementsByTagName("script")[0],c.parentNode.insertBefore(b,c),mor.out("contentdiv","<p>&nbsp;</p><p>Loading Facebook API...</p>"),mor.layout.adjust())},v=function(a,
b,c){var e;if(!c)return mor.err("No userID received from Facebook"),mor.profile.displayAuthSettings(a,b);e=parseInt(c,10);if(!e||0>=e)return mor.err("Invalid userID received from Facebook"),mor.profile.displayAuthSettings(a,b);mor.out(a,"Recording Facebook authorization...");b.fbid=c;mor.pen.updatePen(b,function(b){mor.profile.displayAuthSettings(a,b)},function(c,e){mor.err("facebook.addProfileAuth3 error "+c+": "+e);b.fbid=0;mor.profile.displayAuthSettings(a,b)})},h=function(a,b){FB.getLoginStatus(function(c){"connected"===
c.status?v(a,b,c.authResponse.userID):e(c,a,"authFB('"+a+"')")})},s=function(a,b){if(0!==window.location.href.indexOf(mor.mainsvr))return alert("Facebook authentication is only supported from ",mor.mainsvr),mor.profile.displayAuthSettings(a,b);if("object"===typeof FB||"function"===typeof FB)return h(a,b);n(function(){h(a,b)})},t=function(a){FB.login(function(b){"connected"===b.status?mor.pen.getPen(function(c){v(a,c,b.authResponse.userID)}):mor.pen.getPen(function(b){mor.profile.displayAuthSettings(a,
b)})})},k=function(){var a=mor.byId("overlaydiv");a.innerHTML="";a.style.visibility="hidden"},u=function(a){a.svcdata.Facebook="bailout";mor.pen.getPen(function(b){mor.services.runServices(b,a)})},m=function(a){var b,c,e,f;b=mor.services.getRevStarsTxt(a)+" "+mor.services.getRevTitleTxt(a);c="http://www.myopenreviews.com/statrev/"+mor.instId(a);e="http://www.myopenreviews.com/#command=remember&penid="+a.penid+"&revid="+mor.instId(a);f=mor.services.getRevTypeImage(a);FB.ui({method:"feed",message:a.revtype+
" review",name:b,caption:a.keywords,description:a.text,link:c,picture:f,actions:[{name:"Remember",link:e}],user_message_prompt:"Check this out if..."},function(b){b&&b.post_id?(a.svcdata.Facebook=b.post_id,mor.out("contentdiv","<p>&nbsp;</p><p>Review posted to Facebook</p>")):(mor.err("Posting to Facebook did not happen."),a.svcdata.Facebook="nopost");mor.services.continueServices(a)})},a=function(a){FB.login(function(b){k();mor.onescapefunc=null;"connected"===b.status?m(a):u(a)})},b=function(a){FB.getLoginStatus(function(b){var c;
"connected"===b.status?m(a,b.authResponse.userID):(f=a,c=mor.byId("overlaydiv"),c.style.top="80px",c.style.visibility="visible",c.style.backgroundColor=mor.skinner.lightbg(),mor.onescapefunc=function(){k();u(a)},e(b,"overlaydiv","postTmpRev()","bailTmpRev()"))})},y=function(a){if(0!==window.location.href.indexOf(mor.mainsvr))return alert("Posting to Facebook is only supported from ",mor.mainsvr),u(a);if("object"===typeof FB||"function"===typeof FB)return b(a);n(function(){b(a)})};return{loginurl:"https://www.facebook.com",
name:"Facebook",svcDispName:"Facebook Wall Post",svcDesc:"Posts a review to your wall",iconurl:"img/f_logo.png",loginFB:function(){q()},authenticate:function(){a:{try{if(mor.isDefined(FB)){p();break a}}catch(a){mor.log("facebook.js authenticate error: "+a)}n(p)}},addProfileAuth:function(a,b){s(a,b)},authFB:function(a){t(a)},doPost:function(a){y(a)},postTmpRev:function(){k();a(f)},bailTmpRev:function(){k();u(f)}}});
define("ext/twitter",[],function(){var f=null,c=function(){var c=mor.dojo.cookie("addAuthOutDiv");return c?mor.pen.getPen(function(e){mor.profile.displayAuthSettings(c,e)}):mor.login.init()},e=function(e){mor.out("contentdiv","Restoring session...");if(!mor.login.readAuthCookie())return mor.log("no previous login found on return from Twitter"),mor.login.init();mor.out("contentdiv","Recording Twitter authorization...");mor.pen.getPen(function(f){f.twid=e;mor.pen.updatePen(f,function(e){c()},function(e,
k){mor.err("twitterAuthComplete error "+e+": "+k);f.twid=0;c()})})},q=function(f){var s;s=mor.dojo.cookie("addAuthOutDiv")||"contentdiv";f.oauth_token&&f.oauth_verifier?(mor.out("contentdiv","Returned from Twitter..."),f="name=Twitter&url="+mor.enc("https://api.twitter.com/oauth/access_token")+"&toksec="+mor.dojo.cookie(f.oauth_token)+"&oauth_token="+f.oauth_token+"&oauth_verifier="+f.oauth_verifier,mor.call("oa1call","POST",f,function(c){var f=c[0],h,s;s=mor.dojo.cookie("addAuthOutDiv");f=mor.paramsToObj(f.content);
c=f.oauth_token;mor.dojo.cookie(c,f.oauth_token_secret,{expires:365});mor.dojo.cookie("addAuthOutDiv","",{expires:-1});h=f.user_id;f=f.screen_name;s?e(h):(mor.out("contentdiv","<p>&nbsp;</p><p>Welcome "+f+"</p>"),mor.login.setAuth("twid",c,h+" "+f),mor.login.authComplete())},function(e,f){mor.log("twitter token conversion failed code "+e+": "+f);c()},"")):(mor.out(s,"Setting up call to Twitter..."),f="name=Twitter&url="+mor.enc("https://api.twitter.com/oauth/request_token")+"&oauth_callback="+mor.enc("http://www.myopenreviews.com#command=AltAuth1"),
mor.call("oa1call","POST",f,function(e){var f=e[0],h,f=mor.paramsToObj(f.content);e=f.oauth_token;h=f.oauth_token_secret;(f=f.oauth_callback_confirmed)&&e&&h?(mor.dojo.cookie(e,h,{expires:2}),window.location.href="http://api.twitter.com/oauth/authenticate?oauth_token="+e):(mor.log("Request token returned from Twitter not valid: "+f+" "+e+" "+h),c())},function(e,f){mor.log("twitter initial oauth failed code "+e+": "+f);c()},""))},p=function(c,e){var p=mor.byId("overlaydiv");p.innerHTML="";p.style.visibility=
"hidden";c||(c=f);e||(e="bailout");c.svcdata.Twitter=e;mor.pen.getPen(function(e){mor.services.runServices(e,c)})},n=function(c){var e,f,k=0;f=Math.round(mor.winw/2-275);420<mor.winh&&(k=Math.round(mor.winh/2-210));e="http://www.myopenreviews.com/statrev/"+mor.instId(c);c="["+mor.services.getRevStarsTxt(c)+"] "+mor.services.getRevTitleTxt(c);return'<p>Click to tweet your review...</p><table><tr><td><button type="button" id="tweetbutton" onclick="mor.twitter.dismissDialog(null,\'clicked\');window.open(\'https://twitter.com/intent/tweet?text='+
mor.embenc(c)+"&url="+mor.enc(e)+"', 'intent', 'scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,left="+f+",top="+k+'\');return false;"><img class="loginico" src="'+mor.twitter.iconurl+'" border="0"/>&nbsp;Tweet&nbsp;</button></td><td>&nbsp;<button type="button" id="cancelbutton" onclick="mor.twitter.dismissDialog();return false;">Cancel</button></td></tr></table>'},v=function(c){var e,t;f=c;t=mor.byId("overlaydiv");t.style.top="80px";t.style.visibility="visible";t.style.backgroundColor=
mor.skinner.lightbg();mor.onescapefunc=function(){p(c,"bailout")};e=n(c);t.innerHTML=e};return{loginurl:"https://www.twitter.com",name:"Twitter",svcDispName:"Tweet",svcDesc:"Tweets a condensed review",iconurl:"img/tw_logo.png",authenticate:function(c){q(c)},addProfileAuth:function(c,e){0!==window.location.href.indexOf(mor.mainsvr)?(alert("Twitter authentication is only supported from ",mor.mainsvr),mor.profile.displayAuthSettings(c,e)):(mor.dojo.cookie("addAuthOutDiv",c,{expires:2}),q({}))},doPost:function(c){v(c)},
dismissDialog:function(c,e){p(c,e)}}});
define("ext/googleplus",[],function(){var f=null,c=function(){var c=mor.dojo.cookie("addAuthOutDiv");return c?mor.pen.getPen(function(e){mor.profile.displayAuthSettings(c,e)}):mor.login.init()},e=function(e){mor.out("contentdiv","Restoring session...");if(!mor.login.readAuthCookie())return mor.log("no previous login found on return from Google"),mor.login.init();mor.out("contentdiv","Recording Google authorization...");mor.pen.getPen(function(f){f.gsid=e;mor.pen.updatePen(f,function(e){c()},function(e,
h){mor.err("record Google auth error "+e+": "+h);f.gsid="0";c()})})},q=function(f,h){var k;if("1009259210423.apps.googleusercontent.com"!==f.audience)return mor.log("The received token was not intended for this app"),c();mor.dojo.cookie("addAuthOutDiv")?e(f.user_id):(k=mor.enc("https://www.googleapis.com/oauth2/v1/userinfo?access_token="+h),k="jsonget?geturl="+k,mor.call(k,"GET",null,function(c){mor.out("contentdiv","<p>Welcome "+c.name+"</p>");mor.login.setAuth("gsid",h,c.id+" "+c.name);mor.login.authComplete()},
function(e,f){mor.log("Google authent fetch details failed code "+e+": "+f);c()},""))},p=function(e){var f;e.access_token?(mor.out("contentdiv","Returned from Google..."),f="https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="+e.access_token,f=mor.enc(f),mor.call("jsonget?geturl="+f,"GET",null,function(c){q(c,e.access_token)},function(e,f){mor.log("Google token retrieval failed code "+e+": "+f);c()},"")):(f="https://accounts.google.com/o/oauth2/auth?response_type=token&client_id=1009259210423.apps.googleusercontent.com&redirect_uri="+
mor.enc("http://www.myopenreviews.com/")+"&scope="+mor.enc("https://www.googleapis.com/auth/userinfo.profile")+"&state=AltAuth2",window.location.href=f)},n=function(c,e){var h=mor.byId("overlaydiv");h.innerHTML="";h.style.visibility="hidden";c||(c=f);e||(e="bailout");c.svcdata.GooglePlus=e;mor.pen.getPen(function(e){mor.services.runServices(e,c)})},v=function(c){c="http://www.myopenreviews.com/statrev/"+mor.instId(c);return'<p>Click to share your review on Google+...</p><table><tr><td><a href="https://plus.google.com/share?url='+
mor.enc(c)+'" onclick="javascript:mor.googleplus.dismissDialog(null,\'clicked\');window.open(this.href,  \'\', \'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600\');return false;"><img src="https://www.gstatic.com/images/icons/gplus-32.png" alt="Share on Google+"/></a></td><td>&nbsp;<button type="button" id="cancelbutton" onclick="mor.googleplus.dismissDialog();return false;">Cancel</button></td></tr></table>'},h=function(c){var e,h;f=c;h=mor.byId("overlaydiv");h.style.top=
"80px";h.style.visibility="visible";h.style.backgroundColor=mor.skinner.lightbg();mor.onescapefunc=function(){n(c,"bailout")};e=v(c);h.innerHTML=e};return{loginurl:"https://plus.google.com",name:"GooglePlus",loginDispName:"Google+",svcDispName:"Google+ Share",svcDesc:"Posts a review to your Google+ Stream",svcIconURL:"https://www.gstatic.com/images/icons/gplus-32.png",iconurl:"https://www.google.com/favicon.ico",authenticate:function(c){p(c)},addProfileAuth:function(c,e){0!==window.location.href.indexOf(mor.mainsvr)?
(alert("Google+ authentication is only supported from ",mor.mainsvr),mor.profile.displayAuthSettings(c,e)):(mor.dojo.cookie("addAuthOutDiv",c,{expires:2}),p({}))},doPost:function(c){h(c)},dismissDialog:function(c,e){n(c,e)}}});
define("ext/github",[],function(){var f=function(){var c=mor.dojo.cookie("addAuthOutDiv");return c?mor.pen.getPen(function(e){mor.profile.displayAuthSettings(c,e)}):mor.login.init()},c=function(c,e){mor.out("contentdiv","Restoring session...");if(!mor.login.readAuthCookie())return mor.log("no previous login found on return from GitHub"),mor.login.init();mor.out("contentdiv","Recording GitHub authorization...");mor.pen.getPen(function(c){c.ghid=e.id;mor.pen.updatePen(c,function(c){f()},function(e,
p){mor.err("record GitHub auth error "+e+": "+p);c.ghid=0;f()})})},e=function(e){var n,q;n=mor.dojo.cookie("addAuthOutDiv");q=mor.enc("https://api.github.com/user?access_token="+e);q="jsonget?geturl="+q;mor.call(q,"GET",null,function(f){n?c(e,f):(mor.out("contentdiv","<p>Welcome "+f.login+"</p>"),mor.login.setAuth("ghid",e,f.id+" "+f.login),mor.login.authComplete())},function(c,e){mor.log("GitHub authent fetch details failed code "+c+": "+e);f()},"")},q=function(c){var n;c.code?(mor.out("contentdiv",
"Returned from GitHub..."),n=mor.dojo.cookie("githubAuthState"),n!==c.state&&(mor.log("Bad state returned from GitHub. Sent "+n+" got back "+c.state),f()),c="githubtok?code="+c.code+"&state="+n,mor.call(c,"GET",null,function(c){e(c.access_token)},function(c,e){mor.log("GitHub token retrieval failed code "+c+": "+e);f()},"")):(n="AltAuth3"+Math.random().toString(36).slice(2),mor.dojo.cookie("githubAuthState",n,{expires:2}),c="https://github.com/login/oauth/authorize?client_id=5ac4b34b8ae0c21465dc&redirect_uri="+
mor.enc("http://www.myopenreviews.com/")+"&state="+n,window.location.href=c)};return{loginurl:"https://github.com",name:"GitHub",iconurl:"img/blacktocat-32.png",authenticate:function(c){q(c)},addProfileAuth:function(c,e){0!==window.location.href.indexOf(mor.mainsvr)?(alert("GitHub authentication is only supported from ",mor.mainsvr),mor.profile.displayAuthSettings(c,e)):(mor.dojo.cookie("addAuthOutDiv",c,{expires:2}),q({}))}}});
